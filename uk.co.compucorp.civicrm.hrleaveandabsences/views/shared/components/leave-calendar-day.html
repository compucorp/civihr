<div class="chr_leave-calendar__day-container"
  uib-tooltip-template="'chr_leave-calendar__day-tooltip'"
  tooltip-animation="false"
  tooltip-is-open="day.tooltip.show"
  tooltip-append-to-body="false"
  tooltip-trigger="none"
  tooltip-enable="day.contactData.leaveRequests.length"
  ng-mouseenter="day.toggleTooltip('day_cell', true)"
  ng-mouseleave="day.toggleTooltip('day_cell', false)"
  ng-class="{
    'chr_leave-calendar__day-container--type--weekend': day.contactData.isWeekend,
    'chr_leave-calendar__day-container--non-working': day.contactData.isNonWorkingDay,
    'chr_leave-calendar__day-container--public-holiday': day.contactData.isPublicHoliday
  }">
  <div class="chr_leave-calendar__item"
    ng-repeat="(leaveRequestIndex, leaveRequest) in day.contactData.leaveRequestsToShowInCell"
    ng-init="leaveRequestAttributes = day.contactData.leaveRequestsAttributes[leaveRequest.id]"
    ng-style="leaveRequestAttributes.styles"
    ng-hide="day.contactData.leaveRequests.length >= 3 && leaveRequestIndex > 0"
    ng-class="{
      'chr_leave-calendar__item--half': day.contactData.leaveRequestsToShowInCell.length >= 2,
      'chr_leave-calendar__item--requested': leaveRequestAttributes.isRequested,
      'chr_leave-calendar__item--alt': leaveRequestAttributes.isAccruedTOIL
    }">
    <span ng-if="leaveRequest">
      <span class="chr_leave-calendar__item__label">
        {{leaveRequestAttributes.label}}
      </span>
    </span>
    <a ng-if="leaveRequest"
      contact-id="contact.id"
      selected-contact-id="$root.settings.contactId"
      ng-click="day.tooltip.show = false;
        day.openLeavePopup($event, leaveRequest, null, null, $root.section === 'my-leave')">
    </a>
  </div>
  <div class="chr_leave-calendar__item chr_leave-calendar__item--more chr_leave-calendar__item--half"
    ng-if="day.contactData.leaveRequests.length >= 3">
    <span class="chr_leave-calendar__item__label">
      +{{day.contactData.leaveRequests.length - 1}}
    </span>
  </div>
  <script type="text/ng-template"
    id="chr_leave-calendar__day-tooltip">
    <div
      ng-mouseenter="day.toggleTooltip('tooltip', true)"
      ng-mouseleave="day.toggleTooltip('tooltip', false)">
      <div class="chr_leave-calendar__day-tooltip_item pointer"
        ng-repeat="leaveRequest in day.contactData.leaveRequests"
        ng-init="leaveRequestAttributes = day.contactData.leaveRequestsAttributes[leaveRequest.id]"
        ng-click="day.tooltip.show = false;
          day.openLeavePopup($event, leaveRequest, null, null, $root.section === 'my-leave')">
        <strong>{{leaveRequestAttributes.absenceTypeTitle}}</strong>
        <div ng-if="!leaveRequestAttributes.isAccruedTOIL">
          <div ng-if="leaveRequest.dates.length === 1 && leaveRequestAttributes.unit === 'days'">
            <p>
              {{leaveRequestAttributes['from_date_type']}}
            </p>
          </div>
          <div ng-if="leaveRequest.dates.length > 1 && leaveRequestAttributes.unit === 'days'">
            <p>
              From: {{leaveRequestAttributes.from_date | date:'dd MMM yyyy'}},
              {{leaveRequestAttributes['from_date_type']}}<br />
              To: {{leaveRequestAttributes.to_date | date:'dd MMM yyyy'}},
              {{leaveRequestAttributes['to_date_type']}}
            </p>
          </div>
          <div ng-if="leaveRequest.dates.length === 1 && leaveRequestAttributes.unit === 'hours'">
            <p>
              From: {{leaveRequestAttributes.from_date | date:'HH:mm'}}<br/>
              To: {{leaveRequestAttributes.to_date | date:'HH:mm'}}<br/>
              For: {{ leaveRequest.from_date_amount | timeUnitApplier :leaveRequestAttributes.unit }}
            </p>
          </div>
          <div ng-if="leaveRequest.dates.length > 1 && leaveRequestAttributes.unit === 'hours'">
            <p>
              From: {{leaveRequestAttributes.from_date | date:'dd MMM yyyy HH:mm'}}<br />
              To: {{leaveRequestAttributes.to_date | date:'dd MMM yyyy HH:mm'}}
            </p>
          </div>
        </div>
        <div ng-if="leaveRequestAttributes.isAccruedTOIL">
          <p ng-switch="leaveRequestAttributes.unit">
            <span ng-switch-when="days">
              {{day.supportData.toilAmounts[leaveRequest.toil_to_accrue].label}}
            </span>
            <span ng-switch-when="hours">
              {{leaveRequest.toil_to_accrue | timeUnitApplier : 'hours' }}
            </span>
          </p>
        </div>
      </div>
    </div>
  </script>
</div>
