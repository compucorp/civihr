/*
fraction.js
A Javascript fraction library.

Copyright (c) 2009  Erik Garrison <erik@hypervolu.me>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/

/*!
 * ui-select
 * http://github.com/angular-ui/ui-select
 * Version: 0.11.2 - 2015-03-17T04:08:46.474Z
 * License: MIT
 */

// Copyright CiviCRM LLC 2013. See http://civicrm.org/licensing

define("job-contract/controllers/controllers",["common/angular"],function(e){"use strict";return e.module("hrjc.controllers",[])}),define("job-contract/filters/filters",["common/angular"],function(e){"use strict";return e.module("hrjc.filters",[])}),define("job-contract/filters/get-obj-by-id",["job-contract/filters/filters"],function(e){"use strict";e.filter("getObjById",["$log",function(e){return e.debug("Filter: getObjById"),function(e,t,n){if(!e)return null;var r=0,i=e.length;for(;r<i;r++)if(+e[r].id==+t)return n?e[r][n]:e[r];return null}}])}),define("job-contract/services/services",["common/angular"],function(e){"use strict";return e.module("hrjc.services",[])}),define("job-contract/services/utils",["job-contract/services/services"],function(e){"use strict";e.factory("API",["$resource","$q","settings","$log",function(e,t,n,r){return r.debug("Service: UtilsService"),{resource:function(t,r,i){return!t||typeof t!="string"||!r||typeof r!="string"||i&&typeof i!="object"?null:e(n.pathRest,{action:r,entity:t,json:i})},getOne:function(e,n){if(!e||typeof e!="string"||n&&typeof n!="object")return null;var r=t.defer(),i=angular.extend({sequential:1},n),s;return this.resource(e,"get",i).get(function(e){s=e.values,r.resolve(s.length==1?s[0]:null)},function(){r.reject("Unable to fetch data")}),r.promise},get:function(e,n){if(!e||typeof e!="string"||n&&typeof n!="object")return null;var r=t.defer(),i=angular.extend({sequential:1},n);return this.resource(e,"get",i).get(function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch data")}),r.promise}}}]),e.factory("testAPI",["$resource","settings",function(e,t){return{resource:function(n,r,i){return!n||typeof n!="string"||!r||typeof r!="string"||i&&typeof i!="object"?null:e(t.pathApp+"js/data/"+n+".json",{action:r,entity:n,json:i})}}}]),e.factory("UtilsService",["API","testAPI","settings","$q","$log","$timeout",function(e,t,n,r,i,s){return{getAbsenceType:function(){var t=r.defer();return e.resource("HRAbsenceType","get",{"return":"id,name,title"}).get(function(e){t.resolve(e.values)},function(){t.reject("Unable to fetch absence types")}),t.promise},getHoursLocation:function(){var t=r.defer();return e.resource("HRHoursLocation","get",{sequential:1,is_active:1}).get(function(e){t.resolve(e.values)},function(){t.reject("Unable to fetch standard hours")}),t.promise},getPayScaleGrade:function(){var t=r.defer();return e.resource("HRPayScale","get",{sequential:1}).get(function(e){t.resolve(e.values)},function(){t.reject("Unable to fetch standard hours")}),t.promise},prepareEntityIds:function(e,t,n){function r(e){e.jobcontract_id=t,delete e.id,n?e.jobcontract_revision_id=n:delete e.jobcontract_revision_id}if(angular.isArray(e)){var i=0,s=e.length;for(i;i<s;i++)r(e[i]);return}if(angular.isObject(e)){r(e);return}},errorHandler:function(e,t,n){if(e.is_error)return i.error(e.error_code+"\n"+e.error_message),n&&n.reject(e.error_code+"\n"+e.error_message),e.trace&&i.error(e.trace),!0;if(!e.values)return i.error(t||"Unknown Error"),n&&n.reject(t||"Unknown Error"),!0}}}])}),define("job-contract/services/contract-details",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractDetailsService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractDetailsService");var s=e(t.pathRest,{action:"get",entity:"HRJobDetails",json:{}});return{getOne:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number")return null;e.sequential=1,e.debug=t.debug;var i=n.defer(),o;return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract details",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contract details")}),i.promise},getOptions:function(e,r){var i=n.defer(),s;return r||(s=t.CRM.options.HRJobDetails||{},e&&typeof e=="string"&&(s=s[e]),i.resolve(s||{})),i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=n.defer(),i=t.CRM.fields;return i&&i.HRJobDetails?r.resolve(i.HRJobDetails):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract details fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract details fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=n.defer(),o=angular.extend({sequential:1,debug:t.debug},e),u;return s.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract details",i))return;u=e.values,i.resolve(u.length==1?u[0]:null)},function(){i.reject("Unable to create contract details")}),i.promise},model:function(e){function r(e){var t=0,n=e.length,r={};for(t;t<n;t++)r[e[t].name]="";return typeof r.id!="undefined"&&(r.id=null),typeof r.jobcontract_revision_id!="undefined"&&(r.jobcontract_revision_id=null),typeof r.location!="undefined"&&(r.location=null),r}var t=n.defer();return e?t.resolve(r(e)):this.getFields().then(function(e){t.resolve(r(e))}),t.promise}}}])}),define("job-contract/services/contract-hour",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractHourService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractHourService");var s=e(t.pathRest,{action:"get",entity:"HRJobHour",json:{}});return{getOne:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number")return null;e.sequential=1,e.debug=t.debug;var i=n.defer(),o;return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract hours",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contract hours")}),i.promise},getOptions:function(e,r){var i=n.defer(),s;if(!r){var s=t.CRM.options.HRJobHour||{};e&&typeof e=="string"&&(s=s[e]),i.resolve(s||{})}return i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=n.defer(),i=t.CRM.fields;return i&&i.HRJobHour?r.resolve(i.HRJobHour):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract hours fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract hours fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=n.defer(),o=angular.extend({sequential:1,debug:t.debug},e),u;return s.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract hours",i))return;u=e.values,i.resolve(u.length==1?u[0]:null)},function(){i.reject("Unable to create contract hours")}),i.promise},model:function(e){function r(e){var t=0,n=e.length,r={};for(t;t<n;t++)r[e[t].name]="";return typeof r.id!="undefined"&&(r.id=null),typeof r.jobcontract_revision_id!="undefined"&&(r.jobcontract_revision_id=null),r}var t=n.defer();return e?t.resolve(r(e)):this.getFields().then(function(e){t.resolve(r(e))}),t.promise}}}])}),define("job-contract/services/contract-health",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractHealthService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractHealthService");var s=e(t.pathRest,{action:"get",entity:"HRJobHealth",json:{}});return{getOne:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number")return null;e.sequential=1,e.debug=t.debug;var i=n.defer(),o;return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract Health",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contract Health")}),i.promise},getOptions:function(e,r){var i=n.defer(),s;if(!r){var s=t.CRM.options.HRJobHealth||{};e&&typeof e=="string"&&(s=s[e]),i.resolve(s||{})}return i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=n.defer(),i=t.CRM.fields;return i&&i.HRJobHealth?r.resolve(i.HRJobHealth):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract insurance fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract insurance fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=n.defer(),o=angular.extend({sequential:1,debug:t.debug},e),u;return s.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract insurance",i))return;u=e.values,i.resolve(u.length==1?u[0]:null)},function(){i.reject("Unable to create contract insurance")}),i.promise},model:function(e){function r(e){var t=0,n=e.length,r={};for(t;t<n;t++)r[e[t].name]="";return typeof r.id!="undefined"&&(r.id=null),typeof r.jobcontract_revision_id!="undefined"&&(r.jobcontract_revision_id=null),r}var t=n.defer();return e?t.resolve(r(e)):this.getFields().then(function(e){t.resolve(r(e))}),t.promise}}}])}),define("job-contract/services/contract-leave",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractLeaveService",["$resource","$q","settings","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractLeaveService");var s=e(n.pathRest,{action:"get",entity:"HRJobLeave",json:{}});return{get:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number"||e.id&&typeof +e.id!="number"||e.leaveType&&typeof +e.leaveType!="number")return null;e.sequential=1,e.debug=n.debug;var i=t.defer();return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract leave",i))return;i.resolve(e.values)},function(){i.reject("Unable to fetch contract leave")}),i.promise},getOptions:function(e,r){var i=t.defer(),s;if(!r){var s=n.CRM.options.HRJobLeave||{};e&&typeof e=="string"&&(s=s[e]),i.resolve(s||{})}return i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=t.defer(),i=n.CRM.fields;return i&&i.HRJobLeave?r.resolve(i.HRJobLeave):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract leave fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract leave fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=t.defer(),o={sequential:1,values:e,debug:n.debug};return s.save({action:"replace",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract leave",i))return;i.resolve(e.values)},function(){i.reject("Unable to create contract details")}),i.promise},model:function(e,n){function s(e,t){var n=0,r=t.length,i=[],s={};for(n;n<r;n++)s[t[n].name]="";return typeof s.id!="undefined"&&(s.id=null),typeof s.jobcontract_revision_id!="undefined"&&(s.jobcontract_revision_id=null),typeof s.location!="undefined"&&(s.location=null),!e||typeof e!="object"||!s||typeof s!="object"||typeof s.leave_type=="undefined"?null:(angular.forEach(e,function(e,t){s.leave_type=t,s.leave_amount=0,i.push(angular.copy(s))}),i)}var r=t.defer(),i=!n||typeof n!="object"?this.getOptions("leave_type"):n;return e?t.when(i).then(function(t){r.resolve(s(t,e))}):this.getFields().then(function(e){t.when(i).then(function(t){r.resolve(s(t,e))})}.bind(this)),r.promise}}}])}),define("job-contract/services/contract-pay",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractPayService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractPayService");var s=e(t.pathRest,{action:"get",entity:"HRJobPay",json:{}});return{getOne:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number")return null;e.sequential=1,e.debug=t.debug;var i=n.defer(),o;return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract pay",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contract pay")}),i.promise},getOptions:function(e,r){var i=n.defer(),s;if(!r){var s=t.CRM.options.HRJobPay||{};e&&typeof e=="string"&&(s=s[optionGroup]),i.resolve(s||{})}return i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=n.defer(),i=t.CRM.fields;return i&&i.HRJobPay?r.resolve(i.HRJobPay):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract pay fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract pay fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=n.defer(),o=angular.extend({sequential:1,debug:t.debug},e),u;return s.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract pay",i))return;u=e.values,i.resolve(u.length==1?u[0]:null)},function(){i.reject("Unable to create contract pay")}),i.promise},model:function(e){function r(e){var t=0,n=e.length,r={};for(t;t<n;t++)r[e[t].name]="";return typeof r.id!="undefined"&&(r.id=null),typeof r.jobcontract_revision_id!="undefined"&&(r.jobcontract_revision_id=null),typeof r.annual_benefits!="undefined"&&(r.annual_benefits=[]),typeof r.annual_deductions!="undefined"&&(r.annual_deductions=[]),r}var t=n.defer();return e?t.resolve(r(e)):this.getFields().then(function(e){t.resolve(r(e))}),t.promise}}}])}),define("job-contract/services/contract-pension",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractPensionService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContractPensionService");var s=e(t.pathRest,{action:"get",entity:"HRJobPension",json:{}});return{getOne:function(e){if(!e||typeof e!="object"||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&typeof +e.jobcontract_id!="number"||e.jobcontract_revision_id&&typeof +e.jobcontract_revision_id!="number")return null;e.sequential=1,e.debug=t.debug;var i=n.defer(),o;return s.get({json:e},function(e){if(r.errorHandler(e,"Unable to fetch contract pension",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contract pension")}),i.promise},getOptions:function(e,r){var i=n.defer(),s;if(!r){var s=t.CRM.options.HRJobPension||{};e&&typeof e=="string"&&(s=s[optionGroup]),i.resolve(s||{})}return i.promise},getFields:function(e){if(e&&typeof e!="object")return null;if(!e||typeof e!="object")e={};var r=n.defer(),i=t.CRM.fields;return i&&i.HRJobPension?r.resolve(i.HRJobPension):(e.sequential=1,s.get({action:"getfields",json:e},function(e){e.values||r.reject("Unable to fetch contract pension fields"),r.resolve(e.values)},function(){r.reject("Unable to fetch contract pension fields")})),r.promise},save:function(e){if(!e||typeof e!="object")return null;var i=n.defer(),o=angular.extend({sequential:1,debug:t.debug},e),u;return s.save({action:"create",json:o},null,function(e){if(r.errorHandler(e,"Unable to create contract pension",i))return;u=e.values,i.resolve(u.length==1?u[0]:null)},function(){i.reject("Unable to create contract pension")}),i.promise},model:function(e){function r(e){var t=0,n=e.length,r={};for(t;t<n;t++)r[e[t].name]="";return typeof r.id!="undefined"&&(r.id=null),typeof r.jobcontract_revision_id!="undefined"&&(r.jobcontract_revision_id=null),r}var t=n.defer();return e?t.resolve(r(e)):this.getFields().then(function(e){t.resolve(r(e))}),t.promise}}}])}),define("job-contract/controllers/contract-list",["job-contract/controllers/controllers","job-contract/filters/get-obj-by-id","job-contract/services/contract-details","job-contract/services/contract-hour","job-contract/services/contract-health","job-contract/services/contract-leave","job-contract/services/contract-pay","job-contract/services/contract-pension","job-contract/services/utils"],function(e){"use strict";e.controller("ContractListCtrl",["$scope","$rootElement","$rootScope","$modal","$q","$filter","contractList","ContractService","ContractDetailsService","ContractHourService","ContractPayService","ContractLeaveService","ContractHealthService","ContractPensionService","UtilsService","settings","$log",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){m.debug("Controller: ContractListCtrl");var g={details:a,hour:f,pay:l,leave:c,health:h,pension:p},y={hoursLocation:d.getHoursLocation(),payScaleGrade:d.getPayScaleGrade()},b,w={},E={};e.contractListLoaded=!1,e.contractCurrent=[],e.contractPast=[],e.utils={contractListLen:o.length};for(b in g)w[b]=g[b].getFields();i.all(w).then(function(t){e.fields=t,m.debug("FIELDS:"),m.debug(t);for(b in g)E[b]=g[b].model(t[b]);return i.all(E)}).then(function(t){e.model=t,m.debug("MODEL:"),m.debug(t),o=s("orderBy")(o,"-is_primary"),angular.forEach(o,function(t){+t.is_current?e.contractCurrent.push(t):e.contractPast.push(t)}),e.$watchCollection("contractCurrent",function(){e.utils.contractListLen=e.contractCurrent.length+e.contractPast.length}),e.$watchCollection("contractPast",function(){e.utils.contractListLen=e.contractCurrent.length+e.contractPast.length}),n.$broadcast("hrjc-loader-hide"),e.contractListLoaded=!0}),i.all(y).then(function(t){angular.extend(e.utils,t)}),e.toggleIsPrimary=function(t){function n(e){var n=0,r=e.length;for(n;n<r;n++)if(+e[n].id!=+t&&+e[n].is_primary)return e[n].is_primary="0",e[n].id;return null}n(e.contractCurrent)||n(e.contractPast),(s("getObjById")(e.contractCurrent,t)||s("getObjById")(e.contractPast,t)||{}).is_primary="1",e.contractCurrent=s("orderBy")(e.contractCurrent,"-is_primary"),e.contractPast=s("orderBy")(e.contractPast,"-is_primary")},e.modalContract=function(n){if(!n||n!=="new")return null;var s,o={targetDomEl:t.find("div").eq(0),templateUrl:v.pathApp+"views/modalForm.html?v=2222",size:"lg",controller:"ModalContractNewCtrl",windowClass:"modal-contract",resolve:{model:function(){return e.model},utils:function(){return i.all(angular.extend(y,{contractListLen:e.utils.contractListLen}))}}};s=r.open(o),s.result.then(function(t){+t.is_current?e.contractCurrent.push(t):e.contractPast.push(t),+t.is_primary&&e.toggleIsPrimary(t.id)})},e.delete=function(n){function i(t,n){var r=0,i=t.length;for(r;r<i;r++)if(+t[r].id==n)return e.$emit("hrjc-loader-hide"),t.splice(r,1),n;return null}var s=r.open({targetDomEl:t.find("div").eq(0),templateUrl:v.pathApp+"views/modalDialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{msg:"Are you sure you want to delete this job contract?"}}}});s.result.then(function(t){t&&(e.$emit("hrjc-loader-show"),u.delete(n).then(function(t){t.is_error||i(e.contractCurrent,n)||i(e.contractPast,n)}))})}}])}),define("job-contract/services/contact",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContactService",["$resource","settings","$q","UtilsService","$log",function(e,t,n,r,i){i.debug("Service: ContactService");var s=e(t.pathRest,{action:"getlist",entity:"contact",json:{}});return{getOne:function(e){if(!e||typeof +e!="number")return null;var i=n.defer(),o;return s.get({json:{id:e,debug:t.debug}},function(e){if(r.errorHandler(e,"Unable to fetch contact",i))return;o=e.values,i.resolve(o.length==1?o[0]:null)},function(){i.reject("Unable to fetch contact")}),i.promise},search:function(e,i){if(!e||typeof e=="undefined"||i&&typeof i!="object")return null;var o=n.defer(),i=i||{};return s.get({json:{input:e,params:i,debug:t.debug}},function(e){if(r.errorHandler(e,"Unable to fetch contact list",o))return;o.resolve(e.values)},function(){o.reject("Unable to fetch contact list")}),o.promise}}}])}),define("job-contract/controllers/contract",["job-contract/controllers/controllers","job-contract/services/contract-details","job-contract/services/contract-hour","job-contract/services/contract-pay","job-contract/services/contract-leave","job-contract/services/contract-pension","job-contract/services/contract-health","job-contract/services/contact","job-contract/services/utils","common/filters/angular-date/format-date"],function(e){"use strict";e.controller("ContractCtrl",["$scope","$route","$filter","$modal","$rootElement","$q","settings","API","ContractDetailsService","ContractHourService","ContractPayService","ContractLeaveService","ContractHealthService","ContractPensionService","ContractFilesService","ContactService","$log",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function b(t){var n={id:null,jobcontract_id:g,jobcontract_revision_id:t.details.jobcontract_revision_id};angular.extend(e.details,t.details),angular.extend(e.hour,t.hour||n),angular.extend(e.pay,t.pay||n),t.health&&t.health.provider&&t.health.provider!=e.health.provider&&v.getOne(t.health.provider).then(function(t){e.health.provider_contact=t}),t.health&&t.health.provider_life_insurance&&t.health.provider_life_insurance!=e.health.provider_life_insurance&&v.getOne(t.health.provider_life_insurance).then(function(t){e.health.provider_life_insurance_contact=t}),angular.extend(e.health,t.health||n),angular.extend(e.pension,t.pension||n),angular.forEach(e.leave,function(e,r){angular.extend(e,t.leave?t.leave[r]||n:n)})}function w(t){var n;if(e.details.period_end_date?(new Date(e.details.period_end_date)).getTime()!==(new Date(t)).getTime():!!e.details.period_end_date!=!!t)n=!t||(new Date(t)).setHours(0,0,0,0)>=(new Date).setHours(0,0,0,0),n!=!!+e.$parent.contract.is_current&&(n?(e.$parent.contract.is_current="1",e.$parent.$parent.contractCurrent.push(e.$parent.contract),e.$parent.$parent.contractPast.splice(e.$parent.$parent.contractPast.indexOf(e.$parent.contract),1)):(e.$parent.contract.is_current="0",e.$parent.$parent.contractPast.push(e.$parent.contract),e.$parent.$parent.contractCurrent.splice(e.$parent.$parent.contractCurrent.indexOf(e.$parent.contract),1)))}function E(){return y=s.all({details:d.get(e.details.jobcontract_revision_id,"civicrm_hrjobcontract_details"),pension:d.get(e.pension.jobcontract_revision_id,"civicrm_hrjobcontract_pension")}),y.then(function(t){e.files=t}),y}m.debug("Controller: ContractCtrl");var g=e.contract.id,y;e.contractLoaded=!1,e.isCollapsed=!0,e.files={},e.revisionCurrent={},e.revisionList=[],e.revisionDataList=[],angular.extend(e,angular.copy(e.model)),s.all({details:a.getOne({jobcontract_id:g}),hour:f.getOne({jobcontract_id:g}),leave:c.get({jobcontract_id:g}),pension:p.getOne({jobcontract_id:g})}).then(function(e){return s.all({pay:l.getOne({jobcontract_revision_id:e.details.jobcontract_revision_id}),health:h.getOne({jobcontract_revision_id:e.details.jobcontract_revision_id})}).then(function(t){return angular.extend(e,t)})}).then(function(t){b(t),e.contractLoaded=!0,e.$watch("contract.is_primary",function(){e.isCollapsed=!+e.contract.is_primary}),e.$broadcast("hrjc-loader-hide")}).then(E),e.modalContract=function(t,n){e.$broadcast("hrjc-loader-show");var u,v={controller:"ModalContractCtrl",targetDomEl:i.find("div").eq(0),templateUrl:o.pathApp+"views/modalForm.html?v=4444",windowClass:"modal-contract",size:"lg",resolve:{action:function(){return t||"view"},content:function(){return null},entity:function(){return n?s.all({details:a.getOne({jobcontract_revision_id:n.details_revision_id}),hour:f.getOne({jobcontract_revision_id:n.hour_revision_id}),pay:l.getOne({jobcontract_revision_id:n.pay_revision_id}),leave:c.get({jobcontract_revision_id:n.leave_revision_id}),health:h.getOne({jobcontract_revision_id:n.health_revision_id}),pension:p.getOne({jobcontract_revision_id:n.pension_revision_id})}).then(function(t){var n={contract:e.contract},r={id:null,jobcontract_id:g,jobcontract_revision_id:t.details.jobcontract_revision_id};return angular.extend(n,angular.copy(e.model)),angular.extend(n.details,t.details),angular.extend(n.hour,t.hour||r),angular.extend(n.pay,t.pay||r),angular.forEach(n.leave,function(e,n){angular.extend(e,t.leave?t.leave[n]||r:r)}),angular.extend(n.health,t.health||r),angular.extend(n.pension,t.pension||r),n}):{contract:e.contract,details:e.details,hour:e.hour,pay:e.pay,leave:e.leave,health:e.health,pension:e.pension}},files:function(){return n?s.all({details:d.get(n.details_revision_id,"civicrm_hrjobcontract_details"),pension:d.get(n.pension_revision_id,"civicrm_hrjobcontract_pension")}):y},utils:function(){return e.utils}}};switch(t){case"edit":v.resolve.content=function(){return{allowSave:!0,isDisabled:!1,copy:{close:"Cancel",save:"Save without making a new revision",title:"Edit contract"}}};break;case"change":v.resolve.content=function(){return{allowSave:!0,isDisabled:!1,copy:{close:"Cancel",save:"Save and make a new revision",title:"Change contract terms"}}}}u=r.open(v),u.result.then(function(t){if(!t)return;if(t.revisionCreated){var n=(new Date(t.revisionCreated.effective_date)).setHours(0,0,0,0),r=(new Date(e.revisionCurrent.effective_date)).setHours(0,0,0,0),i=(new Date).setHours(0,0,0,0),o={revisionEntityIdObj:t.revisionCreated,details:t.details,hour:t.hour,pay:t.pay},u=n<=i&&n>=r||r>i&&n<=r;u&&(w(t.details.period_end_date),b(t)),t.files&&(u?E().then(function(e){o.files=e}):s.all({details:d.get(t.revisionCreated.details_revision_id,"civicrm_hrjobcontract_details")}).then(function(e){o.files=e})),e.revisionList.unshift(t.revisionCreated),e.revisionDataList.unshift(o)}else{var a=["details","hour","pay"],f,l;w(t.details.period_end_date),b(t),e.contract.is_primary!=t.contract.is_primary&&e.$parent.$parent.toggleIsPrimary(e.contract.id),angular.forEach(e.revisionDataList,function(n){f=0,l={};while(a[f])n.revisionEntityIdObj[a[f]+"_revision_id"]==e.revisionCurrent[a[f]+"_revision_id"]&&(l[a[f]]=t[a[f]],a[f]=="details"&&t.files&&E().then(function(e){l.files=e,angular.extend(n,l)}),angular.extend(n,l)),f++})}CRM.refreshParent("#hrjobroles")})},e.modalRevision=function(t){e.$broadcast("hrjc-loader-show");if(!t)return null;var a=[],f=t!="leave"?"getOne":"get",l=0,c=e.revisionList.length;for(l;l<c;l++)a.push(u[f]("HRJob"+n("capitalize")(t),{jobcontract_revision_id:e.revisionList[l][t+"_revision_id"]}));var h={targetDomEl:i.find("div").eq(0),size:"lg",controller:"ModalRevisionCtrl",templateUrl:o.pathApp+"views/modalRevision.html?v=1234",windowClass:"modal-revision",resolve:{entity:function(){return t},fields:function(){return e.$parent.$parent.fields[t]},model:function(){return e.model[t]},utils:function(){return e.utils},revisionDataList:function(){return s.all(a)},revisionList:function(){return e.revisionList},modalContract:function(){return e.modalContract}}};return r.open(h)},e.$on("updateContractView",function(){e.$broadcast("hrjc-loader-show"),s.all({details:a.getOne({jobcontract_revision_id:e.revisionCurrent.details_revision_id}),hour:f.getOne({jobcontract_revision_id:e.revisionCurrent.hour_revision_id}),pay:l.getOne({jobcontract_revision_id:e.revisionCurrent.pay_revision_id}),leave:c.get({jobcontract_revision_id:e.revisionCurrent.leave_revision_id}),health:h.getOne({jobcontract_revision_id:e.revisionCurrent.health_revision_id}),pension:p.getOne({jobcontract_revision_id:e.revisionCurrent.pension_revision_id})}).then(function(t){b(t),e.$broadcast("hrjc-loader-hide")}).then(E)})}])}),define("job-contract/services/contract",["job-contract/services/services"],function(e){"use strict";e.factory("Contract",["$resource","settings","$log",function(e,t,n){return n.debug("Service: Contract"),e(t.pathRest,{action:"get",entity:"HRJobContract",json:{}})}]),e.factory("ContractRevision",["$resource","settings","$log",function(e,t,n){return n.debug("Service: ContractRevision"),e(t.pathRest,{action:"get",entity:"HRJobContractRevision",json:{}})}]),e.factory("ContractService",["Contract","ContractRevision","settings","$q","UtilsService","$log",function(e,t,n,r,i,s){return s.debug("Service: ContractRevision"),{get:function(t){var s=r.defer(),o={};return!CRM||!CRM.jobContractTabApp||!CRM.jobContractTabApp.contractList?(o={sequential:1,contact_id:n.contactId,deleted:0},t&&typeof +t=="number"&&(o.contact_id=t),e.get({json:o},function(e){if(i.errorHandler(e,"Unable to fetch contract list",s))return;s.resolve(e.values)},function(){s.reject("Unable to fetch contract list")})):s.resolve(CRM.jobContractTabApp.contractList),s.promise},getOne:function(t,i){if(!t||typeof +t!="number")return null;var s=r.defer(),o={deleted:0,sequential:1,contact_id:n.contactId,id:t},u;return i&&typeof +i=="number"&&(o.contact_id=i),e.get({json:o},function(e){u=e.values,s.resolve(u.length==1?u[0]:null)},function(){s.reject("Unable to fetch contract data")}),s.promise},getRevision:function(e){if(!e||typeof +e!="number")return null;var n=r.defer(),i={deleted:0,options:{limit:0},sequential:1,jobcontract_id:e};return t.get({json:i},function(e){n.resolve(e.values)},function(){n.reject("Unable to fetch contract revisions")}),n.promise},getRevisionOptions:function(e,t){var i=r.defer(),s;if(!t){var s=n.CRM.options.HRJobContractRevision||{};e&&typeof e=="string"&&(s=s[optionGroup]),i.resolve(s||{})}return i.promise},save:function(t){if(!t||typeof t!="object"||!t.id||typeof +t.id!="number")return null;var n=r.defer(),i=angular.extend({deleted:0,sequential:1},t),s;return e.save({action:"create",json:i},null,function(e){s=e.values,n.resolve(s.length==1?s[0]:null)},function(){n.reject("Unable to fetch contract contract data")}),n.promise},saveRevision:function(e){if(!e||typeof e!="object"||!e.id||typeof +e.id!="number")return null;var n=r.defer(),i=angular.extend({deleted:0,sequential:1},e),s;return t.save({action:"create",json:i},null,function(e){s=e.values,n.resolve(s.length==1?s[0]:null)},function(){n.reject("Unable to fetch contract revision")}),n.promise},"delete":function(t){if(!t||typeof +t!="number")return null;var n=r.defer();return e.delete({action:"deletecontract",json:{id:t}},function(e){n.resolve(e)},function(){n.reject("Could not delete contract ID:"+t)}),n.promise},deleteRevision:function(e){if(!e||typeof +e!="number")return null;var n=r.defer(),i;return t.save({action:"create",json:{sequential:1,deleted:1,id:e}},null,function(e){i=e.values,n.resolve(i.length==1?i[0]:null)},function(){n.reject("Unable to delete contract revision id: "+e)}),n.promise}}}])}),define("job-contract/controllers/revision-list",["job-contract/controllers/controllers","job-contract/services/contract"],function(e){"use strict";e.controller("RevisionListCtrl",["$scope","$filter","$q","$modal","$rootElement","settings","ContractService","ContractDetailsService","ContractHourService","ContractPayService","ContractFilesService","$log",function(e,t,n,r,i,s,o,u,a,f,l,c){function d(){var n,r=0;if(e.revisionList.length){var i=t("orderBy")(e.revisionList,["effective_date","id"]);angular.forEach(i,function(e){(new Date(e.effective_date)).setHours(0,0,0,0)<=(new Date).setHours(0,0,0,0)&&(n=e)});if(!n)do n=i[r],r++;while(i[r]&&i[r-1].effective_date==i[r].effective_date);return angular.extend(e.revisionCurrent,n),n.id}return null}function v(r){e.revisionList.length=0,e.revisionDataList.length=0,o.getRevision(r).then(function(r){var i=[];return r=t("orderBy")(r,["-effective_date","-id"]),e.revisionList.push.apply(e.revisionList,r),angular.forEach(r,function(e){e.effective_date=e.effective_date||"",i.push(n.all({revisionEntityIdObj:e,details:u.getOne({jobcontract_revision_id:e.details_revision_id,"return":"position, location"}),hour:a.getOne({jobcontract_revision_id:e.hour_revision_id,"return":"hours_type"}),pay:f.getOne({jobcontract_revision_id:e.pay_revision_id,"return":"pay_scale, pay_annualized_est, pay_currency"}),files:n.all({details:l.get(e.details_revision_id,"civicrm_hrjobcontract_details")})}))}),n.all(i)}).then(function(t){e.revisionDataList.push.apply(e.revisionDataList,t)})}function m(){var t=s.pathReport+(s.pathReport.indexOf("?")>-1?"&":"?"),n=e.$parent.fields;return angular.forEach(n,function(e,n){t+="fields["+n+"_revision_id]=1&",angular.forEach(e,function(e){t+="fields["+n+"_"+e.name+"]=1&"})}),t+="fields[sort_name]=1&fields[first_name]=1&fields[last_name]=1&fields[external_identifier]=1&fields[email]=1&fields[street_address]=1&fields[city]=1&fields[name]=1&fields[contract_contact_id]=1&fields[contract_contract_id]=1&fields[jobcontract_revision_id]=1&fields[change_reason]=1&fields[created_date]=1&fields[effective_date]=1&fields[modified_date]=1&order_bys[1][column]=id&order_bys[1][order]=ASC&order_bys[2][column]=civicrm_hrjobcontract_revision_revision_id&order_bys[2][order]=ASC&order_bys[3][column]=-&order_bys[3][order]=ASC&order_bys[4][column]=-&order_bys[4][order]=ASC&order_bys[5][column]=-&order_bys[5][order]=ASC&contract_id_op=eq&permission=access+CiviReport&row_count=&_qf_Summary_submit_csv=Preview+CSV&groups=&contract_id_value="+h+"&group_bys[civicrm_hrjobcontract_revision_revision_id]=1",t}c.debug("Controller: RevisionListCtrl");var h=e.contract.id,p=e.revisionDataList=e.$parent.$parent.$parent.$parent.revisionDataList;e.revisionCurrent=e.$parent.$parent.$parent.$parent.revisionCurrent,e.currentPage=1,e.itemsPerPage=5,e.maxSize=5,e.sortCol="revisionEntityIdObj.effective_date",e.sortReverse=!0,e.display={effectiveDate:!0,position:!0,payScale:!0,totalSalary:!0,hours:!0,placeOfWork:!0,recordedBy:!0},e.createPage=function(){var t=(e.currentPage-1)*e.itemsPerPage,n=t+e.itemsPerPage;e.revisionDataListPage=p.slice(t,n)},e.sortBy=function(n,r){typeof n!="undefined"&&(e.sortCol==n?e.sortReverse=!e.sortReverse:e.sortCol=n),typeof r!="undefined"&&(e.sortReverse=r),p=t("orderBy")(e.revisionDataList,e.sortCol,e.sortReverse)},v(h),e.urlCSV=m(),e.deleteRevision=function(t,n){if(e.revisionList.length==1){n.stopPropagation();return}if(!t||typeof +t!="number")return;var u=r.open({targetDomEl:i.find("div").eq(0),templateUrl:s.pathApp+"views/modalDialog.html",size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{msg:"Are you sure you want to delete this job contract revision?"}}}});u.result.then(function(n){n&&(e.$parent.$parent.$parent.$broadcast("hrjc-loader-show"),o.deleteRevision(t).then(function(n){var r=0,i=e.revisionList.length;if(!n.is_error){for(r;r<i;r++)if(e.revisionList[r].id==t){e.revisionList.splice(r,1),e.revisionDataList.splice(r,1);break}e.sortBy(),e.createPage();if(e.revisionCurrent.id!=d()){e.$emit("updateContractView");return}e.$parent.$parent.$parent.$broadcast("hrjc-loader-hide")}}))})},e.modalRevisionEdit=function(t){var n=t.effective_date,u=t.change_reason,a=r.open({targetDomEl:i.find("div").eq(0),templateUrl:s.pathApp+"views/modalChangeReason.html?v="+(new Date).getTime(),controller:"ModalChangeReasonCtrl",resolve:{content:function(){return{copy:{title:"Edit revision data"}}},date:function(){return n},reasonId:function(){return u}}});a.result.then(function(r){(r.date!=n||r.reasonId!=u)&&o.saveRevision({id:t.id,change_reason:r.reasonId,effective_date:r.date}).then(function(){t.effective_date=r.date,t.change_reason=r.reasonId,e.sortBy(),e.createPage(),e.revisionCurrent.id!=d()&&e.$emit("updateContractView")})})},e.$watch("currentPage",function(){e.createPage()}),e.$watch("revisionDataList.length",function(t,n){p=e.revisionDataList,t>n&&d(),e.sortBy(),e.createPage()})}])}),define("job-contract/controllers/modal/modal-change-reason",["common/moment","job-contract/controllers/controllers"],function(e,t){"use strict";t.controller("ModalChangeReasonCtrl",["$scope","$modalInstance","content","date","reasonId","$log",function(t,n,r,i,s,o){o.debug("Controller: ModalChangeReasonCtrl");var r=r||{},u=r.copy||{};u.title=u.title||"Revision data",t.change_reason=s||"",t.copy=u,t.effective_date=i||"",t.isPast=!1,t.dpOpen=function(e,n){e.preventDefault(),e.stopPropagation(),t[n]=!0},t.save=function(){n.close({reasonId:t.change_reason,date:t.effective_date?e(t.effective_date).format("YYYY-MM-DD"):""})},t.cancel=function(){n.dismiss("cancel")},t.$watch("effective_date",function(e){t.isPast=(new Date(e)).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}])}),define("job-contract/services/contract-files",["job-contract/services/services","job-contract/services/utils"],function(e){"use strict";e.factory("ContractFilesService",["$resource","settings","$q","UtilsService","FileUploader","$log",function(e,t,n,r,i,s){s.debug("Service: ContractFilesService");var o=e(t.pathFile+":action");return i.prototype.queueDelete=[],{"delete":function(e,t,i){if(!e||typeof +e!="number"||!t||typeof +t!="number"||!i||typeof i!="string")return null;var s=n.defer();return o.save({action:"delete",entityTable:i,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1);if(r.errorHandler(e,"Unable to delete file",s))return;s.resolve(e.values[0])},function(){s.reject("Unable to delete file")}),s.promise},get:function(e,t){if(!e||typeof +e!="number"||!t||typeof t!="string")return null;var i=n.defer();return o.get({action:"list",entityTable:t,entityID:e},function(e){if(r.errorHandler(e,"Unable to fetch files",i))return;i.resolve(e.values)},function(){i.reject("Unable to fetch files")}),i.promise},uploader:function(e,n){if(!e||typeof e!="string")return null;var r={url:t.pathFile+"upload",formData:[{entityTable:e}]};return n&&typeof n=="number"&&(r.queueLimit=n),new i(r)},upload:function(e,t){if(!e||typeof e!="object"||!t||typeof +t!="number")return null;var r=n.defer(),i=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){i.push(t)},e.onErrorItem=function(e,t,n,i){r.reject("Could not upload file: "+e.file.name),s.error(" ===== Item Error: "+n+" ======"),s.error(" =====  - item ======"),s.error(e),s.error(" =====  - response ======"),s.error(t),s.error(" =====  - headers ======"),s.error(i)},e.onCompleteAll=function(){r.resolve(i)},e.uploadAll(),r.promise}}}])}),define("job-contract/controllers/modal/modal-contract",["job-contract/controllers/controllers","job-contract/services/contract","job-contract/services/contract-details","job-contract/services/contract-hour","job-contract/services/contract-pay","job-contract/services/contract-leave","job-contract/services/contract-health","job-contract/services/contract-pension","job-contract/services/contract-files","job-contract/services/utils"],function(e){"use strict";e.controller("ModalContractCtrl",["$scope","$modal","$modalInstance","$q","$rootElement","$rootScope","$filter","ContractService","ContractDetailsService","ContractHourService","ContractPayService","ContractLeaveService","ContractHealthService","ContractPensionService","ContractFilesService","action","entity","content","files","UtilsService","utils","settings","$log",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){function T(){var e=t.open({targetDomEl:i.find("div").eq(0),templateUrl:E.pathApp+"views/modalChangeReason.html?v="+(new Date).getTime(),controller:"ModalChangeReasonCtrl",resolve:{content:function(){return{copy:{title:x.title}}},date:null,reasonId:null}});return e.result}function N(){var e=t.open({targetDomEl:i.find("div").eq(0),templateUrl:E.pathApp+"views/modalConfirmEdit.html?v="+(new Date).getTime(),controller:"ModalDialogCtrl",resolve:{content:function(){return{msg:"Save without making a new revision?"}}}});return e.result}function C(){e.$broadcast("hrjc-loader-show");var s=e.entity,o=e.filesTrash,v=e.uploader,m,g,y,b,w,S={contract:u.save(s.contract),details:a.save(s.details),hour:f.save(s.hour),pay:l.save(s.pay),leave:c.save(s.leave),health:h.save(s.health),pension:p.save(s.pension)},x=[],T=[];for(m in o){y=0,b=o[m].length;for(y;y<b;y++)g=o[m][y],T.push(d.delete(g.fileID,g.entityID,g.entityTable))}angular.extend(S,{files:T.length?r.all(T):!1}),r.all(S).then(function(n){return angular.forEach(v,function(t){angular.forEach(t,function(t){angular.forEach(t.queue,function(t){t.file.size>e.fileMaxSize&&t.remove()})})}),v.details.contract_file.queue.length&&x.push(d.upload(v.details.contract_file,s.details.jobcontract_revision_id)),v.pension.evidence_file.queue.length&&x.push(d.upload(v.pension.evidence_file,s.pension.jobcontract_revision_id)),n.details.period_start_date=s.details.period_start_date,n.details.period_end_date=s.details.period_end_date,n.pay.annual_benefits=s.pay.annual_benefits,n.pay.annual_deductions=s.pay.annual_deductions,x.length?(w=t.open({targetDomEl:i.find("div").eq(0),templateUrl:E.pathApp+"views/modalProgress.html?v="+(new Date).getTime(),size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return v},promiseFilesUpload:function(){return x}}}),n.files=w.result,r.all(n)):n}).then(function(t){e.$broadcast("hrjc-loader-hide"),n.close(t)},function(t){e.$broadcast("hrjc-loader-hide"),CRM.alert(t,"Error","error"),n.dismiss()})}function k(s,o){e.$broadcast("hrjc-loader-show");var v=e.entity,g=e.filesTrash,y=e.uploader,w,S,x,T,N=[],C=0,k,L=0,A=0,O,M,_,D,P={},H=[],B=[],j,F={details:a,hour:f,pay:l,leave:c,health:h,pension:p};for(w in F){M=!angular.equals(m[w],v[w]);if(!M){M=!!g[w]&&!!g[w].length;if(!M&&y[w])for(x in y[w]){S=y[w][x];if(S.queue.length){M=!0;break}}}M&&(N[A]={},N[A].name=w,N[A].data=v[w],N[A].service=F[w],A++,C=A)}C?(b.prepareEntityIds(N[0].data,m.contract.id),N[0].service.save(N[0].data).then(function(e){j=angular.isArray(e)?e[0].jobcontract_revision_id:e.jobcontract_revision_id,A=1,P[N[0].name]=e;for(A;A<C;A++)w=N[A].name,b.prepareEntityIds(N[A].data,m.contract.id,j),P[w]=N[A].service.save(N[A].data);return r.all(angular.extend(P,{revisionCreated:u.saveRevision({id:j,change_reason:s,effective_date:o})},{files:!1}))}).then(function(e){for(w in F){e[w]=e[w]||v[w];if(g[w]&&g[w].length){A=0,k=g[w].length;for(A;A<k;A++)T=g[w][A],H.push(d.delete(T.fileID,j,T.entityTable))}}return e.details.period_start_date=v.details.period_start_date,e.details.period_end_date=v.details.period_end_date,e.revisionCreated.effective_date=o||"",e.pay.annual_benefits=v.pay.annual_benefits,e.pay.annual_deductions=v.pay.annual_deductions,angular.extend(e.revisionCreated,{details_revision_id:e.details.jobcontract_revision_id,health_revision_id:e.health.jobcontract_revision_id,hour_revision_id:e.hour.jobcontract_revision_id,jobcontract_id:m.contract.id,leave_revision_id:e.leave[0].jobcontract_revision_id,pay_revision_id:e.pay.jobcontract_revision_id,pension_revision_id:e.pension.jobcontract_revision_id}),H.length?(e.files=r.all(H),r.all(e)):e}).then(function(n){A=0;for(A;A<C;A++){w=N[A].name;if(y[w])for(x in y[w]){S=y[w][x],L=S.queue.length,O=0;for(O;O<L;O++)_=S.queue[O],_.file.size>e.fileMaxSize&&(_.remove(),O--,L--);L&&B.push(d.upload(S,j))}}return B.length?(D=t.open({targetDomEl:i.find("div").eq(0),templateUrl:E.pathApp+"views/modalProgress.html",size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return y},promiseFilesUpload:function(){return B}}}),n.files=D.result,r.all(n)):n}).then(function(t){e.$broadcast("hrjc-loader-hide"),n.close(t)})):(e.$broadcast("hrjc-loader-hide"),n.close())}S.debug("Controller: ModalContractCtrl");var g=g||{},x=g.copy||{},v=v||"view";x.close=x.close||"Close",x.save=x.save||"Save changes",x.title=x.title||"Contract",e.allowSave=typeof g.allowSave!="undefined"?g.allowSave:!1,e.entity={},e.action=v,e.copy=x,e.fileMaxSize=E.CRM.maxFileSize||0,e.files={},e.filesTrash={},e.isDisabled=typeof g.isDisabled!="undefined"?g.isDisabled:!0,e.isPrimaryDisabled=+m.contract.is_primary,e.showIsPrimary=w.contractListLen>1&&v!="change",e.uploader={details:{contract_file:d.uploader("civicrm_hrjobcontract_details")},pension:{evidence_file:d.uploader("civicrm_hrjobcontract_pension",1)}},e.utils=w,angular.copy(m,e.entity),angular.copy(y,e.files),angular.forEach(e.files,function(t,n){e.filesTrash[n]=[]}),n.opened.then(function(){s.$broadcast("hrjc-loader-hide")}),e.cancel=function(){if(v=="view"||angular.equals(m,e.entity)&&angular.equals(y,e.files)&&!e.uploader.details.contract_file.queue.length&&!e.uploader.pension.evidence_file.queue.length){e.$broadcast("hrjc-loader-hide"),n.dismiss("cancel");return}E.debug&&angular.forEach(m,function(t,n){angular.equals(t,e.entity[n])||(S.debug("======================"),S.debug("Changed entity: "+n),S.debug("Before:"),S.debug(t),S.debug("After:"),S.debug(e.entity[n]))});var r=t.open({targetDomEl:i.find("div").eq(0),templateUrl:E.pathApp+"views/modalDialog.html?v="+(new Date).getTime(),size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:"No",title:"Alert",msg:"Are you sure you want to cancel? Changes will be lost!"}}}});r.result.then(function(t){t&&(e.$broadcast("hrjc-loader-hide"),n.dismiss("cancel"))})},e.fileMoveToTrash=function(t,n){var r=e.files[n],i=e.filesTrash[n];i.push(r[t]),r.splice(t,1)},e.filesValidate=function(){var t,n,r=e.fileMaxSize,i=e.uploader,s,o,u,a=!0,f,l;for(t in i){s=i[t];for(n in s){o=s[n],u=o.queue,f=0,l=u.length;for(;f<l&&a;f++)a=u[f].file.size<r}}e.contractForm.$setValidity("maxFileSize",a)},angular.forEach(e.uploader,function(t){angular.forEach(t,function(t){t.onAfterAddingAll=function(){e.filesValidate()}})}),e.allowSave&&(e.save=function(){if(angular.equals(m,e.entity)&&angular.equals(y,e.files)&&!e.uploader.details.contract_file.queue.length&&!e.uploader.pension.evidence_file.queue.length){e.$broadcast("hrjc-loader-hide"),n.dismiss("cancel");return}switch(v){case"edit":e.entity.contract.is_primary==m.contract.is_primary?N().then(function(e){switch(e){case"edit":C();break;case"change":T().then(function(e){k(e.reasonId,e.date)})}}):C();break;case"change":T().then(function(e){k(e.reasonId,e.date)});break;default:e.$broadcast("hrjc-loader-hide"),n.dismiss("cancel");return}})}])}),define("job-contract/controllers/modal/modal-contract-new",["job-contract/controllers/controllers","job-contract/services/contract","job-contract/services/contract-details","job-contract/services/contract-hour","job-contract/services/contract-pay","job-contract/services/contract-leave","job-contract/services/contract-health","job-contract/services/contract-pension","job-contract/services/contract-files","job-contract/services/utils"],function(e){"use strict";e.controller("ModalContractNewCtrl",["$scope","$modalInstance","$q","$modal","$rootElement","Contract","ContractService","ContractDetailsService","ContractHourService","ContractPayService","ContractLeaveService","ContractHealthService","ContractPensionService","ContractFilesService","model","UtilsService","utils","settings","$log",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){y.debug("Controller: ModalContractNewCtrl"),e.allowSave=!0,e.action="new",e.copy={close:"Cancel",save:"Add New Job Contract",title:"Add New Job Contract"},e.entity={},e.isDisabled=!1,e.showIsPrimary=m.contractListLen,e.fileMaxSize=g.CRM.maxFileSize||0,e.uploader={details:{contract_file:p.uploader("civicrm_hrjobcontract_details")},pension:{evidence_file:p.uploader("civicrm_hrjobcontract_pension",1)}},e.utils=m,angular.copy(d,e.entity),e.entity.contract={is_primary:0},e.filesValidate=function(){var t,n,r=e.fileMaxSize,i=e.uploader,s,o,u,a=!0,f,l;for(t in i){s=i[t];for(n in s){o=s[n],u=o.queue,f=0,l=u.length;for(;f<l&&a;f++)a=u[f].file.size<r}}e.contractForm.$setValidity("maxFileSize",a)},angular.forEach(e.uploader,function(t){angular.forEach(t,function(t){t.onAfterAddingAll=function(){e.filesValidate()}})}),e.cancel=function(){t.dismiss("cancel")},e.save=function(){e.$broadcast("hrjc-loader-show");var d=new s;d.$save({action:"create",json:{sequential:1,contact_id:g.contactId,is_primary:m.contractListLen?e.entity.contract.is_primary:1}},function(s){var d=s.values[0],m=d.id,y=e.entity.details,b=e.entity.hour,w=e.entity.pay,E=e.entity.leave,S=e.entity.health,x=e.entity.pension,T,N,C=[],k=e.uploader,L;d.is_current=!y.period_end_date||new Date(y.period_end_date)>new Date,v.prepareEntityIds(y,m),u.save(y).then(function(e){L=e.jobcontract_revision_id},function(e){return CRM.alert(e,"Error","error"),o.delete(m),t.dismiss(),n.reject()}).then(function(){return angular.forEach(e.entity,function(e){v.prepareEntityIds(e,m,L)}),N=[a.save(b),f.save(w),l.save(E),c.save(S),h.save(x)],e.uploader.details.contract_file.queue.length&&C.push(p.upload(k.details.contract_file,L)),e.uploader.pension.evidence_file.queue.length&&C.push(p.upload(k.pension.evidence_file,L)),C.length&&(T=r.open({targetDomEl:i.find("div").eq(0),templateUrl:g.pathApp+"views/modalProgress.html",size:"sm",controller:"ModalProgressCtrl",resolve:{uploader:function(){return k},promiseFilesUpload:function(){return C}}}),N.push(T.result)),n.all(N)},function(e){return CRM.alert(e,"Error","error"),t.dismiss(),n.reject()}).then(function(){e.$broadcast("hrjc-loader-hide"),t.close(d)})},function(r){return e.$broadcast("hrjc-loader-hide"),t.dismiss(),CRM.alert(r.statusText||"Unknown error","Error","error"),n.reject()})}}])}),define("job-contract/controllers/modal/modal-dialog",["job-contract/controllers/controllers"],function(e){"use strict";e.controller("ModalDialogCtrl",["$scope","$modalInstance","$timeout","content","$log",function(e,t,n,r,i){i.debug("Controller: ModalDialogCtrl"),e.title=r.title||"CiviHR Job Contract",e.msg=r.msg||"",e.copyConfirm=r.copyConfirm||"Yes",e.copyCancel=r.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.dismiss("Cancel")}}])}),define("job-contract/controllers/modal/modal-progress",["job-contract/controllers/controllers"],function(e){"use strict";e.controller("ModalProgressCtrl",["$scope","$modalInstance","$q","$timeout","uploader","promiseFilesUpload","$log",function(e,t,n,r,i,s,o){o.debug("Controller: ModalProgressCtrl");var u,a;e.uploader=i;for(u in i)for(a in i[u])i[u][a].queue.length&&(i[u][a].item=i[u][a].queue[0].file.name),i[u][a].onProgressItem=function(e){this.item=e.file.name};n.all(s).then(function(e){r(function(){t.close(e)},500)}),e.cancel=function(){t.dismiss("File upload canceled")}}])}),define("job-contract/controllers/modal/modal-revision",["job-contract/controllers/controllers"],function(e){"use strict";e.controller("ModalRevisionCtrl",["$scope","$rootScope","$modalInstance","$filter","$q","settings","revisionDataList","revisionList","entity","fields","model","modalContract","utils","ContactService","$log",function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function v(){var t=s.pathReport+(s.pathReport.indexOf("?")>-1?"&":"?"),n=e.entity,r,i;return angular.forEach(e.fields,function(e){r=e.name!="editor_name"?e.name:"editor_uid",i=e.extends?"":n+"_",e.selected&&(t+="fields["+i+r+"]=1&")}),t+="fields[sort_name]=1&fields[first_name]=1&fields[last_name]=1&fields[external_identifier]=1&fields[email]=1&fields[street_address]=1&fields[city]=1&fields[name]=1&fields[contract_contact_id]=1&fields[contract_contract_id]=1&fields[jobcontract_revision_id]=1&fields[change_reason]=1&fields[created_date]=1&fields[effective_date]=1&fields[modified_date]=1&order_bys[1][column]=id&order_bys[1][order]=ASC&order_bys[2][column]=civicrm_hrjobcontract_revision_revision_id&order_bys[2][order]=ASC&order_bys[3][column]=-&order_bys[3][order]=ASC&order_bys[4][column]=-&order_bys[4][order]=ASC&order_bys[5][column]=-&order_bys[5][order]=ASC&contract_id_op=eq&permission=access+CiviReport&row_count=&_qf_Summary_submit_csv=Preview+CSV&groups=&contract_id_value="+u[0].jobcontract_id+"&group_bys[civicrm_hrjobcontract_revision_revision_id]=1",t}d.debug("Controller: ModalRevisionCtrl"),e.$broadcast("hrjc-loader-show"),e.currentPage=1,e.entity=a,e.fields=angular.copy(f),e.itemsPerPage=5,e.revisionDataList=[],e.revisionList=[],e.sortCol="effective_date",e.subFields={},e.maxSize=5,e.modalContract=c,e.sortReverse=!0,function(){var t=0,n=e.fields.length,r;for(t;t<n;t++){r=e.fields[t],r.selected=!0,r.isArray=r.name=="leave_type"||r.name=="leave_amount";if(r.name=="id"||r.name=="jobcontract_revision_id"){r.display=!1;continue}r.display=!0}e.fields.unshift({name:"effective_date",title:"Effective Date",display:!0,selected:!0,isArray:!1,"extends":!0}),e.fields.push({name:"editor_name",title:"Change Recorded By",display:!0,selected:!0,isArray:!1,"extends":!0},{name:"change_reason",title:"Reason For Change",display:!0,selected:!0,isArray:!1,"extends":!0})}(),function(){var n=0,i,s,a=o.length,f;for(n;n<a;n++)i=n+1,s=i==a,o[n]||(o[n]=l),!s&&!o[i]&&(o[i]=l),angular.isArray(o[n])?(f=s||o[n][0].jobcontract_revision_id!=o[i][0].jobcontract_revision_id,o[n]={jobcontract_revision_id:o[n][0].jobcontract_revision_id,data:o[n]}):f=s||o[n].jobcontract_revision_id!=o[i].jobcontract_revision_id,f&&(angular.extend(o[n],{effective_date:r("date")(u[n].effective_date,"yyyy/MM/dd")||"",editor_name:u[n].editor_name||"",change_reason:t.options.contract.change_reason[u[n].change_reason]||""}),e.revisionDataList.push(o[n]))}();switch(a){case"hour":(function(){var t;angular.forEach(e.revisionDataList,function(e){e.location_standard_hours&&(t=r("filter")(h.hoursLocation,{id:e.location_standard_hours})[0],e.location_standard_hours=t.location+": "+t.standard_hours+"h per "+t.periodicity)})})();break;case"health":angular.forEach(e.revisionDataList,function(e){e.provider&&p.getOne(e.provider).then(function(t){e.provider=t.label}),e.provider_life_insurance&&p.getOne(e.provider_life_insurance).then(function(t){e.provider_life_insurance=t.label})});break;case"pay":(function(){var n;angular.forEach(e.revisionDataList,function(e){e.pay_scale&&(n=r("filter")(h.payScaleGrade,{id:e.pay_scale})[0]||r("filter")(h.payScaleGrade,{pay_scale:e.pay_scale})[0],e.pay_scale=n.pay_scale+(n.pay_grade?" - "+n.pay_grade:"")+(n.currency?" - "+t.options.pay.pay_currency[n.currency]:"")+(n.amount?" "+n.amount:"")+(n.periodicity?" per "+n.periodicity:""))})})(),r("filter")(e.fields,{name:"pay_is_auto_est"})[0].pseudoconstant=!0,e.subFields={annual_benefits:[{name:"name",title:"Benefit",pseudoconstant:"benefit_name"},{name:"type",title:"Type",pseudoconstant:"benefit_type"},{name:"amount_pct",title:"% amount",pseudoconstant:!1},{name:"amount_abs",title:"Absolute amount",pseudoconstant:!1}],annual_deductions:[{name:"name",title:"Deduction",pseudoconstant:"deduction_name"},{name:"type",title:"Type",pseudoconstant:"deduction_type"},{name:"amount_pct",title:"% amount",pseudoconstant:!1},{name:"amount_abs",title:"Absolute amount",pseudoconstant:!1}]};break;case"pension":r("filter")(e.fields,{name:"is_enrolled"})[0].pseudoconstant=!0}e.urlCSV=v(),e.createPage=function(){var t=(e.currentPage-1)*e.itemsPerPage,n=t+e.itemsPerPage;e.revisionDataListPage=e.revisionDataList.slice(t,n)},e.sortBy=function(t,n){typeof t!="undefined"&&(e.sortCol==t?e.sortReverse=!e.sortReverse:e.sortCol=t),typeof n!="undefined"&&(e.sortReverse=n),e.revisionDataList=r("orderBy")(e.revisionDataList,e.sortCol,e.sortReverse)},e.sortBy(),e.toggleFieldsSelected=function(t){t.selected=!t.selected,e.urlCSV=v()},n.opened.then(function(){t.$broadcast("hrjc-loader-hide")}),e.cancel=function(){n.dismiss("cancel")},e.$watch("currentPage",function(){e.createPage()})}])}),define("job-contract/controllers/form/form-general",["common/moment","job-contract/controllers/controllers"],function(e,t){"use strict";t.controller("FormGeneralCtrl",["$scope","$log","$timeout",function(t,n){function i(t,n){if(!t||!n)return"Unspecified";var r,i,s,o;return s=e(n),o=s.diff(t,"years"),s.add(-o,"years"),i=s.diff(t,"months"),s.add(-i,"months"),r=s.diff(t,"days"),o=o>0?o>1?o+" years ":o+" year ":"",i=i>0?i>1?i+" months ":i+" month ":"",r=r>0?r>1?r+" days":r+" day":"",o+i+r||"0 days"}n.debug("Controller: FormGeneralCtrl");var r=t.entity.details;t.dpOpen=function(e,n){e.preventDefault(),e.stopPropagation(),t[n]=!0},t.$watch("entity.details.period_start_date",function(){e(r.period_start_date),t.dpDateEndMin=e(r.period_start_date).add(1,"day").format(),t.duration=i(r.period_start_date,r.period_end_date)}),t.$watch("entity.details.period_end_date",function(){t.dpDateStartMax=r.period_end_date?e(r.period_end_date).subtract(1,"day").format():"",t.duration=i(r.period_start_date,r.period_end_date)}),t.$watch("entity.details.position",function(e,n){e!=n&&r.title==n&&(t.contractForm.detailsTitle.$setViewValue(e),t.contractForm.detailsTitle.$render())}),t.$watch("entity.details.notice_amount",function(e,n){+e&&!r.notice_unit&&(t.contractForm.detailsNoticeUnit.$setValidity("required",!1),t.contractForm.detailsNoticeUnit.$dirty=!0),e!=n&&r.notice_amount_employee==n&&(r.notice_amount_employee=e)}),t.$watch("entity.details.notice_amount_employee",function(e){+e&&!r.notice_unit_employee&&(t.contractForm.detailsNoticeUnitEmployee.$setValidity("required",!1),t.contractForm.detailsNoticeUnitEmployee.$dirty=!0)}),t.$watch("entity.details.notice_unit",function(e,t){e!=t&&r.notice_unit_employee==t&&(r.notice_unit_employee=e)})}])}),define("job-contract/vendor/fraction",[],function(){var e=function(t,n){if(typeof t!="undefined"&&n)typeof t=="number"&&typeof n=="number"?(this.numerator=t,this.denominator=n):typeof t=="string"&&typeof n=="string"&&(this.numerator=parseInt(t),this.denominator=parseInt(n));else if(typeof n=="undefined"){num=t;if(typeof num=="number")this.numerator=num,this.denominator=1;else if(typeof num=="string"){var r,i,s=num.split(" ");s[0]&&(r=s[0]),s[1]&&(i=s[1]);if(r%1===0&&i&&i.match("/"))return(new e(r)).add(new e(i));if(!r||!!i)return undefined;if(typeof r=="string"&&r.match("/")){var o=r.split("/");this.numerator=o[0],this.denominator=o[1]}else{if(typeof r=="string"&&r.match("."))return new e(parseFloat(r));this.numerator=parseInt(r),this.denominator=1}}}this.normalize()};return e.prototype.clone=function(){return new e(this.numerator,this.denominator)},e.prototype.toString=function(){if(this.denominator==="NaN")return"NaN";var e=this.numerator/this.denominator>0?Math.floor(this.numerator/this.denominator):Math.ceil(this.numerator/this.denominator),t=this.numerator%this.denominator,n=this.denominator,r=[];return e!=0&&r.push(e),t!=0&&r.push((e===0?t:Math.abs(t))+"/"+n),r.length>0?r.join(" "):0},e.prototype.rescale=function(e){return this.numerator*=e,this.denominator*=e,this},e.prototype.add=function(t){var n=this.clone();return t instanceof e?t=t.clone():t=new e(t),td=n.denominator,n.rescale(t.denominator),t.rescale(td),n.numerator+=t.numerator,n.normalize()},e.prototype.subtract=function(t){var n=this.clone();return t instanceof e?t=t.clone():t=new e(t),td=n.denominator,n.rescale(t.denominator),t.rescale(td),n.numerator-=t.numerator,n.normalize()},e.prototype.multiply=function(t){var n=this.clone();if(t instanceof e)n.numerator*=t.numerator,n.denominator*=t.denominator;else{if(typeof t!="number")return n.multiply(new e(t));n.numerator*=t}return n.normalize()},e.prototype.divide=function(t){var n=this.clone();if(t instanceof e)n.numerator*=t.denominator,n.denominator*=t.numerator;else{if(typeof t!="number")return n.divide(new e(t));n.denominator*=t}return n.normalize()},e.prototype.equals=function(t){t instanceof e||(t=new e(t));var n=this.clone().normalize(),t=t.clone().normalize();return n.numerator===t.numerator&&n.denominator===t.denominator},e.prototype.normalize=function(){var t=function(e){return typeof e=="number"&&(e>0&&e%1>0&&e%1<1||e<0&&e%-1<0&&e%-1>-1)},n=function(e,t){if(!t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n};return function(){if(t(this.denominator)){var r=n(this.denominator,9),i=Math.pow(10,r.toString().split(".")[1].length);this.denominator=Math.round(this.denominator*i),this.numerator*=i}if(t(this.numerator)){var r=n(this.numerator,9),i=Math.pow(10,r.toString().split(".")[1].length);this.numerator=Math.round(this.numerator*i),this.denominator*=i}var s=e.gcf(this.numerator,this.denominator);this.numerator/=s,this.denominator/=s;if(this.numerator<0&&this.denominator<0||this.numerator>0&&this.denominator<0)this.numerator*=-1,this.denominator*=-1;return this}}(),e.gcf=function(t,n){var r=[],i=e.primeFactors(t),s=e.primeFactors(n);i.forEach(function(e){var t=s.indexOf(e);t>=0&&(r.push(e),s.splice(t,1))});if(r.length===0)return 1;var o=function(){var e=r[0],t;for(t=1;t<r.length;t++)e*=r[t];return e}();return o},e.primeFactors=function(e){var t=Math.abs(e),n=[],r=2;while(r*r<=t)t%r===0?(n.push(r),t/=r):r++;return t!=1&&n.push(t),n},e}),define("job-contract/controllers/form/form-hour",["job-contract/vendor/fraction","job-contract/controllers/controllers"],function(e,t){"use strict";t.controller("FormHourCtrl",["$scope","$rootScope","$filter","$log",function(t,n,r,i){function a(e,n){t.hrsTypeDefined=typeof s.hours_type!="undefined"&&s.hours_type!=null&&s.hours_type!="";if(t.hrsTypeDefined){s.hours_unit=e.periodicity;switch(+n){case 8:s.hours_amount=e.standard_hours;break;case 4:s.hours_amount=s.hours_amount?s.hours_amount:Math.round(e.standard_hours/2);break;case 0:s.hours_amount=s.hours_amount?s.hours_amount:0;break;default:s.hours_amount=""}return}s.hours_unit="",s.hours_amount=""}function f(n,r){r=parseFloat(r)||0,n=parseFloat(n)||0;var i=new e(r,n);s.fte_num=String(+s.hours_type?i.numerator:0),s.fte_denom=String(+s.hours_type?i.denominator:0),s.hours_fte=String(parseFloat((s.fte_num/s.fte_denom||0).toFixed(2))),t.fteFraction=s.fte_num+"/"+s.fte_denom}i.debug("Controller: FormHourCtrl");var s=t.entity.hour,o=t.utils.hoursLocation,u={};t.hrsTypeDefined=!1,s.location_standard_hours=s.location_standard_hours||"1",u=r("getObjById")(o,s.location_standard_hours),t.$watch("entity.hour.location_standard_hours",function(e){u=r("getObjById")(o,e),a(u,s.hours_type),f(u.standard_hours,s.hours_amount)}),t.$watch("entity.hour.hours_type",function(e,t){e!=t&&(a(u,e),f(u.standard_hours,s.hours_amount))}),t.$watch("entity.hour.hours_amount",function(e,t){e!=t&&f(u.standard_hours,e)}),t.$watch("entity.hour.hours_unit",function(e,t){e!=t&&f(u.standard_hours,s.hours_amount)})}])}),define("job-contract/controllers/form/form-health",["job-contract/controllers/controllers","job-contract/services/contact"],function(e){"use strict";e.controller("FormHealthCtrl",["$scope","ContactService","$log",function(e,t,n){n.debug("Controller: FormHealthCtrl"),e.contacts={Health_Insurance_Provider:[],Life_Insurance_Provider:[]},e.refreshContacts=function(n,r){if(!n)return;t.search(n,{contact_type:"Organization",contact_sub_type:r}).then(function(t){e.contacts[r]=t})},e.entity.health.provider&&t.getOne(e.entity.health.provider).then(function(t){e.contacts.Health_Insurance_Provider.push(t)}),e.entity.health.provider_life_insurance&&t.getOne(e.entity.health.provider_life_insurance).then(function(t){e.contacts.Life_Insurance_Provider.push(t)})}])}),define("job-contract/controllers/form/form-pay",["job-contract/controllers/controllers"],function(e){"use strict";e.controller("FormPayCtrl",["$scope","$filter","settings","$log",function(e,t,n,r){function a(){var e=1;switch(+i.pay_cycle){case 1:e=u.Week;break;case 2:e=u.Month}return e}r.debug("Controller: FormPayCtrl");var i=e.entity.pay||{},s={pay_amount:0,pay_currency:n.CRM.defaultCurrency,pay_cycle:"2",pay_unit:"Year"},o=e.utils.payScaleGrade,u={Year:1,Month:12,Week:52,Fortnight:26,Day:260,Hour:2080};e.collapseBenDed=!i.annual_benefits.length&&!i.annual_deductions.length,e.benefits_per_cycle=0..toFixed(2),e.benefits_per_cycle_net=0,e.deductions_per_cycle=0..toFixed(2),i.is_paid=i.is_paid||0,i.pay_is_auto_est="0",i.annual_benefits=i.annual_benefits||[],i.annual_deductions=i.annual_deductions||[],e.add=function(e){e.push({name:"",type:"",amount_pct:"",amount_abs:""})},e.applyPayScaleGradeData=function(){if(i.pay_scale){var e=t("getObjById")(o,i.pay_scale);i.pay_amount=e.amount||s.pay_amount,i.pay_currency=e.currency||s.pay_currency,i.pay_unit=e.periodicity||s.pay_unit}},e.calcAnnualPayEst=function(){+i.is_paid&&(i.pay_annualized_est=(i.pay_amount*u[i.pay_unit]||0).toFixed(2))},e.calcBenefitsPerCycle=function(){if(+i.is_paid){var t=0,n=i.annual_benefits.length,r=0;for(t;t<n;t++)+i.annual_benefits[t].type==2&&(i.annual_benefits[t].amount_abs=(i.annual_benefits[t].amount_pct/100*i.pay_annualized_est).toFixed(2)),r+=+i.annual_benefits[t].amount_abs;e.benefits_per_cycle=(r/a()).toFixed(2)}},e.calcBenefitsPerCycleNet=function(){+i.is_paid&&(e.benefits_per_cycle_net=e.benefits_per_cycle-e.deductions_per_cycle)},e.calcDeductionsPerCycle=function(){if(+i.is_paid){var t=0,n=i.annual_deductions.length,r=0;for(t;t<n;t++)+i.annual_deductions[t].type==2&&(i.annual_deductions[t].amount_abs=(i.annual_deductions[t].amount_pct/100*i.pay_annualized_est).toFixed(2)),r+=+i.annual_deductions[t].amount_abs;e.deductions_per_cycle=(r/a()).toFixed(2)}},e.calcPayPerCycleGross=function(){+i.is_paid&&(i.pay_per_cycle_gross=(i.pay_annualized_est/a()).toFixed(2))},e.calcPayPerCycleNet=function(){+i.is_paid&&(i.pay_per_cycle_net=(+i.pay_per_cycle_gross+ +e.benefits_per_cycle_net).toFixed(2))},e.resetData=function(){i.pay_scale="",i.pay_amount="",i.pay_unit="",i.pay_currency="",i.pay_annualized_est="",i.pay_is_auto_est="",i.annual_benefits=[],i.annual_deductions=[],i.pay_cycle="",i.pay_per_cycle_gross="",i.pay_per_cycle_net="",e.benefits_per_cycle="",e.deductions_per_cycle=""},e.setDefaults=function(){i.pay_cycle=s.pay_cycle,i.pay_currency=s.pay_currency,i.pay_is_auto_est="0",i.pay_amount=0..toFixed(2)},e.remove=function(e,t){e.splice(t,1)},e.$watch("entity.pay.pay_amount",e.calcAnnualPayEst),e.$watch("entity.pay.pay_unit",e.calcAnnualPayEst),e.$watch("entity.pay.pay_annualized_est",function(){e.calcPayPerCycleGross(),e.calcBenefitsPerCycle(),e.calcDeductionsPerCycle()}),e.$watch("entity.pay.annual_benefits",e.calcBenefitsPerCycle,!0),e.$watch("entity.pay.annual_deductions",e.calcDeductionsPerCycle,!0),e.$watch("benefits_per_cycle",e.calcBenefitsPerCycleNet),e.$watch("deductions_per_cycle",e.calcBenefitsPerCycleNet),e.$watch("benefits_per_cycle_net",e.calcPayPerCycleNet),e.$watch("entity.pay.pay_per_cycle_gross",e.calcPayPerCycleNet)}])}),define("job-contract/controllers/form/form-pension",["job-contract/controllers/controllers","job-contract/services/contact"],function(e){"use strict";e.controller("FormPensionCtrl",["$scope","settings","$log",function(e,t,n){n.debug("Controller: FormPensionCtrl")}])}),define("job-contract/directives/directives",["common/angular"],function(e){"use strict";return e.module("hrjc.directives",[])}),define("job-contract/directives/contact",["job-contract/directives/directives"],function(e){"use strict";e.directive("hrjcContact",["$compile","ContactService","settings","$log",function(e,t,n,r){return r.debug("Directive: hrjcContact"),{restrict:"A",scope:{renderAsLink:"=?hrjcContactLink",contactId:"=?hrjcContact"},template:"{{contact.label}}",link:function(n,r){if(!n.contactId)return;n.$watch("contactId",function(i){t.getOne(n.contactId).then(function(t){n.contact=t,n.renderAsLink&&(r.html('<a ng-href="/civicrm/contact/view?reset=1&cid={{contactId}}">{{contact.label}}</a>'),e(r.contents())(n))})})}}}])}),define("job-contract/directives/loader",["job-contract/directives/directives"],function(e){"use strict";e.directive("hrjcLoader",["$rootScope","$log",function(e,t){return t.debug("Directive: hrjcLoader"),{link:function(e,t,n){function o(){var e=window.getComputedStyle(t[0]).position;return e=="relative"||e=="absolute"||e=="fixed"}function u(){o()||(t.css("position","relative"),s=!0),t.append(r),i=!0}function a(){i&&r.parentNode.removeChild(r),i=!1,s&&t.css("position","")}var r=document.createElement("div"),i=!1,s=!1;r.className="hrjc-loader",n.hrjcLoaderShow&&u(),e.$on("hrjc-loader-show",function(){u()}),e.$on("hrjc-loader-hide",function(){a()})}}}])}),define("job-contract/directives/number",["job-contract/directives/directives"],function(e){"use strict";e.directive("hrjcNumber",["$log",function(e){return e.debug("Directive: hrjcNumber"),{require:"ngModel",link:function(e,t,n,r){var i=2,s=n.hrjcNumberFloat||!1;n.hrjcNumber&&typeof +n.hrjcNumber=="number"&&(i=n.hrjcNumber),t.bind("blur",function(){var e=parseFloat(r.$viewValue)||0;r.$setViewValue(s?Math.round(e*100)/100:e.toFixed(i)),r.$render()})}}}])}),define("job-contract/directives/validate",["job-contract/directives/directives"],function(e){"use strict";e.directive("hrjcValidate",["$log",function(e){return e.debug("Directive: hrjcValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?hrjcValidateWarning"},link:function(e,t,n,r){function f(e,n){t.toggleClass("has-success",!e&&!n),a.toggleClass("glyphicon-ok",!e&&!n)}function l(e,n){t.toggleClass("has-warning",!e&&n),a.toggleClass("glyphicon-warning-sign",!e&&n)}function c(e){t.toggleClass("has-error",e),a.toggleClass("glyphicon-remove",e)}var i=t[0].querySelector("[name]"),s=angular.element(i),o=s.attr("name"),u=document.createElement("span"),a=angular.element(u);if(!o)return;t.addClass("has-feedback"),a.addClass("glyphicon form-control-feedback"),s.after(a),e.$watch(function(){return r[o]&&r[o].$invalid},function(t){r[o].$dirty&&(f(t,e.isWarning),c(t))}),typeof e.isWarning!="undefined"&&e.$watch("isWarning",function(e){var t=r[o].$invalid;r[o].$dirty&&(f(t,e),l(t,e))}),s.bind("blur",function(){c(r[o].$invalid)})}}}])}),define("job-contract/filters/capitalize",["job-contract/filters/filters"],function(e){"use strict";e.filter("capitalize",["$log",function(e){return e.debug("Filter: capitalize"),function(e){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}])}),define("job-contract/filters/format-amount",["job-contract/filters/filters"],function(e){"use strict";e.filter("formatAmount",["$log",function(e){return e.debug("Filter: formatAmount"),function(e){return e&&e.indexOf(".")===-1?e+".00":e}}])}),define("job-contract/filters/format-period",["job-contract/filters/filters"],function(e){"use strict";e.filter("formatPeriod",["$filter","$log",function(e,t){return t.debug("Filter: formatPeriod"),function(t){return t?e("date")(t,"yyyy/MM/dd"):"Unspecified"}}])}),define("job-contract/filters/parse-int",["job-contract/filters/filters"],function(e){"use strict";e.filter("parseInt",["$log",function(e){return e.debug("Filter: parseInt"),function(e){return e?parseInt(e):null}}])}),function(){var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){var n=t.which;switch(n){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return t.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)}};angular.element.prototype.querySelectorAll===undefined&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),angular.element.prototype.closest===undefined&&(angular.element.prototype.closest=function(e){var t=this[0],n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;while(t){if(n.bind(t)(e))return t;t=t.parentElement}return!1});var t=0,n=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,generateId:function(){return t++},appendToBody:!1}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments),n=t.message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(n)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,n,r,i){i(e,function(e){t.append(e)})}}}).filter("highlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n&&t?t.replace(new RegExp(e(n),"gi"),'<span class="ui-select-highlight">$&</span>'):t}}).factory("uisOffset",["$document","$window",function(e,t){return function(n){var r=n[0].getBoundingClientRect();return{width:r.width||n.prop("offsetWidth"),height:r.height||n.prop("offsetHeight"),top:r.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:r.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);n.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile",function(e,t,n,r){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme;return n+"/choices.tpl.html"},compile:function(i,s){if(!s.repeat)throw n("repeat","Expected 'repeat' expression.");return function(s,o,u,a,f){var l=u.groupBy;a.parseRepeatAttr(u.repeat,l),a.disableChoiceExpression=u.uiDisableChoice,a.onHighlightCallback=u.onHighlight;if(l){var c=o.querySelectorAll(".ui-select-choices-group");if(c.length!==1)throw n("rows","Expected 1 .ui-select-choices-group but got '{0}'.",c.length);c.attr("ng-repeat",t.getGroupNgRepeatExpression())}var h=o.querySelectorAll(".ui-select-choices-row");if(h.length!==1)throw n("rows","Expected 1 .ui-select-choices-row but got '{0}'.",h.length);h.attr("ng-repeat",t.getNgRepeatExpression(a.parserResult.itemName,"$select.items",a.parserResult.trackByExp,l)).attr("ng-if","$select.open").attr("ng-mouseenter","$select.setActiveItem("+a.parserResult.itemName+")").attr("ng-click","$select.select("+a.parserResult.itemName+",false,$event)");var p=o.querySelectorAll(".ui-select-choices-row-inner");if(p.length!==1)throw n("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",p.length);p.attr("uis-transclude-append",""),r(o,f)(s),s.$watch("$select.search",function(e){e&&!a.open&&a.multiple&&a.activate(!1,!0),a.activeIndex=a.tagging.isActivated?-1:0,a.refresh(u.refresh)}),u.$observe("refreshDelay",function(){var t=s.$eval(u.refreshDelay);a.refreshDelay=t!==undefined?t:e.refreshDelay})}}}}]),n.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","uisRepeatParser","uiSelectMinErr","uiSelectConfig",function(t,n,r,i,s,o,u){function l(){if(a.resetSearchInput||a.resetSearchInput===undefined&&u.resetSearchInput)a.search=f,a.selected&&a.items.length&&!a.multiple&&(a.activeIndex=a.items.indexOf(a.selected))}function p(t){var n=!0;switch(t){case e.DOWN:!a.open&&a.multiple?a.activate(!1,!0):a.activeIndex<a.items.length-1&&a.activeIndex++;break;case e.UP:!a.open&&a.multiple?a.activate(!1,!0):(a.activeIndex>0||a.search.length===0&&a.tagging.isActivated&&a.activeIndex>-1)&&a.activeIndex--;break;case e.TAB:(!a.multiple||a.open)&&a.select(a.items[a.activeIndex],!0);break;case e.ENTER:a.open&&a.activeIndex>=0?a.select(a.items[a.activeIndex]):a.activate(!1,!0);break;case e.ESC:a.close();break;default:n=!1}return n}function d(){var e=n.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw o("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(a.activeIndex<0)return;var r=t[a.activeIndex],i=r.offsetTop+r.clientHeight-e[0].scrollTop,s=e[0].offsetHeight;i>s?e[0].scrollTop+=i-s:i<r.clientHeight&&(a.isGrouped&&a.activeIndex===0?e[0].scrollTop=0:e[0].scrollTop-=r.clientHeight-i)}var a=this,f="";a.placeholder=u.placeholder,a.searchEnabled=u.searchEnabled,a.sortable=u.sortable,a.refreshDelay=u.refreshDelay,a.removeSelected=!1,a.closeOnSelect=!0,a.search=f,a.activeIndex=0,a.items=[],a.open=!1,a.focus=!1,a.disabled=!1,a.selected=undefined,a.focusser=undefined,a.resetSearchInput=!0,a.multiple=undefined,a.disableChoiceExpression=undefined,a.tagging={isActivated:!1,fct:undefined},a.taggingTokens={isActivated:!1,tokens:undefined},a.lockChoiceExpression=undefined,a.clickTriggeredSelect=!1,a.$filter=i,a.searchInput=n.querySelectorAll("input.ui-select-search");if(a.searchInput.length!==1)throw o("searchInput","Expected 1 input.ui-select-search but got '{0}'.",a.searchInput.length);a.isEmpty=function(){return angular.isUndefined(a.selected)||a.selected===null||a.selected===""},a.activate=function(e,n){!a.disabled&&!a.open&&(n||l(),t.$broadcast("uis:activate"),a.open=!0,a.activeIndex=a.activeIndex>=a.items.length?0:a.activeIndex,a.activeIndex===-1&&a.taggingLabel!==!1&&(a.activeIndex=0),r(function(){a.search=e||a.search,a.searchInput[0].focus()}))},a.findGroupByName=function(e){return a.groups&&a.groups.filter(function(t){return t.name===e})[0]},a.parseRepeatAttr=function(e,n){function r(e){a.groups=[],angular.forEach(e,function(e){var r=t.$eval(n),i=angular.isFunction(r)?r(e):e[r],s=a.findGroupByName(i);s?s.items.push(e):a.groups.push({name:i,items:[e]})}),a.items=[],a.groups.forEach(function(e){a.items=a.items.concat(e.items)})}function i(e){a.items=e}a.setItemsFn=n?r:i,a.parserResult=s.parse(e),a.isGrouped=!!n,a.itemProperty=a.parserResult.itemName,a.refreshItems=function(e){e=e||a.parserResult.source(t);var n=a.selected;if(angular.isArray(n)&&!n.length||!a.removeSelected)a.setItemsFn(e);else if(e!==undefined){var r=e.filter(function(e){return n.indexOf(e)<0});a.setItemsFn(r)}},t.$watchCollection(a.parserResult.source,function(e){if(e===undefined||e===null)a.items=[];else{if(!angular.isArray(e))throw o("items","Expected an array but got '{0}'.",e);a.refreshItems(e),a.ngModel.$modelValue=null}})};var c;a.refresh=function(e){e!==undefined&&(c&&r.cancel(c),c=r(function(){t.$eval(e)},a.refreshDelay))},a.setActiveItem=function(e){a.activeIndex=a.items.indexOf(e)},a.isActive=function(e){if(!a.open)return!1;var t=a.items.indexOf(e[a.itemProperty]),n=t===a.activeIndex;return!n||t<0&&a.taggingLabel!==!1||t<0&&a.taggingLabel===!1?!1:(n&&!angular.isUndefined(a.onHighlightCallback)&&e.$eval(a.onHighlightCallback),n)},a.isDisabled=function(e){if(!a.open)return;var t=a.items.indexOf(e[a.itemProperty]),n=!1,r;return t>=0&&!angular.isUndefined(a.disableChoiceExpression)&&(r=a.items[t],n=!!e.$eval(a.disableChoiceExpression),r._uiSelectChoiceDisabled=n),n},a.select=function(e,n,i){if(e===undefined||!e._uiSelectChoiceDisabled){if(!a.items&&!a.search)return;if(!e||!e._uiSelectChoiceDisabled){if(a.tagging.isActivated){if(a.taggingLabel===!1)if(a.activeIndex<0){e=a.tagging.fct!==undefined?a.tagging.fct(a.search):a.search;if(!e||angular.equals(a.items[0],e))return}else e=a.items[a.activeIndex];else if(a.activeIndex===0){if(e===undefined)return;if(a.tagging.fct!==undefined&&typeof e=="string"){e=a.tagging.fct(a.search);if(!e)return}else typeof e=="string"&&(e=e.replace(a.taggingLabel,"").trim())}if(a.selected&&angular.isArray(a.selected)&&a.selected.filter(function(t){return angular.equals(t,e)}).length>0){a.close(n);return}}t.$broadcast("uis:select",e);var s={};s[a.parserResult.itemName]=e,r(function(){a.onSelectCallback(t,{$item:e,$model:a.parserResult.modelMapper(t,s)})}),a.closeOnSelect&&a.close(n),i&&i.type==="click"&&(a.clickTriggeredSelect=!0)}}},a.close=function(e){if(!a.open)return;a.ngModel&&a.ngModel.$setTouched&&a.ngModel.$setTouched(),l(),a.open=!1,t.$broadcast("uis:close",e)},a.setFocus=function(){a.focus||a.focusInput[0].focus()},a.clear=function(e){a.select(undefined),e.stopPropagation(),a.focusser[0].focus()},a.toggle=function(e){a.open?(a.close(),e.preventDefault(),e.stopPropagation()):a.activate()},a.isLocked=function(e,t){var n,r=a.selected[t];return r&&!angular.isUndefined(a.lockChoiceExpression)&&(n=!!e.$eval(a.lockChoiceExpression),r._uiSelectChoiceLocked=n),n};var h=null;a.sizeSearchInput=function(){var e=a.searchInput[0],n=a.searchInput.parent().parent()[0],i=function(){return n.clientWidth*!!e.offsetParent},s=function(t){if(t===0)return!1;var n=t-e.offsetLeft-10;return n<50&&(n=t),a.searchInput.css("width",n+"px"),!0};a.searchInput.css("width","10px"),r(function(){h===null&&!s(i())&&(h=t.$watch(i,function(e){s(e)&&(h(),h=null)}))})},a.searchInput.on("keydown",function(n){var i=n.which;t.$apply(function(){var t=!1;if(a.items.length>0||a.tagging.isActivated){p(i);if(a.taggingTokens.isActivated){for(var s=0;s<a.taggingTokens.tokens.length;s++)a.taggingTokens.tokens[s]===e.MAP[n.keyCode]&&a.search.length>0&&(t=!0);t&&r(function(){a.searchInput.triggerHandler("tagged");var t=a.search.replace(e.MAP[n.keyCode],"").trim();a.tagging.fct&&(t=a.tagging.fct(t)),t&&a.select(t,!0)})}}}),e.isVerticalMovement(i)&&a.items.length>0&&d()}),a.searchInput.on("paste",function(e){var t=e.originalEvent.clipboardData.getData("text/plain");if(t&&t.length>0&&a.taggingTokens.isActivated&&a.tagging.fct){var n=t.split(a.taggingTokens.tokens[0]);n&&n.length>0&&(angular.forEach(n,function(e){var t=a.tagging.fct(e);t&&a.select(t,!0)}),e.preventDefault(),e.stopPropagation())}}),a.searchInput.on("tagged",function(){r(function(){l()})}),t.$on("$destroy",function(){a.searchInput.off("keyup keydown tagged blur paste")})}]),n.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,n,r,i,s,o){return{restrict:"EA",templateUrl:function(e,n){var r=n.theme||t.theme;return r+(angular.isDefined(n.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(i,u){return angular.isDefined(u.multiple)?i.append("<ui-select-multiple/>").removeAttr("multiple"):i.append("<ui-select-single/>"),function(i,u,a,f,l){function p(e){if(!c.open)return;var t=!1;window.jQuery?t=window.jQuery.contains(u[0],e.target):t=u[0].contains(e.target);if(!t&&!c.clickTriggeredSelect){var n=["input","button","textarea"],r=angular.element(e.target).scope(),s=r&&r.$select&&r.$select!==c;s||(s=~n.indexOf(e.target.tagName.toLowerCase())),c.close(s),i.$digest()}c.clickTriggeredSelect=!1}function g(){var t=r(u);v=angular.element('<div class="ui-select-placeholder"></div>'),v[0].style.width=t.width+"px",v[0].style.height=t.height+"px",u.after(v),m=u[0].style.width,e.find("body").append(u),u[0].style.position="absolute",u[0].style.left=t.left+"px",u[0].style.top=t.top+"px",u[0].style.width=t.width+"px"}function y(){if(v===null)return;v.replaceWith(u),v=null,u[0].style.position="",u[0].style.left="",u[0].style.top="",u[0].style.width=m}var c=f[0],h=f[1];c.generatedId=t.generateId(),c.baseTitle=a.title||"Select box",c.focusserTitle=c.baseTitle+" focus",c.focusserId="focusser-"+c.generatedId,c.closeOnSelect=function(){return angular.isDefined(a.closeOnSelect)?s(a.closeOnSelect)():t.closeOnSelect}(),c.onSelectCallback=s(a.onSelect),c.onRemoveCallback=s(a.onRemove),c.ngModel=h,c.choiceGrouped=function(e){return c.isGrouped&&e&&e.name},a.tabindex&&a.$observe("tabindex",function(e){c.focusInput.attr("tabindex",e),u.removeAttr("tabindex")}),i.$watch("searchEnabled",function(){var e=i.$eval(a.searchEnabled);c.searchEnabled=e!==undefined?e:t.searchEnabled}),i.$watch("sortable",function(){var e=i.$eval(a.sortable);c.sortable=e!==undefined?e:t.sortable}),a.$observe("disabled",function(){c.disabled=a.disabled!==undefined?a.disabled:!1}),a.$observe("resetSearchInput",function(){var e=i.$eval(a.resetSearchInput);c.resetSearchInput=e!==undefined?e:!0}),a.$observe("tagging",function(){if(a.tagging!==undefined){var e=i.$eval(a.tagging);c.tagging={isActivated:!0,fct:e!==!0?e:undefined}}else c.tagging={isActivated:!1,fct:undefined}}),a.$observe("taggingLabel",function(){a.tagging!==undefined&&(a.taggingLabel==="false"?c.taggingLabel=!1:c.taggingLabel=a.taggingLabel!==undefined?a.taggingLabel:"(new)")}),a.$observe("taggingTokens",function(){if(a.tagging!==undefined){var e=a.taggingTokens!==undefined?a.taggingTokens.split("|"):[",","ENTER"];c.taggingTokens={isActivated:!0,tokens:e}}}),angular.isDefined(a.autofocus)&&o(function(){c.setFocus()}),angular.isDefined(a.focusOn)&&i.$on(a.focusOn,function(){o(function(){c.setFocus()})}),e.on("click",p),i.$on("$destroy",function(){e.off("click",p)}),l(i,function(e){var t=angular.element("<div>").append(e),r=t.querySelectorAll(".ui-select-match");r.removeAttr("ui-select-match"),r.removeAttr("data-ui-select-match");if(r.length!==1)throw n("transcluded","Expected 1 .ui-select-match but got '{0}'.",r.length);u.querySelectorAll(".ui-select-match").replaceWith(r);var i=t.querySelectorAll(".ui-select-choices");i.removeAttr("ui-select-choices"),i.removeAttr("data-ui-select-choices");if(i.length!==1)throw n("transcluded","Expected 1 .ui-select-choices but got '{0}'.",i.length);u.querySelectorAll(".ui-select-choices").replaceWith(i)});var d=i.$eval(a.appendToBody);if(d!==undefined?d:t.appendToBody)i.$watch("$select.open",function(e){e?g():y()}),i.$on("$destroy",function(){y()});var v=null,m=""}}}}]),n.directive("uiSelectMatch",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme,r=t.parent().attr("multiple");return n+(r?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,n,r,i){function s(e){i.allowClear=angular.isDefined(e)?e===""?!0:e.toLowerCase()==="true":!1}i.lockChoiceExpression=r.uiLockChoice,r.$observe("placeholder",function(t){i.placeholder=t!==undefined?t:e.placeholder}),r.$observe("allowClear",s),s(r.allowClear),i.multiple&&i.sizeSearchInput()}}}]),n.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var n=this,r=e.$select,i;e.$evalAsync(function(){i=e.ngModel}),n.activeMatchIndex=-1,n.updateModel=function(){i.$setViewValue(Date.now()),n.refreshComponent()},n.refreshComponent=function(){r.refreshItems(),r.sizeSearchInput()},n.removeChoice=function(i){var s=r.selected[i];if(s._uiSelectChoiceLocked)return;var o={};o[r.parserResult.itemName]=s,r.selected.splice(i,1),n.activeMatchIndex=-1,r.sizeSearchInput(),t(function(){r.onRemoveCallback(e,{$item:s,$model:r.parserResult.modelMapper(e,o)})}),n.updateModel()},n.getPlaceholder=function(){if(r.selected.length)return;return r.placeholder}}],controllerAs:"$selectMultiple",link:function(r,i,s,o){function l(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function c(t){function p(){switch(t){case e.LEFT:return~f.activeMatchIndex?c:s;case e.RIGHT:return!~f.activeMatchIndex||o===s?(u.activate(),!1):a;case e.BACKSPACE:return~f.activeMatchIndex?(f.removeChoice(o),c):s;case e.DELETE:return~f.activeMatchIndex?(f.removeChoice(f.activeMatchIndex),o):!1}}var n=l(u.searchInput[0]),r=u.selected.length,i=0,s=r-1,o=f.activeMatchIndex,a=f.activeMatchIndex+1,c=f.activeMatchIndex-1,h=o;return n>0||u.search.length&&t==e.RIGHT?!1:(u.close(),h=p(),!u.selected.length||h===!1?f.activeMatchIndex=-1:f.activeMatchIndex=Math.min(s,Math.max(i,h)),!0)}function h(e){if(e===undefined||u.search===undefined)return!1;var t=e.filter(function(e){return u.search.toUpperCase()===undefined||e===undefined?!1:e.toUpperCase()===u.search.toUpperCase()}).length>0;return t}function p(e,t){var n=-1;if(angular.isArray(e)){var r=angular.copy(e);for(var i=0;i<r.length;i++)if(u.tagging.fct===undefined)r[i]+" "+u.taggingLabel===t&&(n=i);else{var s=r[i];s.isTag=!0,angular.equals(s,t)&&(n=i)}}return n}var u=o[0],a=r.ngModel=o[1],f=r.$selectMultiple;u.multiple=!0,u.removeSelected=!0,u.focusInput=u.searchInput,a.$parsers.unshift(function(){var e={},t,n=[];for(var i=u.selected.length-1;i>=0;i--)e={},e[u.parserResult.itemName]=u.selected[i],t=u.parserResult.modelMapper(r,e),n.unshift(t);return n}),a.$formatters.unshift(function(e){var t=u.parserResult.source(r,{$select:{search:""}}),n={},i;if(!t)return e;var s=[],o=function(e,t){if(!e||!e.length)return;for(var o=e.length-1;o>=0;o--){n[u.parserResult.itemName]=e[o],i=u.parserResult.modelMapper(r,n);if(u.parserResult.trackByExp){var a=/\.(.+)/.exec(u.parserResult.trackByExp);if(a.length>0&&i[a[1]]==t[a[1]])return s.unshift(e[o]),!0}if(angular.equals(i,t))return s.unshift(e[o]),!0}return!1};if(!e)return s;for(var a=e.length-1;a>=0;a--)o(u.selected,e[a])||o(t,e[a])||s.unshift(e[a]);return s}),r.$watchCollection(function(){return a.$modelValue},function(e,t){t!=e&&(a.$modelValue=null,f.refreshComponent())}),a.$render=function(){if(!angular.isArray(a.$viewValue)){if(!angular.isUndefined(a.$viewValue)&&a.$viewValue!==null)throw t("multiarr","Expected model value to be array but got '{0}'",a.$viewValue);u.selected=[]}u.selected=a.$viewValue,r.$evalAsync()},r.$on("uis:select",function(e,t){u.selected.push(t),f.updateModel()}),r.$on("uis:activate",function(){f.activeMatchIndex=-1}),r.$watch("$select.disabled",function(e,t){t&&!e&&u.sizeSearchInput()}),u.searchInput.on("keydown",function(t){var n=t.which;r.$apply(function(){var r=!1;e.isHorizontalMovement(n)&&(r=c(n)),r&&n!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),u.searchInput.on("keyup",function(t){e.isVerticalMovement(t.which)||r.$evalAsync(function(){u.activeIndex=u.taggingLabel===!1?-1:0});if(u.tagging.isActivated&&u.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;u.activeIndex=u.taggingLabel===!1?-1:0;if(u.taggingLabel===!1)return;var n=angular.copy(u.items),i=angular.copy(u.items),s,o,a=!1,f=-1,l,c;if(u.tagging.fct!==undefined){l=u.$filter("filter")(n,{isTag:!0}),l.length>0&&(c=l[0]),n.length>0&&c&&(a=!0,n=n.slice(1,n.length),i=i.slice(1,i.length)),s=u.tagging.fct(u.search),s.isTag=!0;if(i.filter(function(e){return angular.equals(e,u.tagging.fct(u.search))}).length>0)return;s.isTag=!0}else{l=u.$filter("filter")(n,function(e){return e.match(u.taggingLabel)}),l.length>0&&(c=l[0]),o=n[0],o!==undefined&&n.length>0&&c&&(a=!0,n=n.slice(1,n.length),i=i.slice(1,i.length)),s=u.search+" "+u.taggingLabel;if(p(u.selected,u.search)>-1)return;if(h(i.concat(u.selected))){a&&(n=i,r.$evalAsync(function(){u.activeIndex=0,u.items=n}));return}if(h(i)){a&&(u.items=i.slice(1,i.length));return}}a&&(f=p(u.selected,s)),f>-1?n=n.slice(f+1,n.length-1):(n=[],n.push(s),n=n.concat(i)),r.$evalAsync(function(){u.activeIndex=0,u.items=n})}}),u.searchInput.on("blur",function(){n(function(){f.activeMatchIndex=-1})})}}}]),n.directive("uiSelectSingle",["$timeout","$compile",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(r,i,s,o){var u=o[0],a=o[1];a.$parsers.unshift(function(e){var t={},n;return t[u.parserResult.itemName]=e,n=u.parserResult.modelMapper(r,t),n}),a.$formatters.unshift(function(e){var t=u.parserResult.source(r,{$select:{search:""}}),n={},i;if(t){var s=function(t){return n[u.parserResult.itemName]=t,i=u.parserResult.modelMapper(r,n),i==e};if(u.selected&&s(u.selected))return u.selected;for(var o=t.length-1;o>=0;o--)if(s(t[o]))return t[o]}return e}),r.$watch("$select.selected",function(e){a.$viewValue!==e&&a.$setViewValue(e)}),a.$render=function(){u.selected=a.$viewValue},r.$on("uis:select",function(e,t){u.selected=t}),r.$on("uis:close",function(e,n){t(function(){u.focusser.prop("disabled",!1),n||u.focusser[0].focus()},0,!1)}),r.$on("uis:activate",function(){f.prop("disabled",!0)});var f=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");n(f)(r),u.focusser=f,u.focusInput=f,i.parent().append(f),f.bind("focus",function(){r.$evalAsync(function(){u.focus=!0})}),f.bind("blur",function(){r.$evalAsync(function(){u.focus=!1})}),f.bind("keydown",function(t){if(t.which===e.BACKSPACE){t.preventDefault(),t.stopPropagation(),u.select(undefined),r.$apply();return}if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC)return;if(t.which==e.DOWN||t.which==e.UP||t.which==e.ENTER||t.which==e.SPACE)t.preventDefault(),t.stopPropagation(),u.activate();r.$digest()}),f.bind("keyup input",function(t){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE)return;u.activate(f.val()),f.val(""),r.$digest()})}}}]),n.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,n){return{require:"^uiSelect",link:function(t,r,i,s){if(t[i.uiSelectSort]===null)throw n("sort","Expected a list to sort");var o=angular.extend({axis:"horizontal"},t.$eval(i.uiSelectSortOptions)),u=o.axis,a="dragging",f="dropping",l="dropping-before",c="dropping-after";t.$watch(function(){return s.sortable},function(e){e?r.attr("draggable",!0):r.removeAttr("draggable")}),r.on("dragstart",function(e){r.addClass(a),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text/plain",t.$index)}),r.on("dragend",function(){r.removeClass(a)});var h=function(e,t){this.splice(t,0,this.splice(e,1)[0])},p=function(e){e.preventDefault();var t=u==="vertical"?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0);t<this[u==="vertical"?"offsetHeight":"offsetWidth"]/2?(r.removeClass(c),r.addClass(l)):(r.removeClass(l),r.addClass(c))},d,v=function(t){t.preventDefault();var n=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text/plain"),10);e.cancel(d),d=e(function(){m(n)},20)},m=function(e){var n=t.$eval(i.uiSelectSort),s=n[e],o=null;r.hasClass(l)?e<t.$index?o=t.$index-1:o=t.$index:e<t.$index?o=t.$index:o=t.$index+1,h.apply(n,[e,o]),t.$apply(function(){t.$emit("uiSelectSort:change",{array:n,item:s,from:e,to:o})}),r.removeClass(f),r.removeClass(l),r.removeClass(c),r.off("drop",v)};r.on("dragenter",function(){if(r.hasClass(a))return;r.addClass(f),r.on("dragover",p),r.on("drop",v)}),r.on("dragleave",function(e){if(e.target!=r)return;r.removeClass(f),r.removeClass(l),r.removeClass(c),r.off("dragover",p),r.off("drop",v)})}}}]),n.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){var n=this;n.parse=function(n){var r=n.match(/^\s*(?:([\s\S]+?)\s+as\s+)?([\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!r)throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);return{itemName:r[2],source:t(r[3]),trackByExp:r[4],modelMapper:t(r[1]||r[2])}},n.getGroupNgRepeatExpression=function(){return"$group in $select.groups"},n.getNgRepeatExpression=function(e,t,n,r){var i=e+" in "+(r?"$group.items":t);return n&&(i+=" track by "+n),i}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content dropdown-menu" role="listbox" ng-show="$select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><a href="javascript:void(0)" class="ui-select-choices-row-inner"></a></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty()" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="form-control ui-select-search" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.searchEnabled && $select.open"><div class="ui-select-choices"></div></div>'),e.put("select2/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content select2-results"><li class="ui-select-choices-group" ng-class="{\'select2-result-with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label select2-result-label" ng-bind="$group.name"></div><ul role="listbox" id="ui-select-choices-{{ $select.generatedId }}" ng-class="{\'select2-result-sub\': $select.choiceGrouped($group), \'select2-result-single\': !$select.choiceGrouped($group) }"><li role="option" id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{\'select2-highlighted\': $select.isActive(this), \'select2-disabled\': $select.isDisabled(this)}"><div class="select2-result-label ui-select-choices-row-inner"></div></li></ul></li></ul>'),e.put("select2/match-multiple.tpl.html",'<span class="ui-select-match"><li class="ui-select-match-item select2-search-choice" ng-repeat="$item in $select.selected" ng-class="{\'select2-search-choice-focus\':$selectMultiple.activeMatchIndex === $index, \'select2-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span uis-transclude-append=""></span> <a href="javascript:;" class="ui-select-match-close select2-search-choice-close" ng-click="$selectMultiple.removeChoice($index)" tabindex="-1"></a></li></span>'),e.put("select2/match.tpl.html",'<a class="select2-choice ui-select-match" ng-class="{\'select2-default\': $select.isEmpty()}" ng-click="$select.toggle($event)" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="select2-chosen">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="select2-chosen" ng-transclude=""></span> <abbr ng-if="$select.allowClear && !$select.isEmpty()" class="select2-search-choice-close" ng-click="$select.clear($event)"></abbr> <span class="select2-arrow ui-select-toggle"><b></b></span></a>'),e.put("select2/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple select2 select2-container select2-container-multi" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled}"><ul class="select2-choices"><span class="ui-select-match"></span><li class="select2-search-field"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="select2-input ui-select-search" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-model="$select.search" ng-click="$select.activate()" style="width: 34px;" ondrop="return false;"></li></ul><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="ui-select-choices"></div></div></div>'),e.put("select2/select.tpl.html",'<div class="ui-select-container select2 select2-container" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled, \'select2-container-active\': $select.focus, \'select2-allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="select2-search" ng-show="$select.searchEnabled"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="ui-select-search select2-input" ng-model="$select.search"></div><div class="ui-select-choices"></div></div></div>'),e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices selectize-dropdown single"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup" role="listbox"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="($select.open || $select.isEmpty())" class="ui-select-match" ng-transclude=""></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.activate()"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.searchEnabled || ($select.selected && !$select.open)" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div></div>')}]),function(e,t){function s(){var e={nodiff:"",year:"year",years:"years",month:"month",months:"months",day:"day",days:"days",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",second:"second",seconds:"seconds",delimiter:" "};moment.fn.preciseDiff=function(e){return moment.preciseDiff(this,e)},moment.preciseDiff=function(t,n){function l(t,n){return t+" "+e[n+(t===1?"":"s")]}var r=moment(t),i=moment(n);if(r.isSame(i))return e.nodiff;if(r.isAfter(i)){var s=r;r=i,i=s}var o=i.year()-r.year(),u=i.month()-r.month(),a=i.date()-r.date();if(a<0){var f=moment(i.year()+"-"+(i.month()+1),"YYYY-MM").subtract("months",1).daysInMonth();f<r.date()?a=f+a+(r.date()-f):a=f+a,u--}u<0&&(u=12+u,o--);var c=[];return o&&c.push(l(o,"year")),u&&(o&&c.push(","),c.push(l(u,"month"))),a&&(u&&c.push("and"),c.push(l(a,"day"))),c.join(e.delimiter)}}function o(t,n,r){moment.preciseDiff||s();var i=moment(t,"MMMM DD, YYYY"),o="";if(n)var u=moment(n,"MMMM DD, YYYY");var a=moment();if(n)var f=u.diff(a,"days");else var f=a.diff(i,"days");f<0?o=moment.preciseDiff(i,u):o=moment().preciseDiff(i);var l=a.diff(i,"days");l<=0&&(o="0 days"),e("#initial_join_date").remove();var c="<div class='crm-summary-row' id='initial_join_date'><div class='crm-label'>Length Of Employment</div><div class='crm-content crm-custom-data lengthEmployment'></div></div>";e("#custom-set-content-"+r+" .crm-inline-block-content").append(c),e(".lengthEmployment").html(o),n&&f<0&&e(".lengthEmployment").css({color:"#FF0000"})}var n=CRM.grID,r=e("#custom-set-content-"+n+" .crm-inline-block-content div:nth-child(2) .crm-custom-data").html(),i=e("#custom-set-content-"+n+" .crm-inline-block-content div:nth-child(3) .crm-custom-data").html();r&&o(r,i,n),e(document).on("click","#_qf_CustomData_upload",function(){e(document).ajaxSuccess(function(t,r,i){i.extraData&&i.extraData.class_name=="CRM_Contact_Form_Inline_CustomData"&&i.extraData.groupID==n&&setTimeout(function(){var t=e("#custom-set-content-"+n+" .crm-inline-block-content div:nth-child(2) .crm-custom-data").html(),r=e("#custom-set-content-"+n+" .crm-inline-block-content div:nth-child(3) .crm-custom-data").html();t&&o(t,r,n)},300)})})}(CRM.$,CRM._),define("job-contract/app",["common/angular","job-contract/controllers/controllers","job-contract/controllers/contract-list","job-contract/controllers/contract","job-contract/controllers/revision-list","job-contract/controllers/modal/modal-change-reason","job-contract/controllers/modal/modal-contract","job-contract/controllers/modal/modal-contract-new","job-contract/controllers/modal/modal-dialog","job-contract/controllers/modal/modal-progress","job-contract/controllers/modal/modal-revision","job-contract/controllers/form/form-general","job-contract/controllers/form/form-hour","job-contract/controllers/form/form-health","job-contract/controllers/form/form-pay","job-contract/controllers/form/form-pension","job-contract/directives/directives","job-contract/directives/contact","job-contract/directives/directives","job-contract/directives/loader","job-contract/directives/number","job-contract/directives/validate","job-contract/filters/filters","job-contract/filters/capitalize","job-contract/filters/get-obj-by-id","job-contract/filters/format-amount","job-contract/filters/format-period","job-contract/filters/parse-int","job-contract/services/services","job-contract/services/contract","job-contract/vendor/angular-select","job-contract/vendor/job-summary","common/services/angular-date/date-format","common/modules/routers/compu-ng-route","common/directives/angular-date/date-input"],function(e){"use strict";e.module("hrjc",["ngAnimate","compuNgRoute","ngResource","ui.bootstrap","ui.select","angular-date","common.angularDate","angularFileUpload","hrjc.controllers","hrjc.directives","hrjc.filters","hrjc.services"]).constant("settings",{classNamePrefix:"hrjc-",contactId:CRM.jobContractTabApp.contactId,debug:+CRM.debug,pathApp:CRM.jobContractTabApp.path,pathFile:CRM.url("civicrm/hrjobcontract/file/"),pathReport:CRM.url("civicrm/report/hrjobcontract/summary"),pathRest:CRM.url("civicrm/ajax/rest"),pathTpl:CRM.jobContractTabApp.path+"views/",CRM:{options:CRM.FieldOptions||{},defaultCurrency:CRM.jobContractTabApp.defaultCurrency,apiTsFmt:"YYYY-MM-DD HH:mm:ss",fields:CRM.jobContractTabApp.fields,maxFileSize:CRM.jobContractTabApp.maxFileSize}}).config(["settings","$routeProvider","$resourceProvider","$logProvider","$httpProvider","datepickerConfig","uiSelectConfig",function(e,t,n,r,i,s,o){r.debugEnabled(e.debug),t.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).when("/",{controller:"ContractListCtrl",templateUrl:e.pathApp+"views/contractList.html?v="+(new Date).getTime(),resolve:{contractList:["ContractService",function(e){return e.get()}]}}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",o.theme="bootstrap",s.showWeeks=!1}]).run(["settings","$rootScope","$q","$log","ContractService","ContractDetailsService","ContractHourService","ContractPayService","ContractLeaveService","ContractHealthService","ContractPensionService",function(e,t,n,r,i,s,o,u,a,f,l){r.debug("app.run"),t.pathTpl=e.pathTpl,t.prefix=e.classNamePrefix,n.all({contract:i.getRevisionOptions(),details:s.getOptions(),hour:o.getOptions(),pay:u.getOptions(),leave:a.getOptions(),health:f.getOptions(),pension:l.getOptions()}).then(function(e){e.pay.pay_is_auto_est=["No","Yes"],e.pension.is_enrolled=["No","Yes","Opted out"],r.debug("OPTIONS:"),r.debug(e),t.options=e})}])}),function(){var e=CRM.jobContractTabApp.path+"js/src/job-contract";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"job-contract":e,"job-contract/vendor/angular-select":e+"/vendor/angular/select","job-contract/vendor/fraction":e+"/vendor/fraction","job-contract/vendor/job-summary":e+"/vendor/jobsummary"},shim:{"job-contract/vendor/job-summary":{deps:["common/moment"]}}}),require(["job-contract/app"],function(){"use strict";document.addEventListener("hrjcInit",function(){angular.bootstrap(document.getElementById("hrjob-contract"),["hrjc"])}),document.dispatchEvent(typeof window.CustomEvent=="function"?new CustomEvent("hrjcReady"):function(){var e=document.createEvent("Event");return e.initEvent("hrjcReady",!0,!0),e}())})}(require);