/*
fraction.js
A Javascript fraction library.

Copyright (c) 2009  Erik Garrison <erik@hypervolu.me>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/

// Copyright CiviCRM LLC 2013. See http://civicrm.org/licensing


define("job-contract/controllers/contract.controller",["common/lodash","common/moment"],function(e,t){"use strict";function n(n,o,r,i,a,c,s,l,u,d,f,v,p,m,h,_,b,y,g,j,C,$){function S(t){var n,o;return r.all([v.getOne({jobcontract_revision_id:t.details_revision_id}),p.getOne({jobcontract_revision_id:t.hour_revision_id}),_.getOne({jobcontract_revision_id:t.health_revision_id}),m.getOne({jobcontract_revision_id:t.pay_revision_id}),b.getOne({jobcontract_revision_id:t.pension_revision_id}),h.getOne({jobcontract_revision_id:t.leave_revision_id})]).then(function(t){return o={details:t[0],hour:t[1],health:t[2],pay:t[3],pension:t[4],leave:t[5]},n={contract:c.contract},e.extend(n,e.cloneDeep(c.model)),e.extend(n.details,o.details),e.extend(n.hour,o.hour),e.extend(n.health,o.health),e.extend(n.pay,o.pay),e.extend(n.pension,o.pension),D(n.leave,o.leave),n})}function w(){c.$on("updateContractView",function(){c.$broadcast("hrjc-loader-show"),f.fullDetails(c.revisionCurrent.jobcontract_id).then(function(e){E(e),c.$broadcast("hrjc-loader-hide")}).then(M)})}function D(t,n,o){o=o||"",e.each(t,function(t){e.extend(t,n?e.find(n,{leave_type:t.leave_type})||o:o)})}function R(n,o){var a,s,d,v,p,m,h,_,b=["details","hour","pay"],g={controller:"ModalContractController",appendTo:i.find("div").eq(0),templateUrl:u.baseUrl+"controllers/modal/modal-contract.html",windowClass:"modal-contract",size:"lg",resolve:{action:function(){return n||"view"},content:function(){return{}},entity:function(){return o?I.fetchRevisionDetails(o):{contract:c.contract,details:c.details,hour:c.hour,pay:c.pay,leave:c.leave,health:c.health,pension:c.pension}},files:function(){return o?r.all({details:y.get(o.details_revision_id,"civicrm_hrjobcontract_details"),pension:y.get(o.pension_revision_id,"civicrm_hrjobcontract_pension")}):F},utils:function(){return c.utils}}};switch(c.$broadcast("hrjc-loader-show"),n){case"edit":g.resolve.content=function(){return{allowSave:!0,isDisabled:!1,copy:{close:"Cancel",save:"Save without making a new revision",title:"Edit contract"}}};break;case"change":g.resolve.content=function(){return{allowSave:!0,isDisabled:!1,copy:{close:"Cancel",save:"Save and make a new revision",title:"Change contract terms"}}}}a=l.open(g),a.result.then(function(n){n&&(f.updateHeaderInfo(),E(n),U(n.details.period_end_date),n.revisionCreated?(s=t(new Date(n.revisionCreated.effective_date)),d=t(new Date(c.revisionCurrent.effective_date)),v=t(),p={revisionEntityIdObj:n.revisionCreated,details:n.details,hour:n.hour,pay:n.pay},m=d.diff(v,"day")<=0||d.diff(s,"day")<=0,n.files&&(m?M().then(function(e){p.files=e}):r.all({details:y.get(n.revisionCreated.details_revision_id,"civicrm_hrjobcontract_details")}).then(function(e){p.files=e})),c.revisionList.unshift(n.revisionCreated),c.revisionDataList.unshift(p)):(c.contract.is_primary!==n.contract.is_primary&&c.$parent.$parent.toggleIsPrimary(c.contract.id),e.each(c.revisionDataList,function(t){for(h=0,_={};b[h];)t.revisionEntityIdObj[b[h]+"_revision_id"]===c.revisionCurrent[b[h]+"_revision_id"]&&(_[b[h]]=n[b[h]],"details"===b[h]&&n.files&&M().then(function(n){_.files=n,e.extend(t,_)}),e.extend(t,_)),h++})),CRM.refreshParent("#hrjobroles"),n.haveEntitlementFieldsChanged?$.updateEntitlements(c.contract.contact_id):C.success("Success","Contract successfully updated"))})}function P(e){var t,o=[],a="leave"!==e?"getOne":"get",s=0,f=c.revisionList.length;if(c.$broadcast("hrjc-loader-show"),!e)return null;for(s;s<f;s++)o.push(d[a]("HRJob"+n("capitalize")(e),{jobcontract_revision_id:c.revisionList[s][e+"_revision_id"]}));return t={appendTo:i.find("div").eq(0),size:"lg",controller:"ModalRevisionController",templateUrl:u.baseUrl+"controllers/modal/modal-revision.html",windowClass:"modal-revision",resolve:{entity:function(){return e},fields:function(){return c.$parent.$parent.fields[e]},model:function(){return c.model[e]},utils:function(){return c.utils},revisionDataList:function(){return r.all(o)},revisionList:function(){return c.revisionList},modalContract:function(){return c.modalContract}}},l.open(t)}function A(){c.revisionsShown=!0}function E(t){var n={id:null,jobcontract_id:L,jobcontract_revision_id:t.details.jobcontract_revision_id};e.extend(c.details,t.details),e.extend(c.hour,t.hour||n),e.extend(c.pay,t.pay||n),t.health&&t.health.provider&&t.health.provider!==c.health.provider&&g.getOne(t.health.provider).then(function(e){c.health.provider_contact=e}),t.health&&t.health.provider_life_insurance&&t.health.provider_life_insurance!==c.health.provider_life_insurance&&g.getOne(t.health.provider_life_insurance).then(function(e){c.health.provider_life_insurance_contact=e}),e.extend(c.health,t.health||n),e.extend(c.pension,t.pension||n),D(c.leave,t.leave,n)}function U(n){var o=!n||t().diff(n,"day")<=0,r=c.$parent.contract,i=c.$parent.contractCurrent,a=c.$parent.contractPast,s=i.indexOf(r),l=a.indexOf(r);o?(r.is_current="1",s+1?e.extend(i[s],r):(a.splice(l),i.push(r))):(r.is_current="0",l+1?e.extend(a[l],r):(a.push(r),i.splice(s)))}function M(){return F=r.all({details:y.get(c.details.jobcontract_revision_id,"civicrm_hrjobcontract_details"),pension:y.get(c.pension.jobcontract_revision_id,"civicrm_hrjobcontract_pension")}),F.then(function(e){c.files=e}),F}o.debug("Controller: ContractController");var F,L=c.contract.id,I=this;c.contractLoaded=!1,c.revisionsShown=!1,c.isCollapsed=!0,c.files={},c.revisionCurrent={},c.revisionList=[],c.revisionDataList=[],c.modalContract=R,c.modalRevision=P,c.showRevisions=A,I.fetchRevisionDetails=S,function(){w(),e.extend(c,e.cloneDeep(c.model)),f.fullDetails(L).then(function(e){E(e),c.$watch("contract.is_primary",function(){c.isCollapsed=!+c.contract.is_primary}),c.$broadcast("hrjc-loader-show"),j.fetchRevisions(L).then(function(e){c.revisionList=e.revisionList,c.revisionDataList=e.revisionDataList,c.$broadcast("hrjc-loader-hide"),c.contractLoaded=!0})}).then(M)}()}return n.$inject=["$filter","$log","$q","$rootElement","$route","$scope","$window","$uibModal","settings","apiService","contractService","contractDetailsService","contractHourService","contractPayService","contractLeaveService","contractHealthService","contractPensionService","contractFilesService","contactService","contractRevisionListService","notificationService","utilsService"],{ContractController:n}}),define("job-contract/controllers/contract-list.controller",["common/angular","common/lodash"],function(e,t){"use strict";function n(t,n,o,r,i,a,c,s,l,u,d,f,v,p,m,h,_,b,y,g){function j(e){function t(e,t){var n=0,o=e.length;for(n;n<o;n++)if(+e[n].id==+t)return c.$emit("hrjc-loader-hide"),e.splice(n,1),t;return null}l.open({appendTo:r.find("div").eq(0),templateUrl:y.baseUrl+"controllers/modal/modal-dialog.html",size:"sm",controller:"ModalDialogController",resolve:{content:function(){return{msg:"Are you sure you want to delete this job contract?"}}}}).result.then(function(n){n&&(c.$emit("hrjc-loader-show"),d.delete(e).then(function(n){n.is_error||(d.updateHeaderInfo(),t(c.contractCurrent,e)||t(c.contractPast,e),g.publish("Contract::deleted",{contactId:y.contactId,contractId:e}))}))})}function C(t){if(!t||"new"!==t)return null;var n,i={appendTo:r.find("div").eq(0),templateUrl:y.baseUrl+"controllers/modal/modal-contract.html",size:"lg",controller:"ModalContractNewController",windowClass:"modal-contract",resolve:{model:function(){return c.model},utils:function(){return o.all(e.extend(P,{contractListLen:c.utils.contractListLen}))}}};n=l.open(i),n.result.then(function(e){d.updateHeaderInfo(),+e.is_current?c.contractCurrent.push(e):c.contractPast.push(e),+e.is_primary&&c.toggleIsPrimary(e.id),b.updateEntitlements(e.contact_id)})}function $(e){function n(t){var n=0,o=t.length;for(n;n<o;n++)if(+t[n].id!=+e&&+t[n].is_primary)return t[n].is_primary="0",t[n].id;return null}n(c.contractCurrent)||n(c.contractPast),(t("getObjById")(c.contractCurrent,e)||t("getObjById")(c.contractPast,e)||{}).is_primary="1",c.contractCurrent=t("orderBy")(c.contractCurrent,"-is_primary"),c.contractPast=t("orderBy")(c.contractPast,"-is_primary")}n.debug("Controller: ContractListController");var S,w={},D={},R={details:f,hour:v,pay:p,leave:m,health:h,pension:_},P={hoursLocation:b.getHoursLocation(),payScaleGrade:b.getPayScaleGrade(),absenceTypes:b.getAbsenceTypes()};c.contractCurrent=[],c.contractListLoaded=!1,c.contractPast=[],c.tooltips={changeContractTerms:a.trustAsHtml('<div><p class="text-left"><strong>Change Contract Terms:</strong><br>When an employeees job or role changes, i.e. promotion, secondment or move,you can use this wizard to update the details of the contract and record a newrevision of the contract. A contract history is kept so you can always see theprevious version of the contract.</p><p class="text-left"><strong>Correct an error on the contract record:</strong><br>If you notice an issue or error with the job terms you can correct these withoutcreating a new job history record. These changes are not stored as a new revisionof the contract.</p></div>')},c.utils={contractListLen:u.length},c.delete=j,c.modalContract=C,c.toggleIsPrimary=$,function(){for(S in R)w[S]=R[S].getFields();o.all(w).then(function(e){c.fields=e,n.debug("FIELDS:"),n.debug(e);for(S in R)D[S]=R[S].model(e[S]);return o.all(D)}).then(function(o){c.model=o,n.debug("MODEL:"),n.debug(o),u=t("orderBy")(u,"-is_primary"),e.forEach(u,function(e){+e.is_current?c.contractCurrent.push(e):c.contractPast.push(e)}),c.$watchCollection("contractCurrent",function(){c.utils.contractListLen=c.contractCurrent.length+c.contractPast.length}),c.$watchCollection("contractPast",function(){c.utils.contractListLen=c.contractCurrent.length+c.contractPast.length}),i.$broadcast("hrjc-loader-hide"),c.contractListLoaded=!0}),o.all(P).then(function(t){e.extend(c.utils,t)})}()}return n.$inject=["$filter","$log","$q","$rootElement","$rootScope","$sce","$scope","$window","$uibModal","contractList","contractService","contractDetailsService","contractHourService","contractPayService","contractLeaveService","contractHealthService","contractPensionService","utilsService","settings","pubSub"],{ContractListController:n}}),define("job-contract/controllers/revision-list.controller",["common/angular","common/lodash"],function(e,t){"use strict";function n(t,n,o,r,i,a,c,s,l,u,d,f,v,p,m){function h(){var e=(a.currentPage-1)*a.itemsPerPage,t=e+a.itemsPerPage;a.revisionDataListPage=$.slice(e,t)}function _(e,t){if(1===a.revisionList.length)return void t.stopPropagation();if(e&&"number"==typeof+e){c.open({appendTo:r.find("div").eq(0),templateUrl:s.baseUrl+"controllers/modal/modal-dialog.html",size:"sm",controller:"ModalDialogController",resolve:{content:function(){return{msg:"Are you sure you want to delete this job contract revision?"}}}}).result.then(function(t){t&&(a.$broadcast("hrjc-loader-show"),l.deleteRevision(e).then(function(t){var n=0,o=a.revisionList.length;if(!t.is_error){for(n;n<o;n++)if(a.revisionList[n].id===e){a.revisionList.splice(n,1),a.revisionDataList.splice(n,1);break}if(a.sortBy(),a.createPage(),a.revisionCurrent.id!==g())return void a.$emit("updateContractView");a.$broadcast("hrjc-loader-hide")}}))})}}function b(){a.$watch("currentPage",function(){a.createPage()}),a.$watch("revisionDataList.length",function(e,t){$=a.revisionDataList,e>t&&g(),a.sortBy(),a.createPage()})}function y(e){var t=e.effective_date,n=e.change_reason;c.open({appendTo:r.find("div").eq(0),templateUrl:s.baseUrl+"controllers/modal/modal-change-reason.html",controller:"ModalChangeReasonController",resolve:{content:function(){return{copy:{title:"Edit revision data"}}},date:function(){return t},reasonId:function(){return n}}}).result.then(function(o){o.date===t&&o.reasonId===n||l.saveRevision({id:e.id,change_reason:o.reasonId,effective_date:o.date}).then(function(){e.effective_date=o.date,e.change_reason=o.reasonId,a.sortBy(),a.createPage(),a.revisionCurrent.id!==g()&&a.$emit("updateContractView")})})}function g(){var n,o=0;if(a.revisionList.length){var r=t("orderBy")(a.revisionList,["effective_date","id"]);if(e.forEach(r,function(e){new Date(e.effective_date).setHours(0,0,0,0)<=(new Date).setHours(0,0,0,0)&&(n=e)}),!n)do{n=r[o],o++}while(r[o]&&r[o-1].effective_date===r[o].effective_date);return e.extend(a.revisionCurrent,n),n.id}return null}function j(e,n){void 0!==e&&(a.sortCol===e?a.sortReverse=!a.sortReverse:a.sortCol=e),void 0!==n&&(a.sortReverse=n),$=t("orderBy")(a.revisionDataList,a.sortCol,a.sortReverse)}n.debug("Controller: RevisionListController");var C=a.contract.id,$=a.revisionDataList;a.changeReasons=i.options.contract.change_reason,a.currentPage=1,a.itemsPerPage=5,a.maxSize=5,a.sortCol="revisionEntityIdObj.effective_date",a.sortReverse=!0,a.urlCSV=function(){var t=s.pathReport+(s.pathReport.indexOf("?")>-1?"&":"?"),n=a.fields;return e.forEach(n,function(n,o){t+="fields["+o+"_revision_id]=1&",e.forEach(n,function(e){t+="fields["+o+"_"+e.name+"]=1&"})}),t+="fields[sort_name]=1&fields[first_name]=1&fields[last_name]=1&fields[external_identifier]=1&fields[email]=1&fields[street_address]=1&fields[city]=1&fields[name]=1&fields[contract_contact_id]=1&fields[contract_contract_id]=1&fields[jobcontract_revision_id]=1&fields[change_reason]=1&fields[created_date]=1&fields[effective_date]=1&fields[modified_date]=1&order_bys[1][column]=id&order_bys[1][order]=ASC&order_bys[2][column]=civicrm_hrjobcontract_revision_revision_id&order_bys[2][order]=ASC&order_bys[3][column]=-&order_bys[3][order]=ASC&order_bys[4][column]=-&order_bys[4][order]=ASC&order_bys[5][column]=-&order_bys[5][order]=ASC&contract_id_op=eq&permission=access+CiviReport&row_count=&_qf_Summary_submit_csv=Preview+CSV&groups=&contract_id_value="+C+"&group_bys[civicrm_hrjobcontract_revision_revision_id]=1"}(),a.display={effectiveDate:!0,position:!0,payScale:!0,totalSalary:!0,hours:!0,placeOfWork:!0,recordedBy:!0,changeReason:!0},a.createPage=h,a.deleteRevision=_,a.modalRevisionEdit=y,a.sortBy=j,function(){b(),a.revisionDataList||(a.$broadcast("hrjc-loader-show"),m.fetchRevisions(C).then(function(e){a.revisionList=e.revisionList,a.revisionDataList=e.revisionDataList,a.$broadcast("hrjc-loader-hide")}))}()}return n.$inject=["$filter","$log","$q","$rootElement","$rootScope","$scope","$uibModal","settings","contractService","contractDetailsService","contractHourService","contractPayService","contractFilesService","contractRevisionService","contractRevisionListService"],{RevisionListController:n}}),define("job-contract/controllers/form/form-general.controller",["common/moment"],function(e){"use strict";function t(t,n,o){function r(e,t){e.preventDefault(),e.stopPropagation(),n[t]=!0}function i(t,n){if(!t||!n)return null;var o,r,i,a;return i=e(n),i.add(1,"days"),a=i.diff(t,"years"),i.add(-a,"years"),r=i.diff(t,"months"),i.add(-r,"months"),o=i.diff(t,"days"),a=a>0?a>1?a+" years ":a+" year ":"",r=r>0?r>1?r+" months ":r+" month ":"",o=o>0?o>1?o+" days":o+" day":"",a+r+o||"0 days"}function a(t,n){return n=n||"min",e(t)["max"===n?"subtract":"add"](1,"day").toDate()}function c(){n.$watch("entity.details.period_start_date",function(){n.datepickerOptions.end.minDate=a(s.period_start_date,"min"),n.duration=i(s.period_start_date,s.period_end_date)}),n.$watch("entity.details.period_end_date",function(){s.period_end_date?n.datepickerOptions.start.maxDate=a(s.period_end_date,"max"):(n.datepickerOptions.start.maxDate=null,s.end_reason=null),n.duration=i(s.period_start_date,s.period_end_date)}),n.$watch("entity.details.position",function(e,t){e!==t&&s.title===t&&(n.contractForm.detailsTitle.$setViewValue(e),n.contractForm.detailsTitle.$render())}),n.$watch("entity.details.notice_amount",function(e,t){+e&&!s.notice_unit&&(n.contractForm.detailsNoticeUnit.$setValidity("required",!1),n.contractForm.detailsNoticeUnit.$dirty=!0),e!==t&&s.notice_amount_employee===t&&(s.notice_amount_employee=e)}),n.$watch("entity.details.notice_amount_employee",function(e){+e&&!s.notice_unit_employee&&(n.contractForm.detailsNoticeUnitEmployee.$setValidity("required",!1),n.contractForm.detailsNoticeUnitEmployee.$dirty=!0)}),n.$watch("entity.details.notice_unit",function(e,t){e!==t&&s.notice_unit_employee===t&&(s.notice_unit_employee=e)})}t.debug("Controller: FormGeneralController");var s=n.entity.details;n.format=o.DATE_FORMAT,n.datepickerOptions=function(){return{start:{maxDate:s.period_end_date?a(s.period_end_date,"max"):null},end:{minDate:s.period_start_date?a(s.period_start_date,"min"):null}}}(),n.dpOpen=r,function(){c()}()}return t.$inject=["$log","$scope","HR_settings"],{FormGeneralController:t}}),define("job-contract/controllers/form/form-health.controller",[],function(){"use strict";function e(e,t,n){function o(e,o){e&&n.search(e,{contact_type:"Organization",contact_sub_type:o}).then(function(e){t.contacts[o]=e})}e.debug("Controller: FormHealthController"),t.contacts={Health_Insurance_Provider:[],Life_Insurance_Provider:[]},t.refreshContacts=o,function(){t.entity.health.provider&&n.getOne(t.entity.health.provider).then(function(e){t.contacts.Health_Insurance_Provider.push(e)}),t.entity.health.provider_life_insurance&&n.getOne(t.entity.health.provider_life_insurance).then(function(e){t.contacts.Life_Insurance_Provider.push(e)})}()}return e.$inject=["$log","$scope","contactService"],{FormHealthController:e}}),define("job-contract/vendor/fraction",[],function(){var e=function(t,n){if(void 0!==t&&n)"number"==typeof t&&"number"==typeof n?(this.numerator=t,this.denominator=n):"string"==typeof t&&"string"==typeof n&&(this.numerator=parseInt(t),this.denominator=parseInt(n));else if(void 0===n)if(num=t,"number"==typeof num)this.numerator=num,this.denominator=1;else if("string"==typeof num){var o,r,i=num.split(" ");if(i[0]&&(o=i[0]),i[1]&&(r=i[1]),o%1==0&&r&&r.match("/"))return new e(o).add(new e(r));if(!o||r)return;if("string"==typeof o&&o.match("/")){var a=o.split("/");this.numerator=a[0],this.denominator=a[1]}else{if("string"==typeof o&&o.match("."))return new e(parseFloat(o));this.numerator=parseInt(o),this.denominator=1}}this.normalize()};return e.prototype.clone=function(){return new e(this.numerator,this.denominator)},e.prototype.toString=function(){if("NaN"===this.denominator)return"NaN";var e=this.numerator/this.denominator>0?Math.floor(this.numerator/this.denominator):Math.ceil(this.numerator/this.denominator),t=this.numerator%this.denominator,n=this.denominator,o=[];return 0!=e&&o.push(e),0!=t&&o.push((0===e?t:Math.abs(t))+"/"+n),o.length>0?o.join(" "):0},e.prototype.rescale=function(e){return this.numerator*=e,this.denominator*=e,this},e.prototype.add=function(t){var n=this.clone();return t=t instanceof e?t.clone():new e(t),td=n.denominator,n.rescale(t.denominator),t.rescale(td),n.numerator+=t.numerator,n.normalize()},e.prototype.subtract=function(t){var n=this.clone();return t=t instanceof e?t.clone():new e(t),td=n.denominator,n.rescale(t.denominator),t.rescale(td),n.numerator-=t.numerator,n.normalize()},e.prototype.multiply=function(t){var n=this.clone();if(t instanceof e)n.numerator*=t.numerator,n.denominator*=t.denominator;else{if("number"!=typeof t)return n.multiply(new e(t));n.numerator*=t}return n.normalize()},e.prototype.divide=function(t){var n=this.clone();if(t instanceof e)n.numerator*=t.denominator,n.denominator*=t.numerator;else{if("number"!=typeof t)return n.divide(new e(t));n.denominator*=t}return n.normalize()},e.prototype.equals=function(t){t instanceof e||(t=new e(t));var n=this.clone().normalize(),t=t.clone().normalize();return n.numerator===t.numerator&&n.denominator===t.denominator},e.prototype.normalize=function(){var t=function(e){return"number"==typeof e&&(e>0&&e%1>0&&e%1<1||e<0&&e%-1<0&&e%-1>-1)},n=function(e,t){if(t){var n=Math.pow(10,t);return Math.round(e*n)/n}return Math.round(e)};return function(){if(t(this.denominator)){var o=n(this.denominator,9),r=Math.pow(10,o.toString().split(".")[1].length);this.denominator=Math.round(this.denominator*r),this.numerator*=r}if(t(this.numerator)){var o=n(this.numerator,9),r=Math.pow(10,o.toString().split(".")[1].length);this.numerator=Math.round(this.numerator*r),this.denominator*=r}var i=e.gcf(this.numerator,this.denominator);return this.numerator/=i,this.denominator/=i,(this.numerator<0&&this.denominator<0||this.numerator>0&&this.denominator<0)&&(this.numerator*=-1,this.denominator*=-1),this}}(),e.gcf=function(t,n){var o=[],r=e.primeFactors(t),i=e.primeFactors(n);return r.forEach(function(e){var t=i.indexOf(e);t>=0&&(o.push(e),i.splice(t,1))}),0===o.length?1:function(){var e,t=o[0];for(e=1;e<o.length;e++)t*=o[e];return t}()},e.primeFactors=function(e){for(var t=Math.abs(e),n=[],o=2;o*o<=t;)t%o==0?(n.push(o),t/=o):o++;return 1!=t&&n.push(t),n},e}),define("job-contract/controllers/form/form-hour.controller",["common/lodash","job-contract/vendor/fraction"],function(e,t){"use strict";function n(n,o,r,i){function a(){i.$watch("entity.hour.location_standard_hours",function(e){d=o("getObjById")(u,e),c(d,l.hours_type),s(d.standard_hours,l.hours_amount)}),i.$watch("entity.hour.hours_type",function(e,t){e!==t&&(c(d,e),s(d.standard_hours,l.hours_amount))}),i.$watch("entity.hour.hours_amount",function(e,t){e!==t&&s(d.standard_hours,e)}),i.$watch("entity.hour.hours_unit",function(e,t){e!==t&&s(d.standard_hours,l.hours_amount)})}function c(e,t){if(i.hrsTypeDefined=!!l.hours_type,i.hrsAmountDefined=!!l.hours_amount,l.hours_unit=e.periodicity,!i.hrsTypeDefined||i.hrsAmountDefined&&"FULL_TIME"!==f[+t])i.hrsAmountDefined||i.hrsAmountDefined||(l.hours_amount="",l.hours_unit="");else switch(f[+t]){case"FULL_TIME":l.hours_amount=e.standard_hours;break;case"PART_TIME":l.hours_amount=Math.round(e.standard_hours/2);break;case"CASUAL":l.hours_amount=0;break;default:l.hours_amount=""}}function s(e,n){n=parseFloat(n)||0,e=parseFloat(e)||0;var o=new t(n,e);l.fte_num=String(+l.hours_type?o.numerator:0),l.fte_denom=String(+l.hours_type?o.denominator:0),l.hours_fte=String(parseFloat((l.fte_num/l.fte_denom||0).toFixed(2))),i.fteFraction=l.fte_num+"/"+l.fte_denom}n.debug("Controller: FormHourController");var l=i.entity.hour,u=i.utils.hoursLocation,d={},f={0:"CASUAL",4:"PART_TIME",8:"FULL_TIME"};i.hrsTypeDefined=!1,i.hrsAmountDefined=!1,function(){l.location_standard_hours=l.location_standard_hours||e.get(u,"[0].id"),d=o("getObjById")(u,l.location_standard_hours),a()}()}return n.$inject=["$log","$filter","$rootScope","$scope"],{FormHourController:n}}),define("job-contract/controllers/form/form-leave.controller",["common/lodash"],function(e){"use strict";function t(e,t,n){function o(){r()}function r(){n.getNumberOfPublicHolidaysInCurrentPeriod().then(function(e){i.numberOfPublicHolidays=e})}e.debug("Controller: FormLeaveController");var i=this;i.$onInit=o,i.numberOfPublicHolidays=0}return t.$inject=["$log","$scope","utilsService"],{FormLeaveController:t}}),define("job-contract/controllers/form/form-pay.controller",[],function(){"use strict";function e(e,t,n,o){function r(e){e.push({name:"",type:"",amount_pct:"",amount_abs:""})}function i(){if(_.pay_scale){var t=e("getObjById")(y,_.pay_scale);_.pay_amount=t.amount||b.pay_amount,_.pay_currency=t.currency||b.pay_currency,_.pay_unit=t.pay_frequency||b.pay_unit}}function a(){+_.is_paid&&(_.pay_annualized_est=(_.pay_amount*g[_.pay_unit]||0).toFixed(2))}function c(){if(+_.is_paid){var e=0,t=_.annual_benefits.length,o=0;for(e;e<t;e++)2==+_.annual_benefits[e].type&&(_.annual_benefits[e].amount_abs=(_.annual_benefits[e].amount_pct/100*_.pay_annualized_est).toFixed(2)),o+=+_.annual_benefits[e].amount_abs;n.benefits_per_cycle=(o/f()).toFixed(2)}}function s(){+_.is_paid&&(n.benefits_per_cycle_net=n.benefits_per_cycle-n.deductions_per_cycle)}function l(){if(+_.is_paid){var e=0,t=_.annual_deductions.length,o=0;for(e;e<t;e++)2==+_.annual_deductions[e].type&&(_.annual_deductions[e].amount_abs=(_.annual_deductions[e].amount_pct/100*_.pay_annualized_est).toFixed(2)),o+=+_.annual_deductions[e].amount_abs;n.deductions_per_cycle=(o/f()).toFixed(2)}}function u(){+_.is_paid&&(_.pay_per_cycle_gross=(_.pay_annualized_est/f()).toFixed(2))}function d(){+_.is_paid&&(_.pay_per_cycle_net=(+_.pay_per_cycle_gross+ +n.benefits_per_cycle_net).toFixed(2))}function f(){var e=1;switch(+_.pay_cycle){case 1:e=g.Week;break;case 2:e=g.Month;break;case 3:e=g.Biweekly;break;case 4:e=g.Bimonthly}return e}function v(){n.$watch("entity.pay.pay_amount",n.calcAnnualPayEst),n.$watch("entity.pay.pay_unit",n.calcAnnualPayEst),n.$watch("entity.pay.pay_annualized_est",function(){n.calcPayPerCycleGross(),n.calcBenefitsPerCycle(),n.calcDeductionsPerCycle()}),n.$watch("entity.pay.annual_benefits",n.calcBenefitsPerCycle,!0),n.$watch("entity.pay.annual_deductions",n.calcDeductionsPerCycle,!0),n.$watch("benefits_per_cycle",n.calcBenefitsPerCycleNet),n.$watch("deductions_per_cycle",n.calcBenefitsPerCycleNet),n.$watch("benefits_per_cycle_net",n.calcPayPerCycleNet),n.$watch("entity.pay.pay_per_cycle_gross",n.calcPayPerCycleNet)}function p(e,t){e.splice(t,1)}function m(){_.pay_scale="",_.pay_amount="",_.pay_unit="",_.pay_currency="",_.pay_annualized_est="",_.pay_is_auto_est="",_.annual_benefits=[],_.annual_deductions=[],_.pay_cycle="",_.pay_per_cycle_gross="",_.pay_per_cycle_net="",n.benefits_per_cycle="",n.deductions_per_cycle=""}function h(){_.pay_cycle=b.pay_cycle,_.pay_currency=b.pay_currency,_.pay_is_auto_est="0",_.pay_amount=(0).toFixed(2)}t.debug("Controller: FormPayController");var _=n.entity.pay||{},b={pay_amount:0,pay_currency:o.CRM.defaultCurrency,pay_cycle:"2",pay_unit:"Year"},y=n.utils.payScaleGrade,g={Year:1,Month:12,Bimonthly:24,Week:52,Biweekly:104,Fortnight:26,Day:260,Hour:2080};n.collapseBenDed=!(_.annual_benefits&&_.annual_benefits.length||_.annual_deductions&&_.annual_deductions.length),n.benefits_per_cycle=(0).toFixed(2),n.benefits_per_cycle_net=0,n.deductions_per_cycle=(0).toFixed(2),n.add=r,n.applyPayScaleGradeData=i,n.calcAnnualPayEst=a,n.calcBenefitsPerCycle=c,n.calcBenefitsPerCycleNet=s,n.calcDeductionsPerCycle=l,n.calcPayPerCycleGross=u,n.calcPayPerCycleNet=d,n.remove=p,n.resetData=m,n.setDefaults=h,function(){_.is_paid=_.is_paid||0,_.pay_is_auto_est="0",_.annual_benefits=_.annual_benefits||[],_.annual_deductions=_.annual_deductions||[],v()}()}return e.$inject=["$filter","$log","$scope","settings"],{FormPayController:e}}),define("job-contract/controllers/form/form-pension.controller",[],function(){"use strict";function e(e,t,n,o){function r(e,n){e&&o.search(e,{contact_type:"Organization",contact_sub_type:n}).then(function(e){t.contacts[n]=e})}e.debug("Controller: FormPensionController"),t.contacts={Pension_Provider:[]},t.refreshContacts=r,function(){t.entity.pension.pension_type&&o.getOne(t.entity.pension.pension_type).then(function(e){t.contacts.Pension_Provider.push(e)})}()}return e.$inject=["$log","$scope","settings","contactService"],{FormPensionController:e}}),define("job-contract/controllers/modal/modal-change-reason.controller",["common/moment"],function(e){"use strict";function t(t,n,o,r,i,a,c,s,l,u){function d(){o.dismiss("cancel")}function f(e,t){e.preventDefault(),e.stopPropagation(),n[t]=!0}function v(){n.$watch("effective_date",function(e){n.isPast=new Date(e).setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)})}function p(){l.validateEffectiveDate({contact_id:s.contactId,effective_date:n.effective_date}).then(function(t){t.success?o.close({reasonId:n.change_reason,date:n.effective_date?e(n.effective_date).format("YYYY-MM-DD"):""}):(CRM.alert(t.message,"Error","error"),n.$broadcast("hrjc-loader-hide"))})}function m(){r.loadForm("/civicrm/admin/options/hrjc_revision_change_reason?reset=1").on("crmUnload",function(){u.getRevisionOptions("change_reason",!0).then(function(e){n.options.contract.change_reason=e.obj})})}var h;t.debug("Controller: ModalChangeReasonController"),i=i||{},h=i.copy||{},h.title=h.title||"Revision data",n.change_reason=c||"",n.copy=h,n.effective_date=a||"",n.isPast=!1,n.cancel=d,n.dpOpen=f,n.openRevisionChangeReasonEditor=m,n.save=p,function(){v()}()}return t.$inject=["$log","$scope","$uibModalInstance","crmAngService","content","date","reasonId","settings","contractRevisionService","contractService"],{ModalChangeReasonController:t}}),define("job-contract/controllers/modal/modal-contract-new.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function o(o,r,i,a,c,s,l,u,d,f,v,p,m,h,_,b,y,g,j,C,$,S,w,D){function R(){l.dismiss("cancel")}function P(){var e,t,n,o,r,i,a,c=s.fileMaxSize,l=!0,u=s.uploader;for(e in u){r=u[e];for(t in r)for(n=0,o=a.length,i=r[t],a=i.queue;n<o&&l;n++)l=a[n].file.size<c}s.contractForm.$setValidity("maxFileSize",l)}function A(){(new f).$save({action:"create",json:{sequential:1,contact_id:w.contactId,is_primary:S.contractListLen?s.entity.contract.is_primary:1}},function(t){var o,a,c,d=t.values[0],f=d.id,j=e.copy(s.entity.details),C=s.entity.hour,S=s.entity.pay,R=s.entity.leave,P=s.entity.health,A=s.entity.pension,E=[],U=s.uploader;d.is_current=!j.period_end_date||n().diff(j.period_end_date,"day")<=0,$.prepareEntityIds(j,f),p.save(j).then(function(e){c=e.jobcontract_revision_id},function(e){return CRM.alert(e,"Error","error"),v.delete(f),l.dismiss(),r.reject()}).then(function(){return e.forEach(s.entity,function(e){$.prepareEntityIds(e,f,c)}),a=[m.save(C),h.save(S),_.save(R),b.save(P),y.save(A)],s.uploader.details.contract_file.queue.length&&E.push(g.upload(U.details.contract_file,c)),s.uploader.pension.evidence_file.queue.length&&E.push(g.upload(U.pension.evidence_file,c)),E.length&&(o=u.open({appendTo:i.find("div").eq(0),templateUrl:w.baseUrl+"controllers/modal/modal-progress.html",size:"sm",controller:"ModalProgressController",resolve:{uploader:function(){return U},promiseFilesUpload:function(){return E}}}),a.push(o.result)),r.all(a)}).then(function(){s.$broadcast("hrjc-loader-hide"),l.close(d),D.publish("Contract::created",w.contactId)},function(e){CRM.alert(e,"Error","error"),v.delete(f).then(function(e){s.$broadcast("hrjc-loader-hide"),e.is_error&&CRM.alert(e.error_message||"Unknown error","Error","error")},function(e){s.$broadcast("hrjc-loader-hide"),CRM.alert(e||"Unknown error","Error","error")})})},function(e){return s.$broadcast("hrjc-loader-hide"),l.dismiss(),CRM.alert(e.statusText||"Unknown error","Error","error"),r.reject()})}function E(){return r.all([{name:"hrjobcontract_health_health_plan_type",key:"plan_type"},{name:"hrjobcontract_health_life_insurance_plan_type",key:"plan_type_life_insurance"}].map(function(e){b.getOptions(e.name,!0).then(function(n){a.options.health[e.key]=t.transform(n,function(e,t){e[t.key]=t.value},{})})}))}function U(){s.$broadcast("hrjc-loader-show"),p.validateDates({contact_id:w.contactId,period_start_date:s.entity.details.period_start_date,period_end_date:s.entity.details.period_end_date}).then(function(e){e.success?A():(CRM.alert(e.message,"Error","error"),s.$broadcast("hrjc-loader-hide"))},function(e){})}function M(){s.entity.leave&&s.entity.leave.forEach(function(e,t){var n=s.entity.leave[t].leave_type;s.entity.leave[t].leave_amount=S.absenceTypes[n].default_entitlement,s.entity.leave[t].add_public_holidays=S.absenceTypes[n].add_public_holiday_to_entitlement})}function F(e,n){var o={hrjobcontract_details_contract_type:"contract_type",hrjobcontract_details_location:"location",hrjobcontract_details_end_reason:"end_reason",hrjobcontract_health_health_plan_type:"provider_life_insurance"};d.loadForm(e).on("crmUnload",function(){"hrjobcontract_health_health_plan_type"===n?b.getOptions(n,!0).then(function(e){var n=t.mapValues(t.keyBy(e,"key"),"value");a.options.health.plan_type=n,a.options.health.plan_type_life_insurance=n}):p.getOptions(n,!0).then(function(e){a.options.details[o[n]]=e.obj})})}function L(){d.loadForm("/civicrm/standard_full_time_hours?reset=1").on("crmUnload",function(){$.getHoursLocation().then(function(e){s.utils.hoursLocation=e})})}function I(){d.loadForm("/civicrm/pay_scale?reset=1").on("crmUnload",function(){$.getPayScaleGrade().then(function(e){s.utils.payScaleGrade=e})})}function q(){d.loadForm("/civicrm/admin/options/hrjc_benefit_name?reset=1").on("crmUnload",function(){T("hrjc_benefit_name","benefit_name")
})}function H(){d.loadForm("/civicrm/admin/options/hrjc_deduction_name?reset=1").on("crmUnload",function(){T("hrjc_deduction_name","deduction_name")})}function T(e,n){return C.valuesOf(e,!1).then(function(e){a.options.pay[n]=t.mapValues(t.keyBy(e,"value"),"label")})}o.debug("Controller: ModalContractNewController"),s.allowSave=!0,s.action="new",s.entity={},s.fileMaxSize=w.CRM.maxFileSize||0,s.isDisabled=!1,s.showIsPrimary=S.contractListLen,s.utils=S,s.copy={close:"Cancel",save:"Add New Job Contract",title:"Add New Job Contract"},s.tooltips={fileSize:c.trustAsHtml("<p>THE FILE IS TOO LARGE AND CANNOT BE UPLOADED. PLEASE REDUCE THE SIZE OF THE FILE AND TRY AGAIN.</p>"),fte:c.trustAsHtml("<div><strong>FTE</strong> stands forFull Time Equivalent. This is a useful measure foran organisation that has peopleworking part-time.For a full-time person, FTE is always equal to1.0, whereas for a part-time person, the FTE will representthe fraction of standard hours that the person works on aregular basis.<br>E.g. if the standard working day at an organisationcomprises of 8 hours, then a person who regularly works for8 hours each day would be considered to be full- time andwould have an FTE value of 1.0. A person who regularly worksfor only 4 hours each day would be considered to be apart-time person and would have an FTE value of 0.5. If theorganisation had 10 people, each with an FTE of 1.0 theactual headcount of full-time people would be 10 and theFTE headcount (equal to actual headcount multiplied by theFTE value) would also be 10. However, if the organisationhad another 10 people who each worked part-time with an FTEvalue of 0.5 the actual headcount of part-time people wouldbe 10 while the FTE headcount would only be 5. Thus for anorganisation that had a total of 10 full-time people, and 10part-time people (each with an FTE of 0.5) the actualheadcount for the organisation would be 20 while the FTEheadcount would be 15.</div>")},s.uploader={details:{contract_file:g.uploader("civicrm_hrjobcontract_details")},pension:{evidence_file:g.uploader("civicrm_hrjobcontract_pension",1)}},s.cancel=R,s.filesValidate=P,s.openOptionsEditor=F,s.openHoursLocationOptionsEditor=L,s.openPayScaleGradeOptionsEditor=I,s.openAnnualBenefitOptionsEditor=q,s.openAnnualDeductionOptionsEditor=H,s.save=U,function(){e.copy(j,s.entity),s.entity.contract={is_primary:0},e.forEach(s.uploader,function(t){e.forEach(t,function(e){e.onAfterAddingAll=function(){s.filesValidate()}})}),M(),a.$broadcast("hrjc-loader-show"),E().then(function(){a.$broadcast("hrjc-loader-hide")})}()}return o.$inject=["$log","$q","$rootElement","$rootScope","$sce","$scope","$uibModalInstance","$uibModal","crmAngService","Contract","contractService","contractDetailsService","contractHourService","contractPayService","contractLeaveService","contractHealthService","contractPensionService","contractFilesService","model","OptionGroup","utilsService","utils","settings","pubSub"],{ModalContractNewController:o}}),define("job-contract/controllers/modal/modal-contract.controller",["common/angular","common/lodash","common/moment"],function(e,t,n){"use strict";function o(o,r,i,a,c,s,l,u,d,f,v,p,m,h,_,b,y,g,j,C,$,S,w,D,R,P,A){function E(){if("view"===g||e.equals(j,o.entity)&&e.equals($,o.files)&&!o.uploader.details.contract_file.queue.length&&!o.uploader.pension.evidence_file.queue.length)return o.$broadcast("hrjc-loader-hide"),void i.dismiss("cancel");R.debug&&e.forEach(j,function(t,n){e.equals(t,o.entity[n])||(P.debug("======================"),P.debug("Changed entity: "+n),P.debug("Before:"),P.debug(t),P.debug("After:"),P.debug(o.entity[n]))}),r.open({appendTo:c.find("div").eq(0),templateUrl:R.baseUrl+"controllers/modal/modal-dialog.html",size:"sm",controller:"ModalDialogController",resolve:{content:function(){return{copyCancel:"No",title:"Alert",msg:"Are you sure you want to cancel? Changes will be lost!"}}}}).result.then(function(e){e&&(o.$broadcast("hrjc-loader-hide"),i.dismiss("cancel"))})}function U(){return r.open({appendTo:c.find("div").eq(0),templateUrl:R.baseUrl+"controllers/modal/modal-change-reason.html",controller:"ModalChangeReasonController",resolve:{content:function(){return{copy:{title:K.title}}},date:null,reasonId:null}}).result}function M(){var t=k("period_end_date"),n=k("period_start_date"),r=!e.equals(o.entity.leave,j.leave);return n||t||r}function F(){return r.open({appendTo:c.find("div").eq(0),templateUrl:R.baseUrl+"controllers/modal/modal-dialog-edit.html",controller:"ModalDialogController",resolve:{content:function(){return{msg:"Save without making a new revision?"}}}}).result}function L(e,t){return o.$broadcast("hrjc-loader-show"),f.validateEffectiveDate({contact_id:R.contactId,effective_date:t}).then(function(n){if(n.success)return Y(e,t);CRM.alert(n.message,"Error","error"),o.$broadcast("hrjc-loader-hide")},function(e){})}function I(){o.$broadcast("hrjc-loader-show"),o.entity.details.period_end_date=o.entity.details.period_end_date||"";var t,n,s,l,u,f=e.copy(o.entity),g=o.filesTrash,j=o.uploader,C={contract:d.save(f.contract),details:v.save(f.details),hour:p.save(f.hour),pay:m.save(f.pay),leave:h.save(f.leave),health:_.save(f.health),pension:b.save(f.pension)},$=[],S=[];for(t in g)for(s=0,l=g[t].length,s;s<l;s++)n=g[t][s],S.push(y.delete(n.fileID,n.entityID,n.entityTable));e.extend(C,{files:!!S.length&&a.all(S)}),a.all(C).then(function(t){return e.forEach(j,function(t){e.forEach(t,function(t){e.forEach(t.queue,function(e){e.file.size>o.fileMaxSize&&e.remove()})})}),j.details.contract_file.queue.length&&$.push(y.upload(j.details.contract_file,f.details.jobcontract_revision_id)),j.pension.evidence_file.queue.length&&$.push(y.upload(j.pension.evidence_file,f.pension.jobcontract_revision_id)),t.details.period_start_date=f.details.period_start_date,t.details.period_end_date=f.details.period_end_date,t.pay.annual_benefits=f.pay.annual_benefits,t.pay.annual_deductions=f.pay.annual_deductions,$.length?(u=r.open({appendTo:c.find("div").eq(0),templateUrl:R.baseUrl+"controllers/modal/modal-progress.html",size:"sm",controller:"ModalProgressController",resolve:{uploader:function(){return j},promiseFilesUpload:function(){return $}}}),t.files=u.result,a.all(t)):(t.haveEntitlementFieldsChanged=M(),t)}).then(function(e){o.$broadcast("hrjc-loader-hide"),i.close(e),A.publish("Contract::updated")},function(e){o.$broadcast("hrjc-loader-hide"),CRM.alert(e,"Error","error")})}function q(e){var t=l("formatDate")(e,Date);return"Unspecified"!==t?t:e}function H(){return a.all([{name:"hrjobcontract_health_health_plan_type",key:"plan_type"},{name:"hrjobcontract_health_life_insurance_plan_type",key:"plan_type_life_insurance"}].map(function(e){_.getOptions(e.name,!0).then(function(n){s.options.health[e.key]=t.transform(n,function(e,t){e[t.key]=t.value},{})})}))}function T(e,t){var n=o.files[t];o.filesTrash[t].push(n[e]),n.splice(e,1)}function O(){var e=t.every(o.uploader,function(e){return t.every(e,function(e){return!e.queue||t.every(e.queue,function(e){return e.file.size<o.fileMaxSize})})});o.contractForm.$setValidity("maxFileSize",e)}function x(){e.copy($,o.files),e.forEach(o.files,function(e,t){o.filesTrash[t]=[]}),e.forEach(o.uploader,function(t){e.forEach(t,function(e){e.onAfterAddingAll=function(){o.filesValidate()}})})}function k(e){var t,r,i,a;return i=j.details[e]||null,t=o.entity.details[e]||null,a=!(t&&i||t===i),r=n.isDate(t)&&!n(i).isSame(n(t),"day"),a||r}function B(){e.copy(j,o.entity),o.entity.details.period_start_date=q(o.entity.details.period_start_date),o.entity.details.period_end_date=q(o.entity.details.period_end_date)}function z(){if(e.equals(j,o.entity)&&e.equals($,o.files)&&!o.uploader.details.contract_file.queue.length&&!o.uploader.pension.evidence_file.queue.length)return o.$broadcast("hrjc-loader-hide"),void i.dismiss("cancel");switch(g){case"edit":o.entity.contract.is_primary===j.contract.is_primary?F().then(function(e){switch(e){case"edit":I();break;case"change":U().then(function(e){return L(e.reasonId,e.date)})}}):I();break;case"change":U().then(function(e){L(e.reasonId,e.date)});break;default:o.$broadcast("hrjc-loader-hide"),i.dismiss("cancel")}}function N(){o.allowSave&&(o.$broadcast("hrjc-loader-show"),v.validateDates({contact_id:R.contactId,period_start_date:o.entity.details.period_start_date,period_end_date:o.entity.details.period_end_date,jobcontract_id:j.contract.id}).then(function(e){e.success?z():(CRM.alert(e.message,"Error","error"),o.$broadcast("hrjc-loader-hide"))},function(e){}),o.$broadcast("hrjc-loader-hide"))}function Y(t,n){var s,l,u=[],f=e.copy(o.entity),g=o.filesTrash,C=o.uploader,$={},S=[],D=[],P={details:v,hour:p,pay:m,leave:h,health:_,pension:b};for(var E in P){var U=!e.equals(j[E],f[E]);if(!U&&!(U=!!g[E]&&!!g[E].length)&&C[E])for(var F in C[E]){var L=C[E][F];if(L.queue.length){U=!0;break}}U&&u.push({name:E,data:f[E],service:P[E]})}u.length?(w.prepareEntityIds(u[0].data,j.contract.id),u[0].service.save(u[0].data).then(function(o){return l=e.isArray(o)?o[0].jobcontract_revision_id:o.jobcontract_revision_id,$[u[0].name]=o,u.slice(1).forEach(function(e){w.prepareEntityIds(e.data,j.contract.id,l),$[e.name]=e.service.save(e.data)}),a.all(e.extend($,{revisionCreated:d.saveRevision({id:l,change_reason:t,effective_date:n})},{files:!1}))}).then(function(t){for(E in P)t[E]=t[E]||f[E],g[E]&&g[E].length&&g[E].forEach(function(e){S.push(y.delete(e.fileID,l,e.entityTable))});return t.details.period_start_date=f.details.period_start_date,t.details.period_end_date=f.details.period_end_date,t.revisionCreated.effective_date=n||"",t.pay.annual_benefits=f.pay.annual_benefits,t.pay.annual_deductions=f.pay.annual_deductions,e.extend(t.revisionCreated,{details_revision_id:t.details.jobcontract_revision_id,health_revision_id:t.health.jobcontract_revision_id,hour_revision_id:t.hour.jobcontract_revision_id,jobcontract_id:j.contract.id,leave_revision_id:t.leave[0].jobcontract_revision_id,pay_revision_id:t.pay.jobcontract_revision_id,pension_revision_id:t.pension.jobcontract_revision_id}),S.length?(t.files=a.all(S),a.all(t)):t}).then(function(e){return u.forEach(function(e){if(C[e.name])for(var t in C[e.name])L=C[e.name][t],L.queue.forEach(function(e){e.file.size>o.fileMaxSize&&e.remove()}),L.queue.length&&D.push(y.upload(L,l))}),D.length?(s=r.open({appendTo:c.find("div").eq(0),templateUrl:R.baseUrl+"controllers/modal/modal-progress.html",size:"sm",controller:"ModalProgressController",resolve:{uploader:function(){return C},promiseFilesUpload:function(){return D}}}),e.files=s.result,a.all(e)):(e.haveEntitlementFieldsChanged=M(),e)}).then(function(e){o.$broadcast("hrjc-loader-hide"),i.close(e),A.publish("Contract::updated")})):(o.$broadcast("hrjc-loader-hide"),i.close())}function J(e,n){var o={hrjobcontract_details_contract_type:"contract_type",hrjobcontract_details_location:"location",hrjobcontract_details_end_reason:"end_reason",hrjobcontract_health_health_plan_type:"provider_life_insurance"};u.loadForm(e).on("crmUnload",function(){"hrjobcontract_health_health_plan_type"===n?_.getOptions(n,!0).then(function(e){var n={};t.each(e,function(e){n[e.key]=e.value}),s.options.health.plan_type=n,s.options.health.plan_type_life_insurance=n}):v.getOptions(n,!0).then(function(e){s.options.details[o[n]]=e.obj})})}function V(){u.loadForm("/civicrm/standard_full_time_hours?reset=1").on("crmUnload",function(){w.getHoursLocation().then(function(e){o.utils.hoursLocation=e})})}function G(){u.loadForm("/civicrm/pay_scale?reset=1").on("crmUnload",function(){w.getPayScaleGrade().then(function(e){o.utils.payScaleGrade=e})})}function W(){u.loadForm("/civicrm/admin/options/hrjc_benefit_name?reset=1").on("crmUnload",function(){Z("hrjc_benefit_name","benefit_name")})}function X(){u.loadForm("/civicrm/admin/options/hrjc_deduction_name?reset=1").on("crmUnload",function(){Z("hrjc_deduction_name","deduction_name")})}function Z(e,n){return S.valuesOf(e,!1).then(function(e){s.options.pay[n]=t.mapValues(t.keyBy(e,"value"),"label")})}P.debug("Controller: ModalContractController");var K=C.copy||{};K.close=K.close||"Close",K.save=K.save||"Save changes",K.title=K.title||"Contract",o.action=g||"view",o.allowSave=void 0!==C.allowSave&&C.allowSave,o.copy=K,o.entity={},o.fileMaxSize=R.CRM.maxFileSize||0,o.files={},o.filesTrash={},o.isDisabled=void 0===C.isDisabled||C.isDisabled,o.isPrimaryDisabled=+j.contract.is_primary,o.showIsPrimary=D.contractListLen>1&&"change"!==g,o.uploader={details:{contract_file:y.uploader("civicrm_hrjobcontract_details")},pension:{evidence_file:y.uploader("civicrm_hrjobcontract_pension",1)}},o.utils=D,o.cancel=E,o.fileMoveToTrash=T,o.filesValidate=O,o.save=N,o.openOptionsEditor=J,o.openHoursLocationOptionsEditor=V,o.openPayScaleGradeOptionsEditor=G,o.openAnnualBenefitOptionsEditor=W,o.openAnnualDeductionOptionsEditor=X,function(){B(),x(),i.opened.then(function(){s.$broadcast("hrjc-loader-hide")}),s.$broadcast("hrjc-loader-show"),H().then(function(){s.$broadcast("hrjc-loader-hide")})}()}return o.$inject=["$scope","$uibModal","$uibModalInstance","$q","$rootElement","$rootScope","$filter","crmAngService","contractService","contractRevisionService","contractDetailsService","contractHourService","contractPayService","contractLeaveService","contractHealthService","contractPensionService","contractFilesService","action","entity","content","files","OptionGroup","utilsService","utils","settings","$log","pubSub"],{ModalContractController:o}}),define("job-contract/controllers/modal/modal-dialog.controller",[],function(){"use strict";function e(e,t,n,o,r){function i(){o.dismiss("Cancel")}function a(e){o.close(e||!0)}e.debug("Controller: ModalDialogController"),t.copyCancel=r.copyCancel||"Cancel",t.copyConfirm=r.copyConfirm||"Yes",t.msg=r.msg||"",t.title=r.title||"CiviHR Job Contract",t.cancel=i,t.confirm=a}return e.$inject=["$log","$scope","$timeout","$uibModalInstance","content"],{ModalDialogController:e}}),define("job-contract/controllers/modal/modal-progress.controller",[],function(){"use strict";function e(e,t,n,o,r,i,a){function c(){r.dismiss("File upload canceled")}e.debug("Controller: ModalProgressController");var s,l;n.uploader=i,n.cancel=c,function(){for(s in i)for(l in i[s])i[s][l].queue.length&&(i[s][l].item=i[s][l].queue[0].file.name),i[s][l].onProgressItem=function(e){this.item=e.file.name};t.all(a).then(function(e){o(function(){r.close(e)},500)})}()}return e.$inject=["$log","$q","$scope","$timeout","$uibModalInstance","uploader","promiseFilesUpload"],{ModalProgressController:e}}),define("job-contract/controllers/modal/modal-revision.controller",["common/angular"],function(e){"use strict";function t(t,n,o,r,i,a,c,s,l,u,d,f,v,p,m){function h(){a.dismiss("cancel")}function _(){var e=(i.currentPage-1)*i.itemsPerPage,t=e+i.itemsPerPage;i.revisionDataListPage=i.revisionDataList.slice(e,t)}function b(){var e,t=0,n=i.fields.length;for(t;t<n;t++)e=i.fields[t],e.selected=!0,e.isArray="leave_type"===e.name||"leave_amount"===e.name,"id"!==e.name&&"jobcontract_revision_id"!==e.name?e.display=!0:e.display=!1;i.fields.unshift({name:"effective_date",title:"Effective Date",display:!0,selected:!0,isArray:!1,extends:!0}),i.fields.push({name:"editor_name",title:"Change Recorded By",display:!0,selected:!0,isArray:!1,extends:!0},{name:"change_reason",title:"Reason For Change",display:!0,selected:!0,isArray:!1,extends:!0})}function y(){var n,o,a=0,c=s.length;for(a;a<c;a++)n=a+1,o=n===c,s[a]||(s[a]=f),o||s[n]||(s[n]=f),e.isArray(s[a])&&(s[a]={jobcontract_revision_id:s[a][0].jobcontract_revision_id,data:s[a]}),e.extend(s[a],{effective_date:t("date")(l[a].effective_date,"yyyy/MM/dd")||"",editor_name:l[a].editor_name||"",change_reason:r.options.contract.change_reason[l[a].change_reason]||"",details_revision_id:l[a].details_revision_id,health_revision_id:l[a].health_revision_id,hour_revision_id:l[a].hour_revision_id,leave_revision_id:l[a].leave_revision_id,pay_revision_id:l[a].pay_revision_id,pension_revision_id:l[a].pension_revision_id,role_revision_id:l[a].role_revision_id}),i.revisionDataList.push(s[a])}function g(){switch(u){case"hour":!function(){var n;e.forEach(i.revisionDataList,function(e){e.location_standard_hours&&(n=t("filter")(p.hoursLocation,{id:e.location_standard_hours})[0],e.location_standard_hours=n.location+": "+n.standard_hours+"h per "+n.periodicity)})}();break;case"health":e.forEach(i.revisionDataList,function(e){e.provider&&m.getOne(e.provider).then(function(t){e.provider=t.label}),e.provider_life_insurance&&m.getOne(e.provider_life_insurance).then(function(t){e.provider_life_insurance=t.label})});break;case"pay":!function(){var n;e.forEach(i.revisionDataList,function(e){e.pay_scale&&(n=t("filter")(p.payScaleGrade,{id:e.pay_scale})[0]||t("filter")(p.payScaleGrade,{pay_scale:e.pay_scale})[0],e.pay_scale=n.pay_scale+(n.currency?" - "+r.options.pay.pay_currency[n.currency]:"")+(n.amount?" "+n.amount:"")+(n.pay_frequency?" per "+n.pay_frequency:""))})}(),t("filter")(i.fields,{name:"pay_is_auto_est"})[0].pseudoconstant=!0,i.subFields={annual_benefits:[{name:"name",title:"Benefit",pseudoconstant:"benefit_name"},{name:"type",title:"Type",pseudoconstant:"benefit_type"},{name:"amount_pct",title:"% amount",pseudoconstant:!1},{name:"amount_abs",title:"Absolute amount",pseudoconstant:!1}],annual_deductions:[{name:"name",title:"Deduction",pseudoconstant:"deduction_name"},{name:"type",title:"Type",pseudoconstant:"deduction_type"},{name:"amount_pct",title:"% amount",pseudoconstant:!1},{name:"amount_abs",title:"Absolute amount",pseudoconstant:!1}]};break;case"pension":t("filter")(i.fields,{name:"is_enrolled"})[0].pseudoconstant=!0}}function j(){i.$watch("currentPage",function(){i.createPage()})}function C(e,n){void 0!==e&&(i.sortCol===e?i.sortReverse=!i.sortReverse:i.sortCol=e),void 0!==n&&(i.sortReverse=n),i.revisionDataList=t("orderBy")(i.revisionDataList,i.sortCol,i.sortReverse)}function $(e){e.selected=!e.selected,i.urlCSV=S()}function S(){var t,n,o=c.pathReport+(c.pathReport.indexOf("?")>-1?"&":"?"),r=i.entity;return e.forEach(i.fields,function(e){t="editor_name"!==e.name?e.name:"editor_uid",n=e.extends?"":r+"_",e.selected&&(o+="fields["+n+t+"]=1&")}),o+="fields[sort_name]=1&fields[first_name]=1&fields[last_name]=1&fields[external_identifier]=1&fields[email]=1&fields[street_address]=1&fields[city]=1&fields[name]=1&fields[contract_contact_id]=1&fields[contract_contract_id]=1&fields[jobcontract_revision_id]=1&fields[change_reason]=1&fields[created_date]=1&fields[effective_date]=1&fields[modified_date]=1&order_bys[1][column]=id&order_bys[1][order]=ASC&order_bys[2][column]=civicrm_hrjobcontract_revision_revision_id&order_bys[2][order]=ASC&order_bys[3][column]=-&order_bys[3][order]=ASC&order_bys[4][column]=-&order_bys[4][order]=ASC&order_bys[5][column]=-&order_bys[5][order]=ASC&contract_id_op=eq&permission=access+CiviReport&row_count=&_qf_Summary_submit_csv=Preview+CSV&groups=&contract_id_value="+l[0].jobcontract_id+"&group_bys[civicrm_hrjobcontract_revision_revision_id]=1"}n.debug("Controller: ModalRevisionController"),i.$broadcast("hrjc-loader-show"),i.currentPage=1,i.entity=u,i.fields=e.copy(d),i.itemsPerPage=5,i.revisionDataList=[],i.revisionList=[],i.sortCol="effective_date",i.subFields={},i.maxSize=5,i.modalContract=v,i.sortReverse=!0,i.urlCSV=S(),i.cancel=h,i.createPage=_,i.sortBy=C,i.toggleFieldsSelected=$,function(){b(),y(),g(),j(),i.sortBy(),a.opened.then(function(){r.$broadcast("hrjc-loader-hide")})}()}return t.$inject=["$filter","$log","$q","$rootScope","$scope","$uibModalInstance","settings","revisionDataList","revisionList","entity","fields","model","modalContract","utils","contactService"],{ModalRevisionController:t}}),define("job-contract/directives/contact.directive",[],function(){"use strict";function e(e,t,n,o){return t.debug("Directive: hrjcContact"),{restrict:"A",scope:{renderAsLink:"=?hrjcContactLink",contactId:"=?hrjcContact"},template:"{{contact.label}}",link:function(t,n){t.contactId&&t.$watch("contactId",function(r){o.getOne(t.contactId).then(function(o){t.contact=o,t.renderAsLink&&(n.html('<a ng-href="/civicrm/contact/view?reset=1&cid={{contactId}}">{{contact.label}}</a>'),e(n.contents())(t))})})}}}return e.$inject=["$compile","$log","settings","contactService"],{hrjcContact:e}}),define("job-contract/directives/loader.directive",[],function(){"use strict";function e(e,t){return e.debug("Directive: hrjcLoader"),{link:function(e,t,n){function o(){var e=window.getComputedStyle(t[0]).position;return"relative"===e||"absolute"===e||"fixed"===e}function r(){o()||(t.css("position","relative"),s=!0),t.append(a),c=!0}function i(){c&&a.parentNode.removeChild(a),c=!1,s&&t.css("position","")}var a=document.createElement("div"),c=!1,s=!1;a.className="hrjc-loader spinner",n.hrjcLoaderShow&&r(),e.$on("hrjc-loader-show",function(){r()}),e.$on("hrjc-loader-hide",function(){i()})}}}return e.$inject=["$log","$rootScope"],{hrjcLoader:e}}),define("job-contract/directives/number.directive",[],function(){"use strict";function e(e){return e.debug("Directive: hrjcNumber"),{require:"ngModel",link:function(e,t,n,o){var r=2,i=n.hrjcNumberFloat||!1,a=n.hrjcToHours||!1,c=n.hrjcNotNegative||!1;n.hrjcNumber&&"number"==typeof+n.hrjcNumber&&(r=n.hrjcNumber),t.bind("blur",function(){var e=parseFloat(o.$viewValue)||0;c&&e<0&&(e=0),a&&(e=.25*Math.ceil(e/.25)),o.$setViewValue(i?Math.round(100*e)/100:e.toFixed(r)),o.$render()})}}}return e.$inject=["$log"],{hrjcNumber:e}}),define("job-contract/directives/validate.directive",["common/angular"],function(e){"use strict";function t(t){return t.debug("Directive: hrjcValidate"),{restrict:"A",require:"^form",scope:{isWarning:"=?hrjcValidateWarning"},link:function(t,n,o,r){function i(e,t){n.toggleClass("has-success",!e&&!t),f.toggleClass("glyphicon-ok",!e&&!t)}function a(e,t){n.toggleClass("has-warning",!e&&t),f.toggleClass("glyphicon-warning-sign",!e&&t)}function c(e){n.toggleClass("has-error",e),f.toggleClass("glyphicon-remove",e)}var s=n[0].querySelector("[name]"),l=e.element(s),u=l.attr("name"),d=document.createElement("span"),f=e.element(d);u&&(n.addClass("has-feedback"),f.addClass("glyphicon form-control-feedback"),l.after(f),t.$watch(function(){return r[u]&&r[u].$invalid},function(e){r[u].$dirty&&(i(e,t.isWarning),c(e))}),void 0!==t.isWarning&&t.$watch("isWarning",function(e){var t=r[u].$invalid;r[u].$dirty&&(i(t,e),a(t,e))}),l.bind("blur",function(){c(r[u].$invalid)}))}}}return t.$inject=["$log"],{hrjcValidate:t}}),define("job-contract/filters/capitalize.filter",[],function(){"use strict";function e(e){return e.debug("Filter: capitalize"),function(e){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}return e.$inject=["$log"],{capitalize:e}}),define("job-contract/filters/format-amount.filter",[],function(){"use strict";function e(e){return e.debug("Filter: formatAmount"),function(e){return e&&-1===e.indexOf(".")?e+".00":e}}return e.$inject=["$log"],{formatAmount:e}}),define("job-contract/filters/format-period.filter",[],function(){"use strict";function e(e,t){return t.debug("Filter: formatPeriod"),function(t){return t?e("date")(t,"yyyy/MM/dd"):"Unspecified"}}return e.$inject=["$filter","$log"],{formatPeriod:e}}),define("job-contract/filters/get-obj-by-id.filter",[],function(){"use strict";function e(e){return e.debug("Filter: getObjById"),function(e,t,n){if(!e)return null;for(var o=0,r=e.length;o<r;o++)if(+e[o].id==+t)return n?e[o][n]:e[o];return null}}return e.$inject=["$log"],{getObjById:e}}),define("job-contract/filters/parse-integer.filter",[],function(){"use strict";function e(e){return e.debug("Filter: parseInteger"),function(e){return e?parseInt(e):null}}return e.$inject=["$log"],{parseInteger:e}}),define("job-contract/services/api.service",["common/angular"],function(e){"use strict";function t(t,n,o,r){return r.debug("Service: apiService"),{resource:function(e,n,r){return!e||"string"!=typeof e||!n||"string"!=typeof n||r&&"object"!=typeof r?null:t(o.pathRest,{action:n,entity:e,json:r})},getOne:function(t,o){if(!t||"string"!=typeof t||o&&"object"!=typeof o)return null;var r,i=n.defer(),a=e.extend({sequential:1},o);return this.resource(t,"get",a).get(function(e){r=e.values,i.resolve(1===r.length?r[0]:null)},function(){i.reject("Unable to fetch data")}),i.promise},get:function(t,o){if(!t||"string"!=typeof t||o&&"object"!=typeof o)return null;var r=n.defer(),i=e.extend({sequential:1},o);return this.resource(t,"get",i).get(function(e){r.resolve(e.values)},function(){r.reject("Unable to fetch data")}),r.promise}}}return t.$inject=["$resource","$q","settings","$log"],{apiService:t}}),define("job-contract/services/contact.service",[],function(){"use strict";function e(e,t,n,o,r){r.debug("Service: contactService");var i=e(t.pathRest,{action:"getlist",entity:"contact",json:{}});return{getOne:function(e){if(!e||"number"!=typeof+e)return null;var r,a=n.defer();return i.get({json:{id:e,debug:t.debug}},function(e){o.errorHandler(e,"Unable to fetch contact",a)||(r=e.values,a.resolve(1===r.length?r[0]:null))},function(){a.reject("Unable to fetch contact")}),a.promise},search:function(e,r){if(!e||void 0===e||r&&"object"!=typeof r)return null;var a=n.defer();return r=r||{},i.get({json:{input:e,params:r,debug:t.debug}},function(e){o.errorHandler(e,"Unable to fetch contact list",a)||a.resolve(e.values)},function(){a.reject("Unable to fetch contact list")}),a.promise}}}return e.$inject=["$resource","settings","$q","utilsService","$log"],{contactService:e}}),define("job-contract/services/contract.service",[],function(){"use strict";function e(e,t,n){return n.debug("Service: Contract"),e(t.pathRest,{action:"get",entity:"HRJobContract",json:{}})}return e.$inject=["$resource","settings","$log"],{Contract:e}}),define("job-contract/services/contract-details.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,o,r,i,a,c){function s(e){var t=n("formatDate")(e,"YYYY-MM-DD");return"Unspecified"!==t?t:e}c.debug("Service: contractDetailsService");var l=o(r.pathRest,{action:"get",entity:"HRJobDetails",json:{}});return{validateDates:function(e){if(!e||"object"!=typeof e||!e.contact_id||!e.period_start_date)return null;e.period_start_date=s(e.period_start_date),e.period_end_date=s(e.period_end_date),e.sequential=0,e.debug=r.debug;var t,n=i.defer();return l.save({action:"validatedates",json:e},null,function(e){a.errorHandler(e,'Unable to fetch API "validatedates" response',n)||(t=e.values,n.resolve(t))}),n.promise},getOne:function(e){if(!e||"object"!=typeof e||!e.jobcontract_id&&!e.jobcontract_revision_id||e.jobcontract_id&&"number"!=typeof+e.jobcontract_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id)return null;e.sequential=1,e.debug=r.debug;var t,n=i.defer();return l.get({json:e},function(e){a.errorHandler(e,"Unable to fetch contract details",n)||(t=e.values,n.resolve(1===t.length?t[0]:null))},function(){n.reject("Unable to fetch contract details")}),n.promise},getOptions:function(e,n){var o,a=i.defer(),c={arr:[],obj:{}};return n?CRM.api3("HRJobDetails","getoptions",{sequential:1,field:e}).done(function(e){c.obj=t.mapValues(t.keyBy(e.values,"key"),"value"),c.arr=t.values(t.keyBy(e.values,"key")),a.resolve(c)}):(o=r.CRM.options.HRJobDetails||{},e&&"string"==typeof e&&(o=o[e]),a.resolve(o||{})),a.promise},getFields:function(e){if(e&&"object"!=typeof e)return null;e&&"object"==typeof e||(e={});var t=i.defer(),n=r.CRM.fields;return n&&n.HRJobDetails?t.resolve(n.HRJobDetails):(e.sequential=1,l.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract details fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract details fields")})),t.promise},save:function(t){if(!t||"object"!=typeof t)return null;t.period_start_date=s(t.period_start_date),t.period_end_date=s(t.period_end_date);var n,o=i.defer(),c=e.extend({sequential:1,debug:r.debug},t);return l.save({action:"create",json:c},null,function(e){a.errorHandler(e,"Unable to create contract details",o)||(n=e.values,o.resolve(1===n.length?n[0]:null))},function(){o.reject("Unable to create contract details")}),o.promise},model:function(e){function t(e){var t=0,n=e.length,o={};for(t;t<n;t++)o[e[t].name]="";return void 0!==o.id&&(o.id=null),void 0!==o.jobcontract_revision_id&&(o.jobcontract_revision_id=null),void 0!==o.location&&(o.location=null),o}var n=i.defer();return e?n.resolve(t(e)):this.getFields().then(function(e){n.resolve(t(e))}),n.promise}}}return n.$inject=["$filter","$resource","settings","$q","utilsService","$log"],{contractDetailsService:n}}),define("job-contract/services/contract-files.service",[],function(){"use strict";function e(e,t,n,o,r,i){i.debug("Service: contractFilesService");var a=e(t.pathFile+":action");return r.prototype.queueDelete=[],{delete:function(e,t,r){if(!e||"number"!=typeof+e||!t||"number"!=typeof+t||!r||"string"!=typeof r)return null;var i=n.defer();return a.save({action:"delete",entityTable:r,entityID:t,fileID:e},null,function(e){e.values&&!+e.values[0].result&&(e.is_error=1),o.errorHandler(e,"Unable to delete file",i)||i.resolve(e.values[0])},function(){i.reject("Unable to delete file")}),i.promise},get:function(e,t){if(!e||"number"!=typeof+e||!t||"string"!=typeof t)return null;var r=n.defer();return a.get({action:"list",entityTable:t,entityID:e},function(e){o.errorHandler(e,"Unable to fetch files",r)||r.resolve(e.values)},function(){r.reject("Unable to fetch files")}),r.promise},uploader:function(e,n){if(!e||"string"!=typeof e)return null;var o={url:t.pathFile+"upload",formData:[{entityTable:e}]};return n&&"number"==typeof n&&(o.queueLimit=n),new r(o)},upload:function(e,t){if(!e||"object"!=typeof e||!t||"number"!=typeof+t)return null;var o=n.defer(),r=[];return e.onBeforeUploadItem=function(e){e.formData.push({entityID:t})},e.onCompleteItem=function(e,t){r.push(t)},e.onErrorItem=function(e,t,n,r){o.reject("Could not upload file: "+e.file.name),i.error(" ===== Item Error: "+n+" ======"),i.error(" =====  - item ======"),i.error(e),i.error(" =====  - response ======"),i.error(t),i.error(" =====  - headers ======"),i.error(r)},e.onCompleteAll=function(){o.resolve(r)},e.uploadAll(),o.promise}}}return e.$inject=["$resource","settings","$q","utilsService","FileUploader","$log"],{contractFilesService:e}}),define("job-contract/services/contract-health.service",["common/angular"],function(e){"use strict";function t(t,n,o,r,i){i.debug("Service: contractHealthService");var a=t(n.pathRest,{action:"get",entity:"HRJobHealth",json:{}});return{getOne:function(e){if(!e||"object"!=typeof e||!e.jobcontract_revision_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id)return null;e.sequential=1,e.debug=n.debug;var t,i=o.defer();return a.get({json:e},function(e){r.errorHandler(e,"Unable to fetch contract Health",i)||(t=e.values,i.resolve(1===t.length?t[0]:null))},function(){i.reject("Unable to fetch contract Health")}),i.promise},getOptions:function(e,t){var r,i=o.defer(),c={};return t?(c.sequential=1,e&&"string"==typeof e&&(c.field=e),a.get({action:"getoptions",json:c},function(e){e.values||i.reject("Unable to fetch contract insurance options"),i.resolve(e.values)},function(){i.reject("Unable to fetch contract insurance options")})):(r=n.CRM.options.HRJobHealth||{},e&&"string"==typeof e&&(r=r[e]),i.resolve(r||{})),i.promise},getFields:function(e){if(e&&"object"!=typeof e)return null;e&&"object"==typeof e||(e={});var t=o.defer(),r=n.CRM.fields;return r&&r.HRJobHealth?t.resolve(r.HRJobHealth):(e.sequential=1,a.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract insurance fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract insurance fields")})),t.promise},save:function(t){if(!t||"object"!=typeof t)return null;var i,c=o.defer(),s=e.extend({sequential:1,debug:n.debug},t);return a.save({action:"create",json:s},null,function(e){r.errorHandler(e,"Unable to create contract insurance",c)||(i=e.values,c.resolve(1===i.length?i[0]:null))},function(){
c.reject("Unable to create contract insurance")}),c.promise},model:function(e){function t(e){var t=0,n=e.length,o={};for(t;t<n;t++)o[e[t].name]="";return void 0!==o.id&&(o.id=null),void 0!==o.jobcontract_revision_id&&(o.jobcontract_revision_id=null),o}var n=o.defer();return e?n.resolve(t(e)):this.getFields().then(function(e){n.resolve(t(e))}),n.promise}}}return t.$inject=["$resource","settings","$q","utilsService","$log"],{contractHealthService:t}}),define("job-contract/services/contract-hour.service",["common/angular"],function(e){"use strict";function t(t,n,o,r,i){i.debug("Service: contractHourService");var a=t(n.pathRest,{action:"get",entity:"HRJobHour",json:{}});return{getOne:function(e){if(!e||"object"!=typeof e||!e.jobcontract_revision_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id)return null;e.sequential=1,e.debug=n.debug;var t,i=o.defer();return a.get({json:e},function(e){r.errorHandler(e,"Unable to fetch contract hours",i)||(t=e.values,i.resolve(1===t.length?t[0]:null))},function(){i.reject("Unable to fetch contract hours")}),i.promise},getOptions:function(e,t){var r,i=o.defer();return t||(r=n.CRM.options.HRJobHour||{},e&&"string"==typeof e&&(r=r[e]),i.resolve(r||{})),i.promise},getFields:function(e){if(e&&"object"!=typeof e)return null;e&&"object"==typeof e||(e={});var t=o.defer(),r=n.CRM.fields;return r&&r.HRJobHour?t.resolve(r.HRJobHour):(e.sequential=1,a.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract hours fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract hours fields")})),t.promise},save:function(t){if(!t||"object"!=typeof t)return null;var i,c=o.defer(),s=e.extend({sequential:1,debug:n.debug},t);return a.save({action:"create",json:s},null,function(e){r.errorHandler(e,"Unable to create contract hours",c)||(i=e.values,c.resolve(1===i.length?i[0]:null))},function(){c.reject("Unable to create contract hours")}),c.promise},model:function(e){function t(e){var t=0,n=e.length,o={};for(t;t<n;t++)o[e[t].name]="";return void 0!==o.id&&(o.id=null),void 0!==o.jobcontract_revision_id&&(o.jobcontract_revision_id=null),o}var n=o.defer();return e?n.resolve(t(e)):this.getFields().then(function(e){n.resolve(t(e))}),n.promise}}}return t.$inject=["$resource","settings","$q","utilsService","$log"],{contractHourService:t}}),define("job-contract/services/contract-leave.service",["common/lodash"],function(e){"use strict";function t(t,n,o,r,i,a){function c(t){e.each(t,function(e){e.add_public_holidays=!!parseInt(e.add_public_holidays)})}function s(){return a.all().then(a.loadCalculationUnits)}i.debug("Service: contractLeaveService");var l=t(o.pathRest,{action:"get",entity:"HRJobLeave",json:{}});return{getOne:function(e){var t=n.defer();return!e||"object"!=typeof e||!e.jobcontract_revision_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id||e.id&&"number"!=typeof+e.id||e.leaveType&&"number"!=typeof+e.leaveType?null:(e.sequential=1,e.debug=o.debug,l.get({json:e},function(e){r.errorHandler(e,"Unable to fetch contract leave",t)||(c(e.values),t.resolve(e.values))},function(){t.reject("Unable to fetch contract leave")}),t.promise)},getOptions:function(e,t){var r,i=n.defer();return t||(r=o.CRM.options.HRJobLeave||{},e&&"string"==typeof e&&(r=r[e]),i.resolve(r||{})),i.promise},getFields:function(e){var t=n.defer(),r=o.CRM.fields;return e&&"object"!=typeof e?null:(e&&"object"==typeof e||(e={}),r&&r.HRJobLeave?t.resolve(r.HRJobLeave):(e.sequential=1,l.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract leave fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract leave fields")})),t.promise)},save:function(e){var t=n.defer(),i={sequential:1,values:e,debug:o.debug};return e&&"object"==typeof e?(l.save({action:"replace",json:i},null,function(e){r.errorHandler(e,"Unable to create contract leave",t)||(c(e.values),t.resolve(e.values))},function(){t.reject("Unable to create contract details")}),t.promise):null},model:function(t,o){function r(t,n){var o=0,r=n.length,i=[],a={};for(o;o<r;o++)a[n[o].name]="";return void 0!==a.id&&(a.id=null),void 0!==a.jobcontract_revision_id&&(a.jobcontract_revision_id=null),void 0!==a.location&&(a.location=null),t&&"object"==typeof t&&a&&"object"==typeof a&&void 0!==a.leave_type?(a.getEstimatedLeaveAmount=function(e){return this.add_public_holidays&&e?parseFloat(this.leave_amount)+e:this.leave_amount},e.each(t,function(t){a.leave_type=t.id,a.leave_type_title=t.title,a.leave_calculation_unit_name=t.calculation_unit_name,a.leave_calculation_unit_label=t.calculation_unit_label,a.leave_amount=0,a.is_add_public_holidays_readonly="hours"===t.calculation_unit_name,a.add_public_holidays=!!+t.add_public_holiday_to_entitlement,i.push(e.cloneDeep(a))}),i):null}var i=n.defer(),a=o&&"object"==typeof o?o:s();return t?n.when(a).then(function(e){i.resolve(r(e,t))}):this.getFields().then(function(e){n.when(a).then(function(t){i.resolve(r(t,e))})}),i.promise}}}return t.$inject=["$resource","$q","settings","utilsService","$log","AbsenceType"],{contractLeaveService:t}}),define("job-contract/services/contract-pay.service",["common/angular","common/lodash"],function(e,t){"use strict";function n(n,o,r,i,a){a.debug("Service: contractPayService");var c=n(o.pathRest,{action:"get",entity:"HRJobPay",json:{}});return{getOne:function(e){if(!e||"object"!=typeof e||!e.jobcontract_revision_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id)return null;e.sequential=1,e.debug=o.debug;var t,n=r.defer();return c.get({json:e},function(e){i.errorHandler(e,"Unable to fetch contract pay",n)||(t=e.values,n.resolve(1===t.length?t[0]:null))},function(){n.reject("Unable to fetch contract pay")}),n.promise},getOptions:function(e,n){var i,a=r.defer(),c={arr:[],obj:{}};return n?CRM.api3("HRJobPay","getoptions",{sequential:1,field:e}).done(function(e){c.obj=t.mapValues(t.keyBy(e.values,"key"),"value"),c.arr=t.values(t.keyBy(e.values,"key")),a.resolve(c)}):(i=o.CRM.options.HRJobPay||{},e&&"string"==typeof e&&(i=i[e]),a.resolve(i||{})),a.promise},getFields:function(e){if(e&&"object"!=typeof e)return null;e&&"object"==typeof e||(e={});var t=r.defer(),n=o.CRM.fields;return n&&n.HRJobPay?t.resolve(n.HRJobPay):(e.sequential=1,c.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract pay fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract pay fields")})),t.promise},save:function(t){if(!t||"object"!=typeof t)return null;var n,a=r.defer(),s=e.extend({sequential:1,debug:o.debug},t);return c.save({action:"create",json:s},null,function(e){i.errorHandler(e,"Unable to create contract pay",a)||(n=e.values,a.resolve(1===n.length?n[0]:null))},function(){a.reject("Unable to create contract pay")}),a.promise},model:function(e){function t(e){var t=0,n=e.length,o={};for(t;t<n;t++)o[e[t].name]="";return void 0!==o.id&&(o.id=null),void 0!==o.jobcontract_revision_id&&(o.jobcontract_revision_id=null),void 0!==o.annual_benefits&&(o.annual_benefits=[]),void 0!==o.annual_deductions&&(o.annual_deductions=[]),o}var n=r.defer();return e?n.resolve(t(e)):this.getFields().then(function(e){n.resolve(t(e))}),n.promise}}}return n.$inject=["$resource","settings","$q","utilsService","$log"],{contractPayService:n}}),define("job-contract/services/contract-pension.service",["common/angular"],function(e){"use strict";function t(t,n,o,r,i){i.debug("Service: contractPensionService");var a=t(n.pathRest,{action:"get",entity:"HRJobPension",json:{}});return{getOne:function(e){if(!e||"object"!=typeof e||!e.jobcontract_revision_id||e.jobcontract_revision_id&&"number"!=typeof+e.jobcontract_revision_id)return null;e.sequential=1,e.debug=n.debug;var t,i=o.defer();return a.get({json:e},function(e){r.errorHandler(e,"Unable to fetch contract pension",i)||(t=e.values,i.resolve(1===t.length?t[0]:null))},function(){i.reject("Unable to fetch contract pension")}),i.promise},getOptions:function(e,t){var r,i=o.defer();return t||(r=n.CRM.options.HRJobPension||{},e&&"string"==typeof e&&(r=r[e]),i.resolve(r||{})),i.promise},getFields:function(e){if(e&&"object"!=typeof e)return null;e&&"object"==typeof e||(e={});var t=o.defer(),r=n.CRM.fields;return r&&r.HRJobPension?t.resolve(r.HRJobPension):(e.sequential=1,a.get({action:"getfields",json:e},function(e){e.values||t.reject("Unable to fetch contract pension fields"),t.resolve(e.values)},function(){t.reject("Unable to fetch contract pension fields")})),t.promise},save:function(t){if(!t||"object"!=typeof t)return null;var i,c=o.defer(),s=e.extend({sequential:1,debug:n.debug},t);return a.save({action:"create",json:s},null,function(e){r.errorHandler(e,"Unable to create contract pension",c)||(i=e.values,c.resolve(1===i.length?i[0]:null))},function(){c.reject("Unable to create contract pension")}),c.promise},model:function(e){function t(e){var t=0,n=e.length,o={};for(t;t<n;t++)o[e[t].name]="";return void 0!==o.id&&(o.id=null),void 0!==o.jobcontract_revision_id&&(o.jobcontract_revision_id=null),o}var n=o.defer();return e?n.resolve(t(e)):this.getFields().then(function(e){n.resolve(t(e))}),n.promise}}}return t.$inject=["$resource","settings","$q","utilsService","$log"],{contractPensionService:t}}),define("job-contract/services/contract-revision-list.service",["common/lodash"],function(e){"use strict";function t(t,n,o,r,i,a){function c(e){return{details:{position:e["details_revision_id.position"],location:e["details_revision_id.location"]},hour:{hours_type:e["hour_revision_id.hours_type"]},pay:{pay_annualized_est:e["pay_revision_id.pay_annualized_est"],pay_currency:e["pay_revision_id.pay_currency"],pay_scale:e["pay_revision_id.pay_scale"]}}}function s(t){return t.effective_date=t.effective_date||"",n.all({files:{details:i.get(t.details_revision_id,"civicrm_hrjobcontract_details")},aggregated:a.get({action:"getsingle",json:{sequential:1,id:t.id,return:["details_revision_id.position","details_revision_id.location","hour_revision_id.hours_type","pay_revision_id.pay_scale","pay_revision_id.pay_annualized_est","pay_revision_id.pay_currency"]}}).$promise.then(function(e){return e})}).then(function(n){return e.assign({revisionEntityIdObj:t,files:n.files},c(n.aggregated))})}function l(e){var o=[],i=n.defer();return r.getRevision(e).then(function(e){return o=t("orderBy")(e,["-effective_date","-id"]),n.all(o.map(s))}).then(function(e){i.resolve({revisionList:o,revisionDataList:e})}),i.promise}return o.debug("Service: contractRevisionListService"),{fetchRevisions:l}}return t.$inject=["$filter","$q","$log","contractService","contractFilesService","contractRevisionService"],{contractRevisionListService:t}}),define("job-contract/services/contract-revision.service",["common/lodash"],function(e){"use strict";function t(t,n,o,r,i,a){function c(e){var n=t("formatDate")(e,"YYYY-MM-DD");return"Unspecified"!==n?n:e}return a.debug("Service: contractRevisionService"),e.assign(n(o.pathRest,{action:"get",entity:"HRJobContractRevision",json:{}}),{validateEffectiveDate:function(e){return e.effective_date=c(e.effective_date),e.sequential=0,e.debug=o.debug,this.save({action:"validateeffectivedate",json:e},null).$promise.then(function(e){return e.values})}})}return t.$inject=["$filter","$resource","settings","$q","utilsService","$log"],{contractRevisionService:t}}),define("job-contract/services/contract-service.service",["common/lodash"],function(e){"use strict";function t(t,n,o,r,i,a,c,s){function l(t,n){e.each(t.leave,function(e){e.add_public_holidays="hours"!==n[e.leave_type].calculation_unit_name&&!!parseInt(e.add_public_holidays)})}function u(t,n){return e.filter(t,function(t){if(e.find(n,{id:t.leave_type}))return t})}return t.debug("Service: contractService"),{get:function(e){var t=n.defer(),r={};return CRM&&CRM.jobContractTabApp&&CRM.jobContractTabApp.contractList?t.resolve(CRM.jobContractTabApp.contractList):(r={sequential:1,contact_id:i.contactId,deleted:0},e&&"number"==typeof+e&&(r.contact_id=e),o.get({json:r},function(e){a.errorHandler(e,"Unable to fetch contract list",t)||t.resolve(e.values)},function(){t.reject("Unable to fetch contract list")})),t.promise},getCurrentContract:function(e){var t=n.defer();return o.get({action:"getcurrentcontract",json:{contact_id:e}},function(e){e.is_error&&t.reject("Unable to fetch the current contract"),t.resolve(e.values)},function(){t.reject("Unable to fetch the current contract")}),t.promise},updateHeaderInfo:function(){this.getCurrentContract(i.contactId).then(function(e){c("updateContactHeader",{contract:e})}).catch(function(e){console.log(e)})},getOne:function(e,t){var r,a=n.defer(),c={deleted:0,sequential:1,contact_id:i.contactId,id:e};return e&&"number"==typeof+e?(t&&"number"==typeof+t&&(c.contact_id=t),o.get({json:c},function(e){r=e.values,a.resolve(1===r.length?r[0]:null)},function(){a.reject("Unable to fetch contract data")}),a.promise):null},getRevision:function(e){var t=n.defer(),o={deleted:0,options:{limit:0},sequential:1,jobcontract_id:e};return e&&"number"==typeof+e?(r.get({json:o},function(e){t.resolve(e.values)},function(){t.reject("Unable to fetch contract revisions")}),t.promise):null},getRevisionOptions:function(t,o){var r,a=n.defer(),c={arr:[],obj:{}};return o?CRM.api3("HRJobContractRevision","getoptions",{sequential:1,field:t}).done(function(t){c.obj=e.mapValues(e.keyBy(t.values,"key"),"value"),c.arr=e.values(e.keyBy(t.values,"key")),a.resolve(c)}):(r=i.CRM.options.HRJobContractRevision||{},t&&"string"==typeof t&&(r=r[t]),a.resolve(r||{})),a.promise},save:function(t){var r,i=n.defer(),a=e.extend({deleted:0,sequential:1},t);return t&&"object"==typeof t&&t.id&&"number"==typeof+t.id?(o.save({action:"create",json:a},null,function(e){r=e.values,i.resolve(1===r.length?r[0]:null)},function(){i.reject("Unable to fetch contract contract data")}),i.promise):null},saveRevision:function(t){var o,i=n.defer(),a=e.extend({deleted:0,sequential:1},t);return t&&"object"==typeof t&&t.id&&"number"==typeof+t.id?(r.save({action:"create",json:a},null,function(e){o=e.values,i.resolve(1===o.length?o[0]:null)},function(){i.reject("Unable to fetch contract revision")}),i.promise):null},delete:function(e){var t=n.defer();return e&&"number"==typeof+e?(o.delete({action:"deletecontract",json:{id:e}},function(e){t.resolve(e)},function(){t.reject("Could not delete contract ID:"+e)}),t.promise):null},deleteRevision:function(e){var t,o=n.defer();return e&&"number"==typeof+e?(r.save({action:"create",json:{sequential:1,deleted:1,id:e}},null,function(e){t=e.values,o.resolve(1===t.length?t[0]:null)},function(){o.reject("Unable to delete contract revision id: "+e)}),o.promise):null},fullDetails:function(t){var r=n.defer();return t&&"number"==typeof+t?(s.all().then(s.loadCalculationUnits).then(function(n){return o.get({action:"getfulldetails",json:{jobcontract_id:t}},function(t){t.leave=u(t.leave,n),l(t,e.keyBy(n,"id")),r.resolve(t)},function(){r.reject("Could not fetch full details for contract ID:"+t)})}),r.promise):null}}}return t.$inject=["$log","$q","Contract","contractRevisionService","settings","utilsService","DOMEventTrigger","AbsenceType"],{contractService:t}}),define("job-contract/services/utils.service",["common/angular"],function(e){"use strict";function t(t,n,o,r,i,a,c,s,l){function u(){return c.open({appendTo:i.find("div").eq(0),size:"sm",templateUrl:n.baseUrl+"controllers/modal/modal-dialog.html",controller:"ModalDialogController",resolve:{content:{title:"Update leave entitlements?",msg:"The system will now update the staff member leave entitlement.",copyConfirm:"Proceed"}}}).result}function d(){return l.all().then(function(e){return!!e.length})}return{getAbsenceTypes:function(){var n=o.defer();return t.resource("AbsenceType","get",{return:"id,title,default_entitlement,add_public_holiday_to_entitlement"}).get(function(t){e.forEach(t.values,function(e){e.add_public_holiday_to_entitlement=!!parseInt(e.add_public_holiday_to_entitlement),e.default_entitlement=parseFloat(e.default_entitlement)}),n.resolve(t.values)},function(){n.reject("Unable to fetch absence types")}),n.promise},getHoursLocation:function(){var e=o.defer();return t.resource("HRHoursLocation","get",{sequential:1,is_active:1}).get(function(t){e.resolve(t.values)},function(){e.reject("Unable to fetch standard hours")}),e.promise},getPayScaleGrade:function(){var e=o.defer();return t.resource("HRPayScale","get",{sequential:1,is_active:1}).get(function(t){e.resolve(t.values)},function(){e.reject("Unable to fetch standard hours")}),e.promise},getNumberOfPublicHolidaysInCurrentPeriod:function(){var e=o.defer();return t.resource("PublicHoliday","getcountforcurrentperiod",{sequential:1}).get(function(t){var n=parseInt(t.result)||0;e.resolve(n)},function(){e.reject("Unable to fetch the number of public holidays in current period")}),e.promise},prepareEntityIds:function(t,n,o){function r(e){e.jobcontract_id=n,delete e.id,o?e.jobcontract_revision_id=o:delete e.jobcontract_revision_id}if(e.isArray(t)){var i=0,a=t.length;for(i;i<a;i++)r(t[i])}else e.isObject(t)&&r(t)},errorHandler:function(e,t,n){var o;return e.is_error?(o=e.error_message.split("_").join(" "),o=o.charAt(0).toUpperCase()+o.slice(1),r.error("Unable to save. \n"+o),n&&n.reject("Unable to save. \n"+o),e.trace&&r.error(e.trace),!0):e.values?void 0:(r.error(t||"Unknown Error"),n&&n.reject(t||"Unknown Error"),!0)},getManageEntitlementsPageURL:function(e){var t=CRM.url("civicrm/contact/view",{cid:e,selectedChild:"hrjobcontract"});return CRM.url("civicrm/admin/leaveandabsences/periods/manage_entitlements",{cid:e,returnUrl:t})},updateEntitlements:function(e){d().then(function(t){t&&u().then(function(){s.location.assign(this.getManageEntitlementsPageURL(e))}.bind(this))}.bind(this))}}}return t.$inject=["apiService","settings","$q","$log","$rootElement","$timeout","$uibModal","$window","AbsencePeriod"],{utilsService:t}}),define("job-contract/job-contract.config",["common/angular"],function(e){"use strict";function t(e,t,n,o,r,i,a){t.debugEnabled(a.debug),o.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).when("/",{controller:"ContractListController",templateUrl:a.baseUrl+"controllers/contract-list.html",resolve:{contractList:["contractService",function(e){return e.get()}]}}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.theme="bootstrap",r.showWeeks=!1}e.module("job-contract.config",["job-contract.constants"]).config(t),t.$inject=["$httpProvider","$logProvider","$resourceProvider","$routeProvider","uibDatepickerConfig","uiSelectConfig","settings"]}),function(e){define("job-contract/job-contract.constants",["common/angular"],function(t){"use strict";t.module("job-contract.constants",[]).constant("settings",{classNamePrefix:"hrjc-",contactId:e.vars.hrjobcontract.contactId,debug:+e.debug,baseUrl:e.vars.hrjobcontract.baseURL+"js/src/job-contract/",pathFile:e.url("civicrm/hrjobcontract/file/"),pathReport:e.url("civicrm/report/hrjobcontract/summary"),pathRest:e.url("civicrm/ajax/rest"),CRM:{options:e.FieldOptions||{},defaultCurrency:e.vars.hrjobcontract.defaultCurrency,apiTsFmt:"YYYY-MM-DD HH:mm:ss",fields:e.vars.hrjobcontract.fields,maxFileSize:e.vars.hrjobcontract.maxFileSize}})})}(CRM),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(t){return t.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",sourcePath:e.vars.leaveAndAbsences.baseURL+"/js/src/leave-absences/",timeBaseInMinutes:15,timepickerDateFormat:"DD/MM/YYYY",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/constants",["common/angular"],function(e){"use strict";e.module("leave-absences.constants",[]).constant("ABSENCE_TYPE_COLOURS",["#5A6779","#3D4A5E","#263345","#151D2C","#E5807F","#E56A6A","#CC4A49","#B32E2E","#ECA67F","#FA8F55","#D97038","#BF561D","#8EC68A","#6DAD68","#4F944A","#377A31","#C096AA","#B37995","#995978","#803D5E","#9579A8","#84619C","#5F3D76","#47275C","#42B0CB","#2997B3","#147E99","#056780"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","common/modules/models","common/services/check-permissions","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models","common.models.instances","common.services","leave-absences.settings"])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/constants","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.constants","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/apis/absence-type.api",["common/lodash","common/moment","leave-absences/shared/modules/apis","common/services/api"],function(e,t,n){"use strict";n.factory("AbsenceTypeAPI",["$log","$q","api","shared-settings",function(n,o,r,i){return n.debug("AbsenceTypeAPI"),r.extend({all:function(t,o){n.debug("AbsenceTypeAPI.all");var r;return t=e.defaults({},t,{is_active:!0}),r=e.get(t,"options.sort")||"weight ASC",this.getAll("AbsenceType",t,void 0,r,o).then(function(e){return e.list})},calculateToilExpiryDate:function(o,r,a){return n.debug("AbsenceTypeAPI.calculateToilExpiryDate"),a=e.assign({},a,{absence_type_id:o,date:t(r).format(i.serverDateFormat)}),this.sendPOST("AbsenceType","calculateToilExpiryDate",a).then(function(e){return e.values.expiry_date})},save:function(e){return this.sendPOST("AbsenceType","create",e).catch(o.reject)}})}])}),define("leave-absences/shared/instances/absence-type.instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("AbsenceTypeInstance",["$log","ModelInstance",function(e,t){return e.debug("AbsenceTypeInstance"),t.extend({})}])}),define("leave-absences/shared/models/absence-type.model",["common/lodash","leave-absences/shared/modules/models","common/models/model","common/models/option-group","leave-absences/shared/apis/absence-type.api","leave-absences/shared/instances/absence-type.instance"],function(e,t){"use strict";t.factory("AbsenceType",["$log","$q","Model","OptionGroup","ABSENCE_TYPE_COLOURS","AbsenceTypeAPI","AbsenceTypeInstance",function(t,n,o,r,i,a,c){function s(e){e.notification_receivers_ids=e[l].values.map(function(e){return e.contact_id}),delete e[l]}t.debug("AbsenceType");var l="api.NotificationReceiver.get";return o.extend({all:function(e,t){return a.all(e,t).then(function(e){return e.map(function(e){return c.init(e,!0)})})},calculateToilExpiryDate:function(e,t,n){return a.calculateToilExpiryDate(e,t,n)},canExpire:function(e){return a.all({accrual_expiration_unit:{"IS NOT NULL":1},accrual_expiration_duration:{"IS NOT NULL":1},allow_accruals_request:1,id:e,options:{limit:1},return:["id"]}).then(function(e){return e.length>0})},findById:function(t,n,o){var r={id:t,is_active:null};return o=e.assign({},o),o.notificationReceivers&&(r[l]={type_id:t}),this.all(r,n).then(function(t){var n=e.first(t);return o.notificationReceivers&&s(n),n})},getAvailableColours:function(){return a.all(null,{return:["color"]}).then(function(t){var n=e.map(t,"color"),o=e.difference(i,n);return o.length?o:i})},loadCalculationUnits:function(t){return r.valuesOf("hrleaveandabsences_absence_type_calculation_unit").then(function(n){return n=e.keyBy(n,"value"),e.map(t,function(t){return e.assign(t,{calculation_unit_label:n[t.calculation_unit].label,calculation_unit_name:n[t.calculation_unit].name})})})},save:function(e){return a.save(e).catch(n.reject)}})}])}),define("leave-absences/shared/instances/absence-period.instance",["leave-absences/shared/modules/models-instances","common/moment","common/models/instances/instance","common/services/hr-settings"],function(e,t){"use strict";e.factory("AbsencePeriodInstance",["$log","ModelInstance","HR_settings",function(e,n,o){return e.debug("AbsencePeriodInstance"),n.extend({defaultCustomData:function(){return{current:!1}},transformAttributes:function(e){var n=t();return e.current=!1,t(e.start_date).isSameOrBefore(n,"day")&&t(e.end_date).isSameOrAfter(n,"day")&&(e.current=!0),e},isInPeriod:function(e){var n=o.DATE_FORMAT.toUpperCase(),r=t(e,n);return t(this.start_date).isSameOrBefore(r)&&t(this.end_date).isSameOrAfter(r)}})}])}),define("leave-absences/shared/apis/absence-period.api",["leave-absences/shared/modules/apis","common/services/api"],function(e){"use strict";e.factory("AbsencePeriodAPI",["$log","api",function(e,t){return e.debug("AbsencePeriodAPI"),t.extend({all:function(t){return e.debug("AbsencePeriodAPI"),this.sendGET("AbsencePeriod","get",t).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/absence-period.model",["leave-absences/shared/modules/models","common/moment","leave-absences/shared/modules/shared-settings","leave-absences/shared/instances/absence-period.instance","leave-absences/shared/apis/absence-period.api","common/models/model","common/services/hr-settings"],function(e,t){"use strict";e.factory("AbsencePeriod",["$log","Model","AbsencePeriodAPI","AbsencePeriodInstance","shared-settings",function(e,n,o,r,i){return e.debug("AbsencePeriod"),n.extend({all:function(e){return o.all(e).then(function(e){return e.map(function(e){return r.init(e,!0)})})},current:function(){var e=t().format(i.serverDateFormat),n={start_date:{"<=":e},end_date:{">=":e}};return o.all(n).then(function(e){return e&&e.length?r.init(e[0],!0):null})}})}])}),function(e,t){function n(){var e={nodiff:"",year:"year",years:"years",month:"month",months:"months",day:"day",days:"days",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",second:"second",seconds:"seconds",delimiter:" "};moment.fn.preciseDiff=function(e){return moment.preciseDiff(this,e)},moment.preciseDiff=function(t,n){function o(t,n){return t+" "+e[n+(1===t?"":"s")]}var r=moment(t),i=moment(n);if(r.isSame(i))return e.nodiff;if(r.isAfter(i)){var a=r;r=i,i=a}var c=i.year()-r.year(),s=i.month()-r.month(),l=i.date()-r.date();if(l<0){var u=moment(i.year()+"-"+(i.month()+1),"YYYY-MM").subtract("months",1).daysInMonth();l=u<r.date()?u+l+(r.date()-u):u+l,s--}s<0&&(s=12+s,c--);var d=[];return c&&d.push(o(c,"year")),s&&(c&&d.push(","),d.push(o(s,"month"))),l&&(s&&d.push("and"),d.push(o(l,"day"))),d.join(e.delimiter)}}function o(t,o,r){moment.preciseDiff||n();var i=moment(t,"MMMM DD, YYYY"),a="";if(o)var c=moment(o,"MMMM DD, YYYY");var s=moment();if(o)var l=c.diff(s,"days");else var l=s.diff(i,"days");a=l<0?moment.preciseDiff(i,c):moment().preciseDiff(i),s.diff(i,"days")<=0&&(a="0 days"),e("#initial_join_date").remove();e("#custom-set-content-"+r+" .crm-inline-block-content").append("<div class='crm-summary-row' id='initial_join_date'><div class='crm-label'>Length Of Employment</div><div class='crm-content crm-custom-data lengthEmployment'></div></div>"),e(".lengthEmployment").html(a),o&&l<0&&e(".lengthEmployment").css({color:"#FF0000"})}var r=CRM.grID,i=e("#custom-set-content-"+r+" .crm-inline-block-content div:nth-child(2) .crm-custom-data").html(),a=e("#custom-set-content-"+r+" .crm-inline-block-content div:nth-child(3) .crm-custom-data").html();i&&o(i,a,r),e(document).on("click","#_qf_CustomData_upload",function(){e(document).ajaxSuccess(function(t,n,i){i.extraData&&"CRM_Contact_Form_Inline_CustomData"==i.extraData.class_name&&i.extraData.groupID==r&&setTimeout(function(){var t=e("#custom-set-content-"+r+" .crm-inline-block-content div:nth-child(2) .crm-custom-data").html(),n=e("#custom-set-content-"+r+" .crm-inline-block-content div:nth-child(3) .crm-custom-data").html();t&&o(t,n,r)},300)})})}(CRM.$,CRM._),define("job-contract/job-contract.core",["common/angular","common/ui-select","common/directives/angular-date/date-input","common/filters/angular-date/format-date","common/filters/time-unit-applier.filter","common/modules/routers/compu-ng-route","common/modules/directives","common/services/dom-event-trigger","common/services/pub-sub","common/services/angular-date/date-format","common/services/crm-ang.service","common/services/notification.service","leave-absences/shared/models/absence-type.model","leave-absences/shared/models/absence-period.model","job-contract/vendor/fraction","job-contract/vendor/job-summary"],function(e){"use strict";e.module("job-contract.core",["ngAnimate","compuNgRoute","ngResource","angularFileUpload","ui.bootstrap","ui.select","common.angularDate","common.services","common.directives","common.filters","leave-absences.models"])}),define("job-contract/job-contract.run",["common/angular"],function(e){"use strict";function t(e,t,n,o,r,i,a,c,s,l,u){e.debug("app.run"),n.baseUrl=o.baseUrl,n.prefix=o.classNamePrefix,t.all({contract:r.getRevisionOptions(),details:i.getOptions(),hour:a.getOptions(),pay:c.getOptions(),leave:s.getOptions(),health:l.getOptions(),pension:u.getOptions()}).then(function(t){t.pay.pay_is_auto_est=["No","Yes"],t.pension.is_enrolled=["No","Yes","Opted out"],e.debug("OPTIONS:"),e.debug(t),n.options=t})}e.module("job-contract.run",["job-contract.constants"]).run(t),t.$inject=["$log","$q","$rootScope","settings","contractService","contractDetailsService","contractHourService","contractPayService","contractLeaveService","contractHealthService","contractPensionService"]}),
define("job-contract/job-contract.module",["common/angular","job-contract/controllers/contract.controller","job-contract/controllers/contract-list.controller","job-contract/controllers/revision-list.controller","job-contract/controllers/form/form-general.controller","job-contract/controllers/form/form-health.controller","job-contract/controllers/form/form-hour.controller","job-contract/controllers/form/form-leave.controller","job-contract/controllers/form/form-pay.controller","job-contract/controllers/form/form-pension.controller","job-contract/controllers/modal/modal-change-reason.controller","job-contract/controllers/modal/modal-contract-new.controller","job-contract/controllers/modal/modal-contract.controller","job-contract/controllers/modal/modal-dialog.controller","job-contract/controllers/modal/modal-progress.controller","job-contract/controllers/modal/modal-revision.controller","job-contract/directives/contact.directive","job-contract/directives/loader.directive","job-contract/directives/number.directive","job-contract/directives/validate.directive","job-contract/filters/capitalize.filter","job-contract/filters/format-amount.filter","job-contract/filters/format-period.filter","job-contract/filters/get-obj-by-id.filter","job-contract/filters/parse-integer.filter","job-contract/services/api.service","job-contract/services/contact.service","job-contract/services/contract.service","job-contract/services/contract-details.service","job-contract/services/contract-files.service","job-contract/services/contract-health.service","job-contract/services/contract-hour.service","job-contract/services/contract-leave.service","job-contract/services/contract-pay.service","job-contract/services/contract-pension.service","job-contract/services/contract-revision-list.service","job-contract/services/contract-revision.service","job-contract/services/contract-service.service","job-contract/services/utils.service","job-contract/job-contract.config","job-contract/job-contract.constants","job-contract/job-contract.core","job-contract/job-contract.run"],function(e,t,n,o,r,i,a,c,s,l,u,d,f,v,p,m,h,_,b,y,g,j,C,$,S,w,D,R,P,A,E,U,M,F,L,I,q,H,T){"use strict";e.module("job-contract",["job-contract.core","job-contract.config","job-contract.run","job-contract.constants"]).controller(t).controller(n).controller(o).controller(r).controller(i).controller(a).controller(c).controller(s).controller(l).controller(u).controller(d).controller(f).controller(v).controller(p).controller(m).directive(h).directive(_).directive(b).directive(y).filter(g).filter(j).filter(C).filter($).filter(S).factory(w).factory(D).factory(R).factory(P).factory(A).factory(E).factory(U).factory(M).factory(F).factory(L).factory(I).factory(q).factory(H).factory(T)}),function(e,t){var n=e.vars.hrjobcontract.baseURL+"js/src/job-contract";t.config({urlArgs:"bust="+(new Date).getTime(),paths:{"job-contract":n,"job-contract/vendor/fraction":n+"/vendor/fraction","job-contract/vendor/job-summary":n+"/vendor/jobsummary"},shim:{"job-contract/vendor/job-summary":{deps:["common/moment"]}}}),t(["job-contract/job-contract.module"],function(){"use strict";document.dispatchEvent("function"==typeof window.CustomEvent?new window.CustomEvent("hrjcReady"):function(){var e=document.createEvent("Event");return e.initEvent("hrjcReady",!0,!0),e}())})}(CRM,require);
//# sourceMappingURL=/sites/all/modules/civicrm/tools/extensions/civihr/hrjobcontract/js/dist/job-contract.min.js.map