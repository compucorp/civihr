define("access-rights/modules/controllers",["common/angular"],function(e){"use strict";return e.module("access-rights.controllers",[])}),define("access-rights/controllers/access-rights-ctrl",["access-rights/modules/controllers"],function(e){"use strict";e.controller("AccessRightsCtrl",["$rootElement","$uibModal",function(e,t){return{openModal:function(){t.open({appendTo:e.children().eq(0),controller:"AccessRightsModalCtrl",controllerAs:"modalCtrl",bindToController:!0,templateUrl:CRM.vars.contactAccessRights.baseURL+"/views/access-rights-modal.html"})}}}])}),define("access-rights/controllers/access-rights-modal-ctrl",["common/lodash","access-rights/modules/controllers"],function(e,t){"use strict";t.controller("AccessRightsModalCtrl",["$q","$uibModalInstance","Region","Location","Right",function(t,s,i,n,o){function c(s){var i=a.originalData[s],n=a.selectedData[s],c=i.map(function(e){return e.entity_id}),r=e.difference(n,c),l=e.difference(c,n).map(function(t){return e.find(i,function(e){return e.entity_id===t}).id}),d=[];return r.length>0&&d.push(o["save"+e.capitalize(s)](r)),l.length>0&&d.push(o.deleteByIds(l)),t.all(d)}function r(){t.all([i.getAll(),n.getAll()]).then(function(e){return{regions:e[0],locations:e[1]}}).then(function(s){return t.all(e.map(s,function(t,s){return a.availableData[s]=t,o["get"+e.capitalize(s)]()}))}).then(function(e){return{regions:e[0],locations:e[1]}}).then(function(e){Object.keys(e).forEach(function(t){a.originalData[t]=e[t].values,a.selectedData[t]=e[t].values.map(function(e){return e.entity_id})})}).then(function(){a.dataLoaded=!0})}var a=this;a.submitting=!1,a.hasSelected=!1,a.availableData={regions:[],locations:[]},a.selectedData={locations:[],regions:[]},a.originalData={locations:[],regions:[]},a.errorMsg="",a.dataLoaded=!1,a.selection=function(){a.selectedData.locations.length>0&&a.selectedData.regions.length>0&&(a.hasSelected=!0)},a.cancel=function(){s.dismiss("cancel")},a.submit=function(){a.submitting=!0,t.all([c("regions"),c("locations")]).then(function(){s.dismiss("cancel")}).catch(function(e){a.errorMsg="Error while saving data"}).finally(function(){a.submitting=!0})},r()}])}),define("access-rights/modules/models",["common/angular","common/modules/apis"],function(e){"use strict";return e.module("access-rights.models",["common.apis","common.models"])}),define("access-rights/models/region",["access-rights/modules/models","common/services/api/option-group","common/models/model"],function(e){"use strict";e.factory("Region",["Model","api.optionGroup",function(e,t){return e.extend({getAll:function(){return t.valuesOf("hrjc_region")}})}])}),define("access-rights/models/location",["access-rights/modules/models","common/services/api/option-group","common/models/model"],function(e){"use strict";e.factory("Location",["Model","api.optionGroup",function(e,t){return e.extend({getAll:function(){return t.valuesOf("hrjc_location")}})}])}),define("access-rights/services/api/right",["access-rights/modules/models","common/services/api"],function(e){"use strict";e.factory("rightApi",["api","$q","$location",function(e,t,s){var i="Rights",n={contact_id:s.search().cid};return e.extend({getLocations:function(){return this.sendGET(i,"getlocations",n,!1)},getRegions:function(){return this.sendGET(i,"getregions",n,!1)},deleteByIds:function(e){return t.all(e.map(function(e){return this.sendPOST(i,"delete",{contact_id:s.search().cid,id:e})}.bind(this)))},saveRegions:function(e){return t.all(e.map(function(e){return this.sendPOST(i,"create",{contact_id:s.search().cid,entity_id:e,entity_type:"hrjc_region"})}.bind(this)))},saveLocations:function(e){return t.all(e.map(function(e){return this.sendPOST(i,"create",{contact_id:s.search().cid,entity_id:e,entity_type:"hrjc_location"})}.bind(this)))}})}])}),define("access-rights/models/right",["access-rights/modules/models","access-rights/services/api/right","common/services/api","common/models/model"],function(e){"use strict";e.factory("Right",["Model","rightApi",function(e,t){return e.extend({getLocations:t.getLocations.bind(t),getRegions:t.getRegions.bind(t),deleteByIds:t.deleteByIds.bind(t),saveRegions:t.saveRegions.bind(t),saveLocations:t.saveLocations.bind(t)})}])}),define("access-rights/app",["common/angular","common/ui-select","common/angularBootstrap","common/modules/xeditable-civi","common/directives/loading","access-rights/controllers/access-rights-ctrl","access-rights/controllers/access-rights-modal-ctrl","access-rights/models/region","access-rights/models/location","access-rights/models/right"],function(e){"use strict";return e.module("access-rights",["ngAnimate","ui.bootstrap","ui.select","common.directives","xeditable-civi","access-rights.controllers","access-rights.models"]).run(["$log","editableOptions","editableThemes",function(e,t,s){e.debug("app.run"),t.theme="bs3"}]).config(["$locationProvider","$httpProvider",function(e,t){e.html5Mode({enabled:!0,requireBase:!1}),t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),e}),define("access-rights/dom-initialization",["common/angular"],function(e){"use strict";return{addAppToDOM:function(){var t=e.element(".crm-actions-ribbon ul#actions"),s=e.element('<li id="access-rights">           <div ng-controller="AccessRightsCtrl as $ctrl" id="bootstrap-theme">             <a href class="edit button pull-right" ng-click="$ctrl.openModal()" id="manage-roles-and-teams">               <div class="crm-i fa-edit"></div> Manage roles and teams             </a>           </div>         </li>');return t.append(s),s}}}),function(){"use strict";var e=CRM.vars.contactAccessRights.baseURL+"/js/src/access-rights";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"access-rights":e}}),require(["access-rights/app","access-rights/dom-initialization"],function(e,t){e.bootstrap(t.addAppToDOM(),["access-rights"])})}(require);